#include "../config.bgt"
#include"includes/rotation.bgt"
#include "includes/ip_locale.bgt";
#include"includes/comandos.bgt"
#include"includes/mine.bgt"
#include"includes/moving_sound.bgt"
#include"includes/compban.bgt"
#include "includes/bullet.bgt"
#include"includes/const.bgt"
#include "includes/item.bgt"
#include "includes/map.bgt"
#include "includes/player.bgt"
#include"includes/voids.bgt"
string bell=ascii_to_character(7);
string bell2=ascii_to_character(9);
network_event event;
bool encryption=true, jogoteste=false, pvp=true;
bool bombaativa=true, dardoativo=true, fitaativa=true;
double idversion=2.0;
string mapainicial, msalvar="salvar1.usr", mapaatual;
string stringmorte;
string[] servidornomes, desc, objsbelick, ambientesmapa, nban, msmorte, mapasaviao, mapascastelo, mraio;
string[] banidos;
instance server("fdserver");
string[] msgadm;
string[] msgquadro;
string diaatual, njrecord="smurphies";
uint nbadalar=1, pmapa=0, andar1=0, andar2=0, andar3=0, andar4=0, andar5=0, andar6=0, andar7=0, andar8=0, andar9=0, andar10=0;
int andar11=0, andar12=0, andar13=0, andar14=0, andar15=0, andar16=0, andar17=0, andar18=0, andar19=0, andar20=0, andar21=0, andar22=0, andar23=0, andar24=0, andar25=0, andar26=0, andar27=0, andar28=0, andar29=0, andar30=0, andar31=0, andar32=0, andar33=0, andar34=0, andar35=0, andar36=0, andar37=0, andar38=0, andar39=0, andar40=0, andar41=0, andar42=0, andar43=0, andar44=0, andar45=0, andar46=0, andar47=0, andar48=0, andar49=0, andar50=0;
int preparardecolagem=0, preparartrem=0, jrecord=1, xmorrer=1, ymorrer=11, acontagem=0;
timer guardarmapa, atualizarjogador, taldeia, soltarbombas, jogarfrutas, aviaodeguerra, temposequestrador, tempoguardacofre, tdragonsauro, turso, tcachorro, tconcha, tmar, tlimpar, badalar, tpassaros, tvaviao, tvaviao2, tovo, trato, tmina, tmina2, tloja, tapagar, tpresente, tdemorar, tpresentes, tpascoa, tcoelho;
timer tempoentrouaviao, tempoentroutrem, tlimpar2, tzumbi;
timer tempoondafogo;
timer divulgar;
timer trobo;
timer casabruxo1, casabruxo2, casabruxo3;
timer ondatempo;
string[] ids;
timer tempoleilao;
int numeroleilao=60000, x_castelo, y_castelo, npresentes=random(600000, 900000);
int semleilao=0;
int votos2d=0, votos3d=0;
int numerochuva;
int volumechuva;
int congelando=60000;
int trov1=0;
int trov2=0;
int trov3=0;
int trov4=0;
int trov5=0;
int trov6=0;
int trov7=0;
int trov8=0;
int trov9=0;
int trov10=0;
int volumechuva1=0;
int volumechuva2=0;
int volumechuva3=0;
int volumechuva4=0;
int volumechuva5=0;
int volumechuva6=0;
int volumechuva7=0;
int volumechuva8=0;
int volumechuva9=0;
int volumechuva10=0;
int ofertainicial;
int numero;
string presentes;
int doublexp, doublegold, megadouble, avisadoublexp1, avisadoublexp2, avisadoublexp3, avisadoublexp4, numerodoublexp=0;
int eventpiratas;
timer tempodoublexp, tempodoublegold;
int prisao=300000;
int hora=0;
int minuto=1;
int dia=1;
int mes=1;
int ano=2050;
timer horatemporizador;
timer soltaritenstimer;
timer chuvatimer;
timer jogarfogo;
int soltaritenstime=90000;
int horatempo=5000;
int chuvatempo=2000000;
int chovendo=0;
string msgpt="Ótimo jogo!", msgen="good game!", msges="Bueno juego!", msgfr="salut";
string wintext="Servidor de testes do "+GAME_NAME+" "+version+" pronto";
string[] items, items2, items2loja2;
int[] amounts, amounts2, amounts2loja2;
int auctiontime=30000;
string auctionwho,auctionwho2;
bool auctionbidder, postar=false;
bool auction;
string auctionitem;
int auctionamount;
int auctionbid;
int num;
string[] dmessages;
int upw=0;
int upd=0;
int uph=0;
int ups=0;
int upm=0;
int upzw=0;
int upzd=0;
int upzh=0;
int upzs=0;
int upzm=0;
int ad;
int maxobjs=150;
int safetime=20000;
string[] what, what2;
int objtime=100;
int belicktime=6000;
string[] maps;
string[] weapons(60), weapons2(60);
int onthis, onother;
int ftotal;
bool testing=false;
double voteyes;
double voteno;
int idletime=120000;
int timetime=250;
int hour, minute, day=1, month=1, year=1970;
int playerlimit=151;
int healtime=300;
int szx=1;
int szy=1;
int szminx=0;
int szmaxx=1;
int szy2=0;
string szmap="escola";
double uptime;
timer versiontimer, auctiontimer, objtimer, sendtimer, timetimer, uptimer, belicktimer;
int peak;
int interrupt;
string motd;
string[] killmsgs;
network net;
bool gamestopped=false;
bool queststopped=false;
timer salvarconfigs;
void main(){
//set_error_output("log.md");
if(directory_exists("players_apartamentos")==false)directory_create("players_apartamentos");
if(directory_exists("players")==false)directory_create("players");
if(directory_exists("players2")==false)directory_create("players2");
if(directory_exists("lanchas")==false)directory_create("lanchas");
tvaviao.force(0);
tvaviao.pause();
apartamentos.reserve(300);
computadors.reserve(300);
objs.reserve(201);
cachorros.reserve(6);
macacos.reserve(3);
dragonsauros.reserve(1);
bebesauros.reserve(50);
fitaexplosivas.reserve(100);
ursos.reserve(2);
bullets.reserve(50);
players.reserve(1000);
msmorte.reserve(4);
msmorte.insert_last("Ai! Todo o meu corpo dói!");
msmorte.insert_last("Socorro! O meu corpo está se queimando todo!");
msmorte.insert_last("Eu não aguento mais! Todo o meu corpo está sendo consumido por essas chamas infernais!");
msmorte.insert_last("Minha nossa! Como isso dói!");
servidornomes.reserve(1);
servidornomes.insert_last("admin");
weapons[0]="soco.ogg:2:10:"+random(53, 58);
weapons[1]="knife.ogg:3:20:"+random(33, 35);
weapons[2]="shotgun.ogg:35:45:"+random(1, 7);
weapons[3]="glock.ogg:18:90:"+random(1, 7);
weapons[4]="desert.ogg:20:100:"+random(1, 7);
weapons[5]="arco.ogg:19:95:"+random(36, 38);
weapons[6]="m14.ogg:40:200:"+random(1, 7);
weapons[7]="m240.ogg:100:340:"+random(1, 7);
weapons[9]="rifle.ogg:190:500:"+random(1, 7);
weapons[10]="benelli.ogg:25:110:"+random(1, 7);
weapons[11]="laser.ogg:200:550:40";
weapons[12]="bazuca.ogg:500:5000:41";
weapons[13]="rocketlauncher.ogg:150::3000:42";
weapons[14]="sniper.ogg:230:1000:"+random(1, 7);
weapons[15]="uzi.ogg:45:193:"+random(1, 7);
weapons[16]="mp5.ogg:60:207:"+random(1, 7);
weapons[17]="ar15.ogg:55:210:"+random(1, 7);
weapons[18]="m60.ogg:100:330:"+random(1, 7);
weapons[19]="espada.ogg:5:50:43";
weapons[20]="remington.ogg:60:130:"+random(1, 7);
weapons[21]="doze.ogg:30:120:"+random(1, 7);
weapons[22]="vulcan.ogg:150:1000:44";
weapons[23]="m4a1.ogg:63:220:"+random(1, 7);
weapons[24]="m249.ogg:75:290:"+random(1, 7);
weapons[25]="ak47.ogg:87:300:"+random(1, 7);
weapons[26]="taser.ogg:5:100:"+random(1, 7);
weapons[27]="chute.ogg:4:15::"+random(45, 48);
weapons[28]="lança.ogg:4:90:49";
weapons[29]="espada_curta.ogg:4:30:50";
weapons[30]="mp7.ogg:110:380:"+random(1, 7);
weapons[31]="m16.ogg:68:270:"+random(1, 7);
weapons[32]="sub_laser.ogg:60:500:51";
weapons[33]="molotovatira.ogg:12:170:52";
weapons[34]="none.ogg:4:2:0";
weapons[35]="galil.ogg:110:300:"+random(1, 7);
weapons[37]="ak48.ogg:110:400:"+random(1, 7);
weapons[38]="mk1.ogg:70:310:"+random(1, 7);
weapons2[5]="arco.ogg:80:40:"+random(36, 38);
weapons2[8]="grenade.ogg:49:2000:39";
weapons2[10]="supressorbenelli.ogg:30:80:"+random(1, 7);
weapons2[15]="uzisupressor.ogg:80:150:"+random(1, 7);
weapons2[17]="ar15rajada.ogg:110:400:9";
weapons2[23]="m4a1s.ogg:130:180:"+random(1, 7);
weapons2[24]="m249supressor.ogg:120:200:"+random(1, 7);
weapons2[25]="ak47rajada.ogg:200:600:9";
weapons2[35]="galils.ogg:110:300:"+random(1, 7);
what.reserve(5);
what.insert_last("coins_rand");
what.insert_last("9mm_rand");
what.insert_last("5.56mm_rand");
what.insert_last("7.62mm_rand");
objsbelick.insert_last("reais");
add_to_loja2("míssil_teleguiado", 200);
add_to_loja2("m16", 3500);
add_to_loja2("mk1", 4879);
add_to_loja2("galão_de_gasolina", 40);
add_to_loja2("m4a1", 200);
add_to_loja2("vara_de_pesca", 50);
add_to_loja2("minhoca", 1);
add_to_loja2("lancha", 30000);
add_to_loja2("batata_frita", 1);
add_to_loja2("torresmo", 1);
add_to_loja2("enroladinho", 2);
add_to_loja2("cochinha", 2);
add_to_loja2("pastel_de_carne", 4);
add_to_loja2("pastel_de_queijo", 4);
add_to_loja2("cachorro_quente", 5);
add_to_loja2("suco_de_caju", 1);
add_to_loja2("suco_de_goiaba", 1);
add_to_loja2("cocacola", 4);
add_to_loja2("suco_de_pêssego", 4);
add_to_loja2("suco_de_morango", 4);
add_to_loja2("antibiótico", 10);
add_to_loja2("bomba_de_fogo", 250);
add_to_loja2("bomba_atômica", 300);
add_to_loja2("max_bomba", 250);
add_to_loja2("bomba_remota", 200);
add_to_loja2("bomba_relógio", 100);
add_to_loja2("controle_remoto", 500);
add_to_loja2("mina", 20);
add_to_loja("ovo_de_ouro", 4000000);
add_to_loja("pérola", 200);
add_to_loja("ouro", 2000);
add_to_loja("pulseira", 350);
add_to_loja("pulseira_de_prata", 5298);
add_to_loja("pulseira_de_bronze", 3298);
add_to_loja("anel", 320);
add_to_loja("calça_camuflada", 300);
add_to_loja("boné", 120);
add_to_loja("taser", 60000);
add_to_loja2("ak47", 2300);
add_to_loja2("m249", 2000);
add_to_loja2("remington", 150);
add_to_loja2("doze", 50);
add_to_loja("sapato_scarpin", 160);
add_to_loja2("espada", 10);
add_to_loja2("uzi", 1160);
add_to_loja2("sniper", 2500);
add_to_loja2("lançador_de_granada", 8000);
add_to_loja2("m14", 1400);
add_to_loja2("m240",3000);
add_to_loja2("rifle.45", 162);
add_to_loja2("benelli", 100);
add_to_loja2("mega_laser", 5000);
add_to_loja2("granada", 10);
add_to_loja2("mp5", 1150);
add_to_loja2("ar15", 1800);
add_to_loja2("m60", 2800);
add_to_loja2("9mm", 2);
add_to_loja2("12mm", 2);
add_to_loja2("30mm", 2);
add_to_loja2("5.56mm", 2);
add_to_loja2("7.62mm", 3);
add_to_loja2("laser", 5);
add_to_loja2("míssil", 15);
add_to_loja("camisa_de_malha",60);
add_to_loja("calça_jeans",95);
add_to_loja("sapato_social",280);
add_to_loja("calça_social",230);
add_to_loja("colete_de_borracha",200);
add_to_loja("Sandália",360);
add_to_loja("tênis_de_corrida",360);
add_to_loja("chapéu_panamá",80);
add_to_loja("óculos_escuros",170);
add_to_loja("calça_legging", 130);
add_to_loja("jaqueta_de_couro", 780);
add_to_loja("luvas", 36);
add_to_loja("cerveja", 6);
add_to_loja("refrigerante", 4);
add_to_loja("energético", 5);
add_to_loja("medalha_de_ouro", 20000);
add_to_loja("medalha_de_prata", 10000);
add_to_loja("medalha_de_bronze", 4000);
add_to_loja("troféu_de_ouro", 60000);
add_to_loja("troféu_de_prata", 40000);
add_to_loja("troféu_de_bronze", 20000);add_to_loja("sandália", 360);
add_to_store("medalha_de_ouro", 20000);
add_to_store("medalha_de_prata", 10000);
add_to_store("medalha_de_bronze", 4000);
add_to_store("troféu_de_ouro", 60000);
add_to_store("troféu_de_prata", 40000);
add_to_store("troféu_de_bronze", 20000);
add_to_store("sandália", 360);
ambientesmapa.insert_last("brejo:brejo-dia.ogg:brejo-noite.ogg");
file pr;
if(file_exists("banidos.dat")){
pr.open("banidos.dat","r");
banidos=delinear(pr.read());
pr.close();
}
if(file_exists("servidor.descs")){
pr.open("servidor.descs","r");
desc=delinear(pr.read());
pr.close();
}
pr.open("mapasaviao.txt", "r");
mapasaviao=delinear(pr.read());
pr.close();
pr.open("mapascastelo.ini", "r");
mapascastelo=delinear(pr.read());
pr.close();
pr.open("servidor.msgadm", "r");
msgadm=string_split(pr.read(), bell, false);
pr.close();
pr.open("servidor.nban","rb");
nban=delinear(pr.read());
pr.close();
pr.open("mapas.raio", "r");
mraio=delinear(pr.read());
pr.close();
if(file_exists("servidor.msgquadro")){
pr.open("servidor.msgquadro","rb");
msgquadro=delinear(pr.read());
pr.close();
}
pr.open("servidor.maps","rb");
maps=delinear(pr.read());
pr.close();
if(file_exists("servidor.recordista")){
pr.open("servidor.recordista", "rb");
string[] ba=string_split(pr.read(), "\r\n", false);
njrecord=ba[0];
jrecord=string_to_number(ba[1]);
pr.close();
}
if(file_exists("servidor.ini")){
pr.open("servidor.ini", "rb");
mapainicial=pr.read();
pr.close();
}
else{
mapainicial="túnel";
}
pr.open("servidor.configs", "rb");
string content=pr.read();
string[] peramitors=string_split(content, "\r\n", true);
string[] values;
peramitors.reserve(peramitors.length);
values.reserve(peramitors.length);
for(uint i=0; i<peramitors.length(); i++)
{
values.insert_at(i,string_replace(peramitors[i], string_left(peramitors[i], string_contains(peramitors[i], "=", 1)+1), "", true));
peramitors[i]=string_replace(peramitors[i], "="+values[i], "", true);
}
if(peramitors.find("hora")!=-1)
{
hora=string_to_number(values[peramitors.find("hora")]);
}
if(peramitors.find("minuto")!=-1)
{
minuto=string_to_number(values[peramitors.find("minuto")]);
}
if(peramitors.find("peak")!=-1)
{
peak=string_to_number(values[peramitors.find("peak")]);
}
if(peramitors.find("votos2d")!=-1)
{
votos2d=string_to_number(values[peramitors.find("votos2d")]);
}
if(peramitors.find("votos3d")!=-1)
{
votos3d=string_to_number(values[peramitors.find("votos3d")]);
}
if(peramitors.find("msalvar")!=-1)
{
msalvar=values[peramitors.find("msalvar")];
}
if(peramitors.find("month")!=-1)
{
month=string_to_number(values[peramitors.find("month")]);
}
if(peramitors.find("day")!=-1)
{
day=string_to_number(values[peramitors.find("day")]);
}
if(peramitors.find("year")!=-1)
{
year=string_to_number(values[peramitors.find("year")]);
}
if(peramitors.find("objtime")!=-1)
{
objtime=string_to_number(values[peramitors.find("objtime")]);
}
if(peramitors.find("andar1")!=-1)
{
andar1=string_to_number(values[peramitors.find("andar1")]);
}
if(peramitors.find("andar2")!=-1)
{
andar2=string_to_number(values[peramitors.find("andar2")]);
}
if(peramitors.find("andar3")!=-1)
{
andar3=string_to_number(values[peramitors.find("andar3")]);
}
if(peramitors.find("andar4")!=-1)
{
andar4=string_to_number(values[peramitors.find("andar4")]);
}
if(peramitors.find("andar5")!=-1)
{
andar5=string_to_number(values[peramitors.find("andar5")]);
}
if(peramitors.find("andar6")!=-1)
{
andar6=string_to_number(values[peramitors.find("andar6")]);
}
if(peramitors.find("andar7")!=-1)
{
andar7=string_to_number(values[peramitors.find("andar7")]);
}
if(peramitors.find("andar8")!=-1)
{
andar8=string_to_number(values[peramitors.find("andar8")]);
}
if(peramitors.find("andar9")!=-1)
{
andar9=string_to_number(values[peramitors.find("andar9")]);
}
if(peramitors.find("andar10")!=-1)
{
andar10=string_to_number(values[peramitors.find("andar10")]);
}
if(peramitors.find("andar11")!=-1)andar11=string_to_number(values[peramitors.find("andar11")]);
if(peramitors.find("andar12")!=-1)andar12=string_to_number(values[peramitors.find("andar12")]);
if(peramitors.find("andar13")!=-1)andar13=string_to_number(values[peramitors.find("andar13")]);
if(peramitors.find("andar14")!=-1)andar14=string_to_number(values[peramitors.find("andar14")]);
if(peramitors.find("andar15")!=-1)andar15=string_to_number(values[peramitors.find("andar15")]);
if(peramitors.find("andar16")!=-1)andar16=string_to_number(values[peramitors.find("andar16")]);
if(peramitors.find("andar17")!=-1)andar17=string_to_number(values[peramitors.find("andar17")]);
if(peramitors.find("andar18")!=-1)andar18=string_to_number(values[peramitors.find("andar18")]);
if(peramitors.find("andar19")!=-1)andar19=string_to_number(values[peramitors.find("andar19")]);
if(peramitors.find("andar20")!=-1)andar20=string_to_number(values[peramitors.find("andar20")]);
if(peramitors.find("andar21")!=-1)andar21=string_to_number(values[peramitors.find("andar21")]);
if(peramitors.find("andar22")!=-1)andar22=string_to_number(values[peramitors.find("andar22")]);
if(peramitors.find("andar23")!=-1)andar23=string_to_number(values[peramitors.find("andar23")]);
if(peramitors.find("andar24")!=-1)andar24=string_to_number(values[peramitors.find("andar24")]);
if(peramitors.find("andar25")!=-1)andar25=string_to_number(values[peramitors.find("andar25")]);
if(peramitors.find("andar26")!=-1)andar26=string_to_number(values[peramitors.find("andar26")]);
if(peramitors.find("andar27")!=-1)andar27=string_to_number(values[peramitors.find("andar27")]);
if(peramitors.find("andar28")!=-1)andar28=string_to_number(values[peramitors.find("andar28")]);
if(peramitors.find("andar29")!=-1)andar29=string_to_number(values[peramitors.find("andar29")]);
if(peramitors.find("andar30")!=-1)andar30=string_to_number(values[peramitors.find("andar30")]);
if(peramitors.find("andar31")!=-1)andar31=string_to_number(values[peramitors.find("andar31")]);
if(peramitors.find("andar32")!=-1)andar32=string_to_number(values[peramitors.find("andar32")]);
if(peramitors.find("andar33")!=-1)andar33=string_to_number(values[peramitors.find("andar33")]);
if(peramitors.find("andar34")!=-1)andar34=string_to_number(values[peramitors.find("andar34")]);
if(peramitors.find("andar35")!=-1)andar35=string_to_number(values[peramitors.find("andar35")]);
if(peramitors.find("andar36")!=-1)andar36=string_to_number(values[peramitors.find("andar36")]);
if(peramitors.find("andar37")!=-1)andar37=string_to_number(values[peramitors.find("andar37")]);
if(peramitors.find("andar38")!=-1)andar38=string_to_number(values[peramitors.find("andar38")]);
if(peramitors.find("andar39")!=-1)andar39=string_to_number(values[peramitors.find("andar39")]);
if(peramitors.find("andar40")!=-1)andar40=string_to_number(values[peramitors.find("andar40")]);
if(peramitors.find("andar41")!=-1)andar41=string_to_number(values[peramitors.find("andar41")]);
if(peramitors.find("andar42")!=-1)andar42=string_to_number(values[peramitors.find("andar42")]);
if(peramitors.find("andar43")!=-1)andar43=string_to_number(values[peramitors.find("andar43")]);
if(peramitors.find("andar44")!=-1)andar44=string_to_number(values[peramitors.find("andar44")]);
if(peramitors.find("andar45")!=-1)andar45=string_to_number(values[peramitors.find("andar45")]);
if(peramitors.find("andar46")!=-1)andar46=string_to_number(values[peramitors.find("andar46")]);
if(peramitors.find("andar47")!=-1)andar47=string_to_number(values[peramitors.find("andar47")]);
if(peramitors.find("andar48")!=-1)andar48=string_to_number(values[peramitors.find("andar48")]);
if(peramitors.find("andar49")!=-1)andar49=string_to_number(values[peramitors.find("andar49")]);
if(peramitors.find("andar50")!=-1)andar50=string_to_number(values[peramitors.find("andar50")]);
if(file_exists("mensagempt.txt")){
pr.open("mensagempt.txt","r");
msgpt=pr.read();
pr.close();
}
if(file_exists("mensagemen.txt")){
pr.open("mensagemen.txt","r");
msgen=pr.read();
pr.close();
}
if(file_exists("mensagemes.txt")){
pr.open("mensagemes.txt","r");
msges=pr.read();
pr.close();
}
if(file_exists("mensagemfr.txt")){
pr.open("mensagemfr.txt","r");
msgfr=pr.read();
pr.close();
}
string netth;
netth=net.setup_server(port, 4, 500);
net.set_bandwidth_limits(65536, 65536);
if(!directory_exists("maps"))
{
directory_create("maps");
}
if(port==2007){
show_game_window("Servidor de testes do "+GAME_NAME);
//maxobjs=0;
}
else{
show_game_window(wintext);
}
spawn_paje(random(20, 100), 0, "aldeia_indígena");
if(file_exists("servidor.reiniciado")){
file z;
z.open("servidor.reiniciado", "r");
string[] animais=string_split(z.read(), "\r\n", false);
z.close();
for(uint i=0;i<animais.length();i++){
string[] a=string_split(animais[i], " ", false);
if(a[0]=="semana")upw=string_to_number(a[1]);
if(a[0]=="dia")upd=string_to_number(a[1]);
if(a[0]=="hora")uph=string_to_number(a[1]);
if(a[0]=="minuto")upm=string_to_number(a[1]);
if(a[0]=="megadragonsauro")spawn_megadragonsauro(string_to_number(a[1]), string_to_number(a[2]), a[3], string_to_number(a[4]));
if(a[0]=="dragonsauro")spawn_dragonsauro(string_to_number(a[1]), string_to_number(a[2]), a[3], string_to_number(a[4]));
if(a[0]=="carroforte")colocar_cforte(string_to_number(a[1]), string_to_number(a[2]), a[3], string_to_number(a[4]));
if(a[0]=="helicoptero")spawn_helicoptero(string_to_number(a[1]), string_to_number(a[2]), a[3], string_to_number(a[4]));
}
file_delete("servidor.reiniciado");
}
tdragonsauro.force(900000);
turso.force(900000);
colocar_fonteagua(139, 0, "igreja");
colocar_fonteagua(139, 0, "igreja_de_los_angeles");
colocar_fonteagua(99, 0, "igreja_de_santa_bertalina");
colocar_fonteagua(25, 0, "praça_da_cidade");
spawnmaquinatempo(10, 0, "casa");
spawncomputador(2, 21, "apartamento", 1234, 0, 1, 0);
tcachorro.force(60000);
spawn_fogo(20, 5, "quarto_do_bruxo");
spawn_fogo(20, 5, "cozinha_do_bruxo");
spawn_fogo(60, 53, "casa_do_bruxo");
pr.open("servidor.banheiros", "r");
string[] b=string_split(pr.read(), "\r\n", false);
pr.close();
for(uint i=0;i<b.length();i++){
string[] bb=string_split(b[i], " ", false);
colocar_banheiro(string_to_number(bb[0]), string_to_number(bb[1]), bb[2]);
}
b.resize(0);
pr.open("servidor.pias", "r");
b=string_split(pr.read(), "\r\n", false);
pr.close();
for(uint i=0;i<b.length();i++){
string[] bb=string_split(b[i], " ", false);
colocar_pia(string_to_number(bb[0]), string_to_number(bb[1]), bb[2]);
}
string[] a=find_files("maps/*");
for(uint i=0;i<a.length();i++){
if(string_contains(a[i], "apartamento_", 1)>-1){
string m=string_replace(a[i], "apartamento_de_", "", false);
m=string_replace(m, ".map", "", false);
file z;
z.open("players_apartamentos/"+m+"_baú.usr", "r");
colocar_pia(16, 21, "apartamento_de_"+m);
colocar_banheiro(14, 21, "apartamento_de_"+m);
colocar_apartamento("apartamento_de_"+m, z.read());
z.close();
z.open("players_apartamentos/"+m+"_pc.usr", "r");
string[] b=string_split(z.read(), ";", false);
z.close();
if(b.length()>3)spawncomputador(2, 21, "apartamento_de_"+m, string_to_number(b[0]), string_to_number(b[1]), string_to_number(b[2]), string_to_number(b[3]));
else spawncomputador(2, 21, "apartamento_de_"+m, 0, 1, 1, 0);
}
}
novo_cavalo(50, 0, "mundo_medieval");
for(uint i=0;i<20;i++){
colocar_minaouro(random(1, 100), 0, "mina_de_ouro");
colocar_minaouro(1, 0, "test");
}
colocar_wall(80, "caverna");

for(uint i=0;i<5;i++){
colocar_pato(random(200, 400), 0, "pesqueiro");
}
string ss=spawn_moving_sound("maquinar.ogg", 200, 0, "mundo_futurista");
ccobra(random(60, 90), 0, "primeira_caverna");
ccobra(random(60, 90), 0, "segunda_caverna");
ccobra(random(60, 90), 0, "primeira_caverna");
ccobra(random(60, 90), 0, "terceira_caverna");
ccobra(random(60, 90), 0, "quarta_caverna");
ccobra(random(60, 90), 0, "quinta_caverna");
ccobra(random(60, 90), 0, "sexta_caverna");
ccobra(random(60, 90), 0, "sétima_caverna");
ccobra(random(60, 90), 0, "oitava_caverna");
ccobra(random(60, 90), 0, "nona_caverna");
ccobra(random(60, 90), 0, "déssima_caverna");
start_profiling();
while(true){
wait(5);
if (key_pressed(KEY_ESCAPE))
{
exit();
}
loops();
}
}
void loops(){
if(key_down(KEY_ESCAPE)){
writeprefs();
for(uint i=0;i<players.length();i++){
sconfigs(i);
}
generate_profile("log.log");
exit();
}
if(tempocaiu.length()>0)caiuloop();
if(bombadefogos.length()>0&&pvp)bombadefogoloop();
netloop();//add
if(bombaremotas.length()>0&&pvp)bombaremotaloop();
prensadeiraloop();
if(patos.length()>0)patoloop();
netloop();//add
if(maxbombas.length()>0&&pvp)maxbombaloop();
if(bombarelogios.length()>0&&pvp)bombarelogioloop();
netloop();//add
if(carrosfortes.length()>0)carroforteloop();
if(bombanucleares.length()>0)bombanuclearloop();
if(bombaatomicas.length()>0&&pvp)bombaatomicaloop();
netloop();//add
loops2();
if(zumbis.length()>=0)zumbiloop();
if(robo_coletores.length()>0)robo_coletorloop();
if(sequestrador2s.length()>0)sequestrador2loop();
netloop();//add
netloop();//add
coelholoop();
netloop();//add
cobraloop();
loops2();
if(players.length()>0)playerloop();
netloop();//add
vervida();
if(pajes.length()>0)pajeloop();
if(dardos.length()>0&&pvp)dardoloop();
if(dardosenvenenados.length()>0&&pvp)dardoenvenenadoloop();
if(dogs.length()>0)dogloop();
if(helicopteros.length()>0&&pvp)helicopteroloop();
netloop();//add
netloop();//add
if(boladefogos.length()>0)boladefogoloop();
if(fogosgrudados.length()>0)fogogrudadoloop();
if(objs.length()>0)objloop();
netloop();//add
outrosloop();
netloop();//add
netloop();//add
loops2();
if(walls.length()>0&&pvp)wallloop();
if(computadors.length()>0)computadorloop();
if(cavalos.length()>0)cavaloloop();
netloop();//add
if(pias.length()>0)pialoop();
if(cocos.length()>0)cocoloop();
if(fogoqueimars.length()>0)fogoqueimarloop();
if(fogos.length()>0&&chovendo==0)fogoloop();
netloop();//add
if(hcavernas.length()>0)hcavernaloop();
if(fitaexplosivas.length()>0&&pvp)fitaloop();
netloop();//add
if(bebesauros.length()>0&&pvp)bebesauroloop();
netloop();//add
if(lobos.length()>0&&pvp)loboloop();
if(guardasandar.length()>0)guardaandarloop();
netloop();//add
if(ratos.length()>0&&pvp)ratoloop();
if(tubaraos.length()>0&&pvp)tubaraoloop();
if(cachorros.length()>0&&pvp)cachorroloop();
if(macacos.length()>0&&pvp)macacoloop();
if(ursos.length()>0&&pvp)ursoloop();
if(dragonsauros.length()>0&&pvp)dragonsauroloop();
if(guardas.length()>0&&pvp)guardaloop();
if(sequestradors.length()>0&&pvp)sequestradorloop();
netloop();//add
netloop();//add
if(megadragonsauros.length()>0)megadragonsauroloop();
netloop();//add
netloop();//add
if(nban.length()>0){
string[] x;
for(uint i=0;i<nban.length();i++){
x=string_split(nban[i], " ", false);
if(string_contains(x[i], "hi", 1)<0){
if(string_to_number(x[1])>=TIME_HOUR&&string_to_number(x[2])<=TIME_MINUTE){
nban.remove_at(i);
}
}
}
}
}
void netloop(){
if(bullets.length()>0)bulletloop();
event=net.request();
if(event.type==event_disconnect){
int index=get_player_index(event.peer_id);
if(index>-1){
send_reliable(0, "msg2 A conexão de; "+players[index].charname+" ;caiu.", 0);
colocar_tempocair(players[index].charname);
send_reliable(0, "off "+players[index].charname+" 1 0", 0);
terminar(index, 0, 1);
}

net.disconnect_peer_forcefully(event.peer_id);
}
else if(event.type==event_receive and event.channel==0)
{
int index=get_player_index(event.peer_id);
string[] parsed=string_split(get_event_message()," ",true);
if(parsed[0]=="xt55"&&parsed.length()>4)create(parsed[1],parsed[2],parsed[3], string_to_number(parsed[4]), event.peer_id);
else if(parsed[0]=="h33j"&&parsed.length()>4)login(event.peer_id, parsed[1],parsed[2],string_to_number(parsed[3]),parsed[4]);
if(index>-1&&index<players.length){
if(parsed[0]=="a"&&pvp)atirar(index, string_to_number(parsed[1]), string_to_number(parsed[2]));
else if(parsed[0]=="a2"&&pvp)atirar2(index, string_to_number(parsed[1]), string_to_number(parsed[2]));
else if(parsed[0]=="close"){
int id=get_player_index(event.peer_id);
if(id>-1){
for(uint i=0;i<bombarelogios.length();i++){
if(bombarelogios[i].nome==players[id].charname)bombarelogios.remove_at(i);
}
for(uint i=0;i<bombaatomicas.length();i++){
if(bombaatomicas[i].nome==players[id].charname)bombaatomicas.remove_at(i);
}
for(uint i=0;i<bombaremotas.length();i++){
if(bombaremotas[i].nome==players[id].charname)bombaremotas.remove_at(i);
}
for(uint i=0;i<bombadefogos.length();i++){
if(bombadefogos[i].nome==players[id].charname){
destroy_splay(bombadefogos[i].spa);
bombadefogos.remove_at(i);
}
}
for(uint i=0;i<projeteis.length();i++){
if(projeteis[i].nome==players[id].charname){
destroy_moving_sound(projeteis[i].somprojetei);
projeteis.remove_at(i);
}
}
players[id].matou=0;
players[id].maxhealth=10000;
players[id].health=10000;
terminar(id, 1);
}
}
else if(parsed[0]=="getversion")getversion(index);
else if(parsed[0]=="ping")send_reliable(event.peer_id,"pong",0);
else if(parsed[0]=="s")players[index].insz=true;
else if(parsed[0]=="sn")players[index].insz=false;
else if(parsed[0]=="int"&&parsed.length()>2)iitem(index, parsed[1], parsed[2]);
else if(parsed[0]=="uitem"&&parsed.length()>1&&players[index].afk==false&&players[index].paralisado==false&&players[index].paralisado2==false&&gamestopped==false&&players[index].map!="túnel")usar(index, parsed[1]);
else if(parsed[0]=="retirar"&&parsed.length()>1)retirar(index, parsed[1]);
else if(parsed[0]=="missil"&&parsed.length()>1&&players[index].inv_item_number("míssil_teleguiado")>0){
int n=get_player_index_from(parsed[1]);
if(n<0)return;
if(players[n].pacifico==1||players[n].afk)return;
players[index].inv_add_item("míssil_teleguiado", -1);
cmissil(players[index].x, players[index].y, players[index].map, players[index].charname, players[n].charname);
}
else if(parsed[0]=="/vestindo")vestindo(index, true);
else if(parsed[0]=="comprarcasa")comprarcasa(index);
else if(parsed[0]=="/pacifista"&&players[index].afk==false){
players[index].atpacifistasegundos=29;
players[index].atpacifista=true;
players[index].atpacifistatempo.restart();
}
else if(parsed[0]=="/afk")afk(index);
else if(parsed[0]=="frasesbarra"&&parsed.length()>2)frasesbarra(index, string_to_number(parsed[1]), parsed[2]);
else if(parsed[0]=="idiomachat"&&parsed.length()>1)players[index].idiomachat=parsed[1];
else if(parsed[0]=="mtester" and parsed.length()>1){
string mapname=parsed[1];
if(file_exists("maps/"+mapname+".map"))changemap(mapname, index, 1, 0);
}
else if(parsed[0]=="sanimal"&&parsed.length()>2)sanimal(index, parsed);
else if(parsed[0]=="userefrigerante")u_bcurar(index, "refrigerante", string_to_number(parsed[1]));
else if(parsed[0]=="dpassos")players[index].ouvirpassos=0;
else if(parsed[0]=="ndor")players[index].mdor=0;
else if(parsed[0]=="smaquina"&&parsed.length()>1){
send_reliable(players[index].peer_id, "stopmoving", 0);
players[index].tmaquina.restart();
players[index].paralisado2=true;
send_reliable(players[index].peer_id, "ps maquinadotempo.ogg", 0);
if(parsed[1]=="-1"||parsed[1]==-1){
string[] maqs;
maqs.reserve(3);
maqs.insert_last("pré_história");
maqs.insert_last("casa");
maqs.insert_last("mundo_medieval");
parsed[1]=maqs[random(0, maqs.length()-1)];
}
players[index].dmaquina=parsed[1];
players[index].namaquina=1;
}
else if(parsed[0]=="imenu"&&players[index].afk==false&&players[index].paralisado==false&&players[index].paralisado2==false)imenu(index);
else if(parsed[0]=="zsa"&&parsed.length()>1)zsa1(index);
else if(parsed[0]=="chutad2"){
players[index].thack.restart();
send_reliable(players[index].peer_id, "stopmoving", 0);
}
else if(parsed[0]=="dep_r"){
int n=string_to_number(parsed[1]);
if(n<0)send_reliable(players[index].peer_id, "msgnormal Valor inválido.", 0);
else if(n>players[index].inv_item_number("reais"))send_reliable(players[index].peer_id, "msgnormal Você não tem todo esse dinheiro!", 0);
else{
players[index].inv_add_item("reais", -n);
send_reliable(players[index].peer_id, "msg2 Você deposita; ;"+n+"; ;reais.", 0);
players[index].saldo+=n;
}
}
else if(parsed[0]=="dep2_r"){
int n=string_to_number(parsed[1]);
if(n<0)send_reliable(players[index].peer_id, "msgnormal Valor inválido.", 0);
else if(n>players[index].inv_item_number("reais"))send_reliable(players[index].peer_id, "msgnormal Você não tem todo esse dinheiro!", 0);
else{
send_reliable(players[index].peer_id, "mtext Para qual conta o dinheiro será depositado?:dep3_r", 0);
players[index].vconta=n;
}
}
else if(parsed[0]=="dep3_r")dep3(index, parsed);
else if(parsed[0]=="sac_r"){
int n=string_to_number(parsed[1]);
if(n<=0)send_reliable(players[index].peer_id, "msgnormal Valor inválido.", 0);
else if(n>players[index].saldo)send_reliable(players[index].peer_id, "msgnormal Você não tem esse dinheiro depositado.", 0);
else{
players[index].inv_add_item("reais", n);
send_reliable(players[index].peer_id, "msg2 Você saca; ;"+n+"; ;reais.", 0);
players[index].saldo-=n;
}
}
else if(parsed[0]=="lc"&&players[index].afk==false)send_reliable(players[index].peer_id, "msg2 Você está no nível; "+players[index].level+", ;e na patente; ;"+string_trim_right(players[index].title, 1)+";. ;Você está com; ;"+players[index].nsede+"% ;de sede;, "+players[index].nfome+"% ;de fome,; ;"+players[index].sujo+"% ;suj"+players[index].sexo2+", e; ;"+players[index].doente+"% ;doente.", 0);
else if(parsed[0]=="papartamento"&&parsed.length()>2){
bool tem=false;
for(uint i=0;i<apartamentos.length();i++){
if(apartamentos[i].map==players[index].map){
if(apartamentos[i].inv_item_number(parsed[1])>=string_to_number(parsed[2])){
players[index].inv_add_item(parsed[1], string_to_number(parsed[2]));
apartamentos[i].inv_add_item(parsed[1], -string_to_number(parsed[2]));
tem=true;
}
}
}
if(tem==true)send_packet(0, "play pegou_depósito.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(parsed[0]=="mudcod"&&parsed.length()>1){
int cod=string_to_number(parsed[1]);
if(cod>9999||cod<1000){
send_reliable(players[index].peer_id, "msgnormal Código não permitido. O número tem que ser de 1000 à 9999.", 0);
return;
}
bool tem=false;
for(uint i=0;i<computadors.length();i++){
if(computadors[i].map==players[index].map){
tem=true;
computadors[i].codcasa=cod;
break;
}
}
if(tem==true)send_reliable(players[index].peer_id, "msgnormal Código de acesso alterado.", 0);
else send_reliable(players[index].peer_id, "msgnormal Nenhum computador por perto.", 0);
}
else if(parsed[0]=="mcodigo2"&&parsed.length()>1){
int cod=string_to_number(parsed[1]);
if(cod>9999||cod<1000){
send_reliable(players[index].peer_id, "msgnormal Código não permitido. O número tem que ser de 1000 à 9999.", 0);
return;
}
bool tem=false;
for(uint i=0;i<computadors.length();i++){
string t=string_replace(computadors[i].map, "apartamento_de_", "", false);
if(t==players[index].charname){
tem=true;
computadors[i].codcasa=cod;
break;
}
}
if(tem==true)send_reliable(players[index].peer_id, "msgnormal Código de acesso alterado.", 0);
else send_reliable(players[index].peer_id, "msgnormal Nenhum computador por perto.", 0);
}
else if(parsed[0]=="opc"&&parsed.length()>2)opc(index, parsed);
else if(parsed[0]=="pc")pc(index);
else if(parsed[0]=="fbaú"){
for(uint i=0;i<computadors.length();i++){
if(players[index].map==computadors[i].map){
computadors[i].fbau=0;
}
}
}
else if(parsed[0]=="imprimir"&&parsed.length()>1){
string nome="Folheto_de_"+players[index].charname;
for(uint i=0;i<desc.length();i++){
string[] a=string_split(desc[i], ";", false);
if(a[0]==nome)desc.remove_at(i);
}
desc.insert_last(nome+";"+string_replace(get_event_message(), parsed[0]+" ", "", false));
if(players[index].inv_item_number(nome)<=0)players[index].inv_add_item(nome, 1);
send_packet(0, "play impressora.ogg 1 26", players[index].map);
players[index].tmaquina.restart();
}
else if(parsed[0]=="eapartamento"&&parsed.length()>1)eapartamento(index, parsed);
else if(parsed[0]=="r"){
bool achou=false;
string a="Você avista:;";
for (int i=players[index].x-12; i<=players[index].x+12; i++){
for(uint i2=0;i2<walls.length();i2++){
if(walls[i2].x==i&&walls[i2].map==players[index].map){
a+=" ;Parede;, ;com; "+walls[i2].vida+"; ;de vida.";
achou=true;
}
}
for(uint i2=0;i2<megadragonsauros.length();i2++){
if(megadragonsauros[i2].x==i&&megadragonsauros[i2].map==players[index].map){
a+=" ;mega;dragonsauro;, ;com; "+megadragonsauros[i2].vida+"; ;de vida.";
achou=true;
}
}
}
if(achou==false)send_reliable(players[index].peer_id, "msgnormal Nada por perto.", 0);
else if(achou==true)send_reliable(players[index].peer_id, "msg2 "+a, 0);
}
else if(parsed[0]=="whoonline") whoonline(index);
else if(parsed[0]=="adm"&&parsed.length()>1){
string mensagem="msg2 adm "+players[index].charname+"; ;diz:; "+string_replace(get_event_message(), parsed[0]+" ", "", false);
string mensagemmod="msg2 mod "+players[index].charname+"; ;diz:; "+string_replace(get_event_message(), parsed[0]+" ", "", false);
for(uint i=0;i<players.length();i++){
if(players[i].is_admin()==true){
send_reliable(players[i].peer_id, "ps notifybleep.ogg", 0);
send_reliable(players[i].peer_id, mensagem, 0);
}
if(players[i].moderador==true){
send_reliable(players[i].peer_id, "ps notifybleep.ogg", 0);
send_reliable(players[i].peer_id, mensagemmod, 0);
}
}
}
else if(parsed[0]=="morreu"&&players[index].map!="túnel")morreu(index, parsed);
else if(parsed[0]=="sugador"&&players[index].inv_item_number("sugador")>0&&parsed.length()>2&&players[index].afk==false&&players[index].paralisado==false&&players[index].paralisado2==false&&players[index].map!="túnel"&&players[index].insz==false&&players[index].tsugando.elapsed<=0&&players[index].pacifico==0&&players[index].level>200&&pvp){
if(parsed[1]=="-1")return;
int i=get_player_index_from(parsed[2]);
if(i>-1){
if(get_player_distance(players[index], players[i])>-1&&get_player_distance(players[index], players[i])<=2&&!emequipe(players[index].charname, players[i].charname)&&players[i].level>200){
send_reliable(players[i].peer_id, "stopmoving", 0);
send_reliable(players[index].peer_id, "stopmoving", 0);
send_packet(0, "play sugador.ogg "+players[index].x+" "+players[index].y, players[index].map);
players[index].tsugando.restart();
players[index].inv_add_item("sugador", -1);
players[index].nsugador=players[i].charname;
players[index].sugando=parsed[1];
if(string_contains(parsed[1], "vida", 1)>-1){
send_packet(0, "play svida.ogg "+players[index].x+" "+players[index].y, players[index].map);
players[index].tsvida.restart();
}
else if(string_contains(parsed[1], "itens", 1)>-1){
send_packet(0, "play si.ogg "+players[index].x+" "+players[index].y, players[index].map);
players[index].tsitem.restart();
}
}
}
}
else if(parsed[0]=="cpassagemo"&&parsed.length()>1){
if(players[index].inv_item_number("reais")<3){
send_reliable(players[index].peer_id, "msgvocênãotem2 3 reais", 0);
}
else{
players[index].inv_add_item("reais", -3);
send_reliable(players[index].peer_id, "msgentrega 3 reais "+parsed[1], 0);
players[index].inv_add_item(parsed[1], 1);
}
}
else if(parsed[0]=="cpassagemporto"&&parsed.length()>1){
if(players[index].inv_item_number("reais")<10){
send_reliable(players[index].peer_id, "msgvocênãotem2 10 reais", 0);
}
else{
players[index].inv_add_item("reais", -10);
send_reliable(players[index].peer_id, "msgentrega 10 reais "+parsed[1], 0);
players[index].inv_add_item(parsed[1], 1);
}
}
else if(parsed[0]=="olhar"&&parsed.length()>1){
int n=get_player_index_from(parsed[1]);
if(n>-1){
players[index].vmap=players[index].map;
players[index].vx=players[index].x;
players[index].vy=players[index].y;
players[index].vinvs=players[index].invs;
players[index].vbipar=players[index].bipar;
players[index].invs=1;
players[index].bipar=0;
send_reliable(0,"playerbeep "+players[index].charname+" "+players[index].bipar, 0);
changemap(players[n].map, index, players[n].x, players[n].y, "moveu.ogg");
players[index].insz=true;
}
}
else if(parsed[0]=="volhar"){
players[index].x=players[index].vx;
players[index].y=players[index].vy;
players[index].invs=players[index].vinvs;
players[index].bipar=players[index].vbipar;
changemap(players[index].vmap, index, players[index].x, players[index].y, "moveu.ogg");
send_reliable(0,"playerbeep "+players[index].charname+" "+players[index].bipar, 0);
players[index].vmap="";
}
else if(parsed[0]=="gbonus"){
string[] it;
it.insert_last("foguete");
it.insert_last("fita_explosiva");
it.insert_last("míssil");
it.insert_last("sugador");
it.insert_last("dardo");
it.insert_last("bomba_relógio");
it.insert_last("refrigerante");
it.insert_last("granada");
it.insert_last("molotov");
players[index].inv_add_item(it[random(0, it.length()-1)], random(10, 20));
}
else if(parsed[0]=="vbonus"){
string m=players[index].map;
players[index].map="";
changemap(m, index, players[index].x, players[index].y);
}
else if(parsed[0]=="nnivel")players[index].avisanivel=0;
else if(parsed[0]=="ld"&&parsed.length()>1){
int d=string_to_number(parsed[1]);
if(d==1){
if(players[index].inv_item_number("dardo")>0){
players[index].inv_add_item("dardo", -1);
spawn_dardo(players[index].x, players[index].y, players[index].map, players[index].charname, 10);
}
}
else if(d==2){
if(players[index].inv_item_number("dardo_envenenado")>0){
players[index].inv_add_item("dardo_envenenado", -1);
spawn_dardoenvenenado(players[index].x, players[index].y, players[index].map, players[index].charname, 10);
}
}
}
else if(parsed[0]=="lancha"){
string d=parsed[1];
if(d=="d"){
destroy_moving_sound(players[index].starsoundid);
players[index].starsoundid="";
send_reliable(players[index].peer_id, "lanchaid2", 0);
send_packetn(0, players[index].charname, "play lanchad.ogg "+players[index].x+" "+players[index].y, players[index].map);
players[index].nalancha=0;
}
else if(d=="n")players[index].nalancha=1;
else if(d=="s"){
string nome=pegarlancha(index);
if(nome!=""){
file f;
f.open("lanchas/"+nome+".md", "r");
send_reliable(players[index].peer_id, "msg2 Você vê no mostrador:; ;Gasolina;, "+f.read()+" ;porcento;.", 0);
f.close();
}
}
else if(d=="l"){
destroy_moving_sound(players[index].starsoundid);
players[index].starsoundid=spawn_moving_sound("lanchal.ogg", players[index].x, players[index].y, players[index].map);
players[index].nalancha=1;
}
else if(d=="ll"){
destroy_moving_sound(players[index].starsoundid);
players[index].starsoundid=spawn_moving_sound("lanchaloop.ogg", players[index].x, players[index].y, players[index].map);
send_reliable(players[index].peer_id, "lanchaid "+players[index].starsoundid, 0);
}
}
else if(parsed[0]=="j1"&&parsed.length()>1){
int id=get_player_index_from(parsed[1]);
if(id>-1){
string m="em "+players[id].map;
if(m=="ciudade_méxico"||m=="ciudade_méxico2")m="na; ;cidade de Belick";
else if(string_contains(m, "monterrey", 1)>-1||string_contains(m, "monterrey2", 1)>-1)m="na; ;cidade_de_méxico";
else if(string_contains(m, "medieval", 1)>-1)m="no; ;mundo medieval";
else if(string_contains(m, "trem", 1)>-1||string_contains(m, "ônibus", 1)>-1||string_contains(m, "avião", 1)>-1||string_contains(m, "transatlântico", 1)>-1||m=="máquina_do_tempo")m="viajando";
else if(string_contains(m, "quadro", 1)>-1)m="procurando emprego";
send_reliable(players[index].peer_id, "msg2 "+players[id].charname+" ;está; ;"+m+";.", 0);
}
else send_reliable(players[index].peer_id, "msgnormal Jogador não encontrado.", 0);
}
else if(parsed[0]=="j2"&&parsed.length()>1){
int id=get_player_index_from(parsed[1]);
if(id>-1)send_reliable(players[index].peer_id, "msg2 "+players[id].charname+" ;está no nível; "+players[id].level+", ;e na patente; ;"+string_trim_right(players[id].title, 1)+";.", 0);
else send_reliable(players[index].peer_id, "msgnormal Jogador não encontrado.", 0);
}
else if(parsed[0]=="j3"&&parsed.length()>1){
int id=get_player_index_from(parsed[1]);
if(id>-1){
string m="";
int a=players[id].matou;
if(a==0)m=players[id].charname+" ;não matou ninguém";
else if(a==1)m=players[id].charname+" ;matou apenas uma pessoa";
else if(a==2)m=players[id].charname+" ;matou duas pessoas";
else if(a>2&&a<30)m=players[id].charname+" ;arrebentou; "+a+" ;pessoas";
else if(a>=30&&a<100)m=players[id].charname+" ;estourou; "+a+" ;pessoas";
else if(a>=100&&a<200)m=players[id].charname+" ;degolou; "+a+" ;pessoas";
else if(a>=200)m=a+" ;pessoas não tiveram conhecimento de; "+players[id].charname;
send_reliable(players[index].peer_id, "msg2 "+m+";.", 0);
}
else send_reliable(players[index].peer_id, "msgnormal Jogador não encontrado.", 0);
}
else if(parsed[0]=="j4"&&parsed.length()>1){
int id=get_player_index_from(parsed[1]);
if(id>-1){
string dd=players[id].idiomachat;
string d;
if(dd=="ar")d="Árabe";
else if(dd=="en")d="Inglês";
else if(dd=="es")d="Español";
else if(dd=="fr")d="Francês";
else if(dd=="pt")d="Português";
if(dd=="Desativado")send_reliable(players[index].peer_id, "msg2 "+players[id].charname+" ;está com o chat desativado.", 0);
else send_reliable(players[index].peer_id, "msg2 "+players[id].charname+" ;está; ;no chat; ;"+d+";.", 0);
}
}
else if(parsed[0]=="/falarnomapa" and parsed.length()>=1)
{
if(players[index].naoitens==1)
{
send_reliable(players[index].peer_id, "msgestecanal", 0);
}
else if(players[index].afk&&players[index].is_admin()==false)return;
else
{
string message=get_event_message();
message=string_replace(message,"/falarnomapa ","",true);
if(players[index].map=="túnel")message=msmorte[random(0, msmorte.length()-1)];
for(int i=players[index].x-15;i<=players[index].x+15;i++){
for (uint i2=0;i2<players.length();i2++){
if (players[i2].x==i&&players[i2].map==players[index].map&&!players[i2].has_muted(players[index].charname)){
if(players[index].invs==1) send_reliable(players[i2].peer_id,"fm "+players[index].title+" Alguém sussurra: "+message, 0);
else send_reliable(players[i2].peer_id,"fm "+players[index].title+" "+players[index].charname+" diz: "+message, 0);
}
}
}
}
}
else if(parsed[0]=="tirarpassaporte"&&players[index].passaporte==0){
if(players[index].inv_item_number("coins")>30000){
players[index].inv_add_item("coins", -30000);
send_reliable(players[index].peer_id, "msgsublinhado Você_entrega 30000 e_recebe_seu_passaporte.", 0);
players[index].passaporte=1;
}
else{
send_reliable(players[index].peer_id, "msgvocênãotem2 30000 coins", 0);
}
}
else if(parsed[0]=="terminouafogando")
{
players[index].deaths+=1;
if(players[index].sexo==0) send_reliable(0, "msgafogada "+players[index].charname, 0);
else if(players[index].sexo==1) send_reliable(0, "msgdepois "+players[index].charname+" morreu afogado!", 0);
changemap(mapainicial, index, 1, 10);
send_reliable(players[index].peer_id,"morreu",0);
}
else if(parsed[0]=="congelou")
{
players[index].deaths+=1;
if(players[index].sexo==0)send_reliable(0, "msgcongelada "+players[index].charname, 3);
else if(players[index].sexo==1)send_reliable(0, "msgcongelado "+players[index].charname, 3);
if (players[index].inv_item_exists("perna_quebrada"))
players[index].inv_add_item("perna_quebrada", 0-players[index].inv_item_number("perna_quebrada"));
changemap(mapainicial, index, 1, 10);
send_reliable(players[index].peer_id,"morreu",0);
}
else if(parsed[0]=="enter")enter(index);
else if(parsed[0]=="enter2"){
for (uint i=0; i<objs.length(); i++){
if  (objs[i].x==players[index].x and objs[i].y==players[index].y and objs[i].map==players[index].map){
if(objs[i].obtainable){
send_packet(0,"getobj "+objs[i].x+" "+objs[i].y,objs[i].map);
objs[i].get(index);
objs.remove_at(i);
}
}
}
}
else if(parsed[0]=="nv"&&players[index].inv_item_number("varinha")>0)send_reliable(players[index].peer_id, "msg2 "+players[index].nvarinha+"% ;da energia de sua; ;varinha; ;carregada;.", 0);
else if(parsed[0]=="usemagnet"&&parsed.length==2&&players[index].inv_item_number("item_magnético")>0&&players[index].omtimer.elapsed>10000&&string_to_number(parsed[1])!=0&&players[index].insz==false)
{
send_reliable(players[index].peer_id, "msgmagnetiniciado", 0);
spawn_item_magnetico(players[index].x,players[index].y,string_to_number(parsed[1]),players[index].map,players[index].charname);
players[index].omtimer.restart();
players[index].inv_add_item("item_magnético",-1);
}
else if(parsed[0]=="varinha"&&players[index].inv_item_number("varinha")>0){
if(players[index].map=="castelo_medieval"||string_contains(players[index].map, "prisão", 1)>-1){send_reliable(players[index].peer_id, "msgnormal Esse lugar, vai muito mais além do real, surreal, sólido e líquido para usar sua varinha.", 0);return;}
else if(players[index].nvarinha<10){send_reliable(players[index].peer_id, "msgnormal Sua varinha ainda está sendo carregada.", 0);return;}
string[] spells;
int m=players[index].inv_item_number("mana");
int mm=players[index].nvarinha;
if(m>=10&&mm>=50)spells.insert_last("campo_magnético: Deixa você imune à balas por 27 segundos.");
if(m>=40&&mm>=50)spells.insert_last("espelho_refletor: Um espelho formará em sua frente, confundindo os seus inimigos.");
if(m>=5&&mm>=20)spells.insert_last("deslize_veloz: Faz com que você se movimente muito mais rápido por um tempo.");
if(m>=1&&mm>=50)spells.insert_last("calor_reprimido: Deixa você imune ao fogo por 30 segundos.");
if(m>=1&&mm>=50)spells.insert_last("bolha_de_ar: Faz com que você não se afogue por 30 segundos.");
if(players[index].map!="desafio_constante"&&players[index].map!="zona_de_segurança"&&m>=6&&mm>=75)spells.insert_last("cloak_start: habilita sua capa de invisibilidade");
if(m>=1&&mm>=100)spells.insert_last("float: te permite flutuar pelos ares");
if(m>=2&&mm>=15)spells.insert_last("superjump: te consede a habilidade de pular muito alto por um certo tempo");
if(players[index].pacifico==0&&players[index].insz==false){
if(players[index].achuva==false&&m>=150&&mm>=100)spells.insert_last("chuva_de_meteoros: Causa uma enorme destruição no mundo, com pedras caindo do alto.");
if(m>=4&&mm>=20)spells.insert_last("electrobomb: eletrocuta qualquer pessoa em uma faixa de alcance, causando um pequeno dano");
if(m>=6&&mm>=10)spells.insert_last("punho_de_hórus: Punho de Hórus matou Set, seu pior inimigo. Talvez esta magia seja tão poderosa, à ponto de realizar este feito novamente...");
if(m>=8&&mm>=40)spells.insert_last("thunder: atinge o jogador mais próximo com um raio, causando um grande dano.");
if(m>=10&&mm>=50)spells.insert_last("bola_de_fogo: Acerta o jogador mais próximo no lado que você está virado, causando uma grande destruição em chamas.");
}
if(m>=10&&mm>=10)spells.insert_last("cura_divina: Você vai em direção aos céus, pedindo por mais forças e ganha uma recompensa por sua fé.");
if(spells.length()>0)send_reliable(event.peer_id,"spellslist "+linear(spells),0);
}
else if(parsed[0]=="spellcast"&&parsed.length>2&&players[index].map!=mapainicial){
string[] spells2;
spells2.insert_last("bola_de_fogo:10:50");
spells2.insert_last("bolha_de_ar:1:50");
spells2.insert_last("calor_reprimido:1:50");
spells2.insert_last("campo_magnético:10:50");
spells2.insert_last("chuva_de_meteoros:200:100");
spells2.insert_last("deslize_veloz:5:20");
spells2.insert_last("cura_divina:10:10");
spells2.insert_last("espelho_refletor:40:50");
spells2.insert_last("punho_de_hórus:15:10");
spells2.insert_last("cloak_start:6:75");
spells2.insert_last("electrobomb:4:20");
spells2.insert_last("float:1:100");
spells2.insert_last("superjump:1:15");
spells2.insert_last("thunder:8:40");
int m=players[index].inv_item_number("mana");
for(uint i=0;i<spells2.length();i++){
string[] mm=string_split(spells2[i], ":", false);
if(mm[0]==parsed[1]){
if(m<string_to_number(mm[1])||players[index].nvarinha<string_to_number(mm[2]))send_packet(0,"play spellfail.ogg "+players[index].x+" "+players[index].y,players[index].map);
else{
players[index].inv_add_item("mana",-string_to_number(mm[1]));
players[index].nvarinha-=string_to_number(mm[2]);
players[index].lado=string_to_number(parsed[2]);
players[index].castingtimer.restart();
players[index].casttimer.restart();
players[index].casting=true;
players[index].curspell=parsed[1];
}
break;
}
}
}
else if(parsed[0]=="usetele"&&parsed.length()>1&&players[index].inv_item_number("teleporter")>0&&players[index].telestage==0&&players[index].afk==false&&players[index].paralisado==false&&players[index].paralisado2==false&&gamestopped==false&&players[index].map!="túnel"){
if(parsed[1]=="voltar")return;
if(players[index].teletimer.elapsed<30000) send_packet(0,"play teleporter_fail.ogg "+players[index].x+" "+players[index].y,players[index].map);
else if(players[index].inv_item_number("areia_da_montanha")>0) send_reliable(players[index].peer_id, "msgnormal Algo mágico que está com você te empede de fazer isso...", 0);
else if(players[index].map=="prisão"||players[index].map=="prisão2")send_reliable(players[index].peer_id, "msgnormal Mas você está preso!", 0);
else
{
players[index].telemap=parsed[1];
players[index].teletimer.restart();
players[index].telestagetimer.restart();
players[index].telestage=1;
send_reliable(players[index].peer_id,"stopmoving",0);
players[index].y+=5;
send_reliable(players[index].peer_id,"move "+players[index].x+" "+players[index].y,0);
send_packet(0,"upl "+players[index].charname+" "+players[index].x+" "	+players[index].y+" "+players[index].map,players[index].map);
players[index].tfid=spawn_moving_sound("teleporter_field.ogg",players[index].x,players[index].y,players[index].map);
send_packet(0,"play teleporter_fieldstart.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].inv_add_item("teleporter",-1);
}
}
else if(parsed[0]=="setvoice")players[index].voice=string_to_number(parsed[1]);
else if(parsed[0]=="give"&&parsed.length()>3&&players[index].afk==false&&players[index].paralisado==false&&players[index].paralisado2==false&&gamestopped==false)give(index, parsed);
else if(parsed[0]=="turn"&&parsed.length()>1){
string msg;
msg="turn.ogg "+players[index].x+" "+players[index].y;
send_packet10(0, players[index].charname, players[index].charname, msg, players[index].map);
}
/*
else if(parsed[0]=="store" and parsed.length()>=1)
{
string store="store ";
for (uint i=0; i<items.length(); i++)
{
store+=items[i]+" for "+amounts[i]+" coins\r\n";
}
if(items.length()==0){
send_reliable(players[index].peer_id, "Não tem nenhum item disponível nesta loja.",0);
}
else{
send_reliable(event.peer_id,store,0);
}
}
*/
else if(parsed[0]=="jump")
{
players[index].jumping=1;
if(!players[index].cloakhiding&&players[index].invs==0){
for(uint i=0;i<players.length();i++){
if(players[i].ouvirpassos==1&&players[i].map==players[index].map)send_reliable(players[i].peer_id, "jumping "+players[index].charname+" "+players[index].x+" "+players[index].y+" "+players[index].map, 0);
}
}
}
else if(parsed[0]=="land"&&parsed.length()>1){
int fallheight=string_to_number(parsed[1]);
if (fallheight>=20){
players[index].health-=random(100,200)*(fallheight);
send_packet(0,"inithurt "+players[index].voice+" "+players[index].x+" "+players[index].y, players[index].map);
if (players[index].health<=0){
int a=random(1, 2);
if(a==1) send_reliable(0, "msgdepois "+players[index].charname+" estoura sua coluna ao cair e bater com muita força no chão.", 3);
else if(a==2) send_reliable(0,"msgdepois "+ players[index].charname+" quebra sua perna ao cair de lado e atingir o chão com um estrondo horrível!", 3);
players[index].health=players[index].maxhealth;
changemap(mapainicial, index, 1, 10);
players[index].lasthit="";
players[index].inv_add_item("areia_da_montanha", -1);
}
}
players[index].jumping=0;
if(players[index].invs==0&&!players[index].cloakhiding){
for(uint i=0;i<players.length();i++){
if(players[i].ouvirpassos==1&&players[i].map==players[index].map)send_reliable(players[i].peer_id, "land "+players[index].charname+" "+players[index].x+" "+players[index].y+" "+players[index].map+" "+fallheight, 0);
}
}
}
else if(parsed[0]=="drop"&&parsed.length()>=3&&players[index].paralisado==false&&players[index].paralisado2==false)drop(index, string_to_number(parsed[1]), parsed[2]);
else if(parsed[0]=="move")move(index, string_to_number(parsed[1]), string_to_number(parsed[2]));
else if(parsed[0]=="move2")move(index, string_to_number(parsed[1]), string_to_number(parsed[2]));
else if(parsed[0]=="move3")move(index, string_to_number(parsed[1]), string_to_number(parsed[2]), 0, 1);
else if(parsed[0]=="movebicicleta")move(index, string_to_number(parsed[1]), string_to_number(parsed[2]), 1);
else if(parsed[0]=="healthcheck")send_reliable(players[index].peer_id, players[index].health+"/"+players[index].maxhealth,0);
else if(parsed[0]=="carregar"&&parsed.length()>1){
players[index].tarma=parsed[1];
send_packet10(0, players[index].charname, players[index].charname, parsed[1]+" "+players[index].x+" "+players[index].y, players[index].map);
string[] invsec;
if(players[index].inv_item_number("vara_de_pesca")>0)invsec.insert_last("vara_de_pesca");
if(players[index].inv_item_number("galão_de_gasolina")>0)invsec.insert_last("galão_de_gasolina");
if(players[index].inv_item_number("dardo")>0)invsec.insert_last("dardo");
if(players[index].inv_item_number("dardo_envenenado")>0)invsec.insert_last("dardo_envenenado");
if(invsec.length()>0)send_reliable(players[index].peer_id, "invsec "+linear(invsec), 0);
send_reliable(players[index].peer_id,"inv "+players[index].inv,0);
}
else if(parsed[0]=="playsocial" and parsed.length()>1)send_packet10(0, players[index].charname, players[index].charname, parsed[1]+" "+players[index].x+" "+players[index].y, players[index].map);
else if(parsed[0]=="draw"&&parsed.length()>1&&players[index].invs==0){
players[index].draw=parsed[1];
players[index].tarma=parsed[1];
string msg="draw "+players[index].charname+" "+parsed[1]+" "+players[index].x+" "+players[index].y+" "+players[index].map;
send_packet(0,msg,players[index].map);
if(parsed[1]=="levantar.ogg")players[index].centado=false;
if(parsed[1]=="centar.ogg")players[index].centado=true;
}
else if(parsed[0]=="getmotd"){
string ms="motd2 ";
if(players[index].idiomachat=="pt")ms+=msgpt;
else if(players[index].idiomachat=="en")ms+=msgen;
else if(players[index].idiomachat=="es")ms+=msges;
else if(players[index].idiomachat=="fr")ms+=msgfr;
send_reliable(players[index].peer_id, ms, 0);
}
else if (parsed[0]=="uptime")ctime(index);
}
}
else if(event.type==event_receive&&event.channel==1)
{
bool parse=true;
string sendmes;
bool willsend=true;
string message=get_event_message();
int index=get_player_index(event.peer_id);
if(index<0)
{
return;
}
else if(index>-1)
{
if(players[index].naoitens==1||message.length()<=0||players[index].afk==true&&players[index].is_admin()==false||string_contains(players[index].map, "prisão", 1)>-1&&players[index].is_admin()==false||message[0]!="/"&&message.length()>6000)return;
string msg=message;
msg=string_replace(msg, "\r\n", "", true);
msg=string_replace(msg, " ", "", true);
msg=string_to_lower_case(msg);
if(string_contains(msg, ".com", 1)>-1||string_contains(msg, ".net", 1)>-1||string_contains(msg, ".br", 1)>-1){
if(players[index].is_admin()==false)return;
}
}
if(message[0]==";"){
send_reliable(players[index].peer_id, "msgnormal Coloque o / primeiro!", 0);
return;
}
if(players[index].map=="tribunal"||players[index].map=="prisão2"){send_reliable(players[index].peer_id, "msgnormal As paredes absorvem suas palavras...", 0);return;}
if(players[index].invs==1) sendmes=players[index].charname+" "+players[index].title+" Alguém diz: "+bell+message;
else sendmes=players[index].charname+" "+players[index].title+" "+players[index].charname+" diz: "+bell+message;
parse=true;
if (message.length()>0)
{
if(message[0]=="/"&&parse==true&&message.length()>1)
{
willsend=false;
if(players[index].is_admin()){
string diaatual;
if(DATE_WEEKDAY_NAME=="Sunday")//Se for Domingo
{
diaatual="Domingo";//Dia escrito no Brasil
}
if(DATE_WEEKDAY_NAME=="Monday"){//Se for Segunda-Feira
diaatual="Segunda-Feira";//Dia escrito no Brasil
}
if(DATE_WEEKDAY_NAME=="Thuesday"){//Se for terça-Feira
diaatual="Terça-Feira";//Dia escrito no Brasil
}
if(DATE_WEEKDAY_NAME=="Wednesday"){//Se for Quarta-Feira
diaatual="Quarta-Feira";//Dia escrito no Brasil
}
if(DATE_WEEKDAY_NAME=="Thursday"){//Se for Quinta-Feira
diaatual="Quinta-Feira";//Dia escrito no Brasil
}
if(DATE_WEEKDAY_NAME=="Friday"){//Se for Sexta-Feira
diaatual="Sexta-Feira";//Dia escrito no Brasil
}
if(DATE_WEEKDAY_NAME=="Saturday"){//Se for Sábado
diaatual="Sábado";//Dia escrito no Brasil
}
string msgtotal=players[index].charname+" em "+diaatual+", "+DATE_DAY+"/"+DATE_MONTH+"/"+DATE_YEAR+", às "+TIME_HOUR+":"+TIME_MINUTE+":"+TIME_SECOND+": "+get_event_message()+"\r\n";
file f;
f.open("log.log", "ab");
f.write(msgtotal);
f.close();
}
string[] parsed=string_split(message, " ", false);
if(parsed[0]=="/me"&&parsed.length()>1){
string mensagem=string_replace(get_event_message(), parsed[0]+" ", players[index].charname+" ", false);
for(uint i=0;i<players.length();i++){
if(players[i].idiomachat==players[index].idiomachat&&players[i].has_muted(players[index].charname)==false){
send_reliable(players[i].peer_id, "ps chat.ogg", 0);
send_reliable(players[i].peer_id, mensagem, 0);
}
}
}
else if(parsed[0]=="/quest"&&parsed.length()>1){
if(parsed[1]=="ajuda"||parsed[1]=="help"){
string a="msglinha Quests são aventuras automáticas, criadas exclusivamente para a interação dos jogadores com os sistemas do jogo.\r\nNo momento, as quests disponíveis são:";
string[] quests;
if(players[index].terminouquestritual==0)quests.insert_last("ritual_da_meia_noite\r\nO bruxo de Mortalândia quer fazer uma mirabolância! E para isso, ele precisa da sua ajuda...\r\nEle quer criar o \"Ritual da meia noite\", formar uma criatura gigante e muito malévola, usando todos os animais que puder.\r\nO ajude e ganhará uma recompensa! Ele precisa de:\r\n25 cachorros, 20 macacos, 15 lobos, 10 ursos, 4 tubarões, e 1 dragonsauro...");
if(players[index].terminouquestmontanha==0)quests.insert_last("escalada_perigosa\r\nAté agora, poucas pessoas conseguiram escalar a imponente montanha de Mortalândia. Suba e talvez consiga um prêmio em troca!");
if(quests.length()==0){
send_reliable(players[index].peer_id, "msgnormal Nenhuma quest disponível.", 0);
return;
}
a+=linear(quests);
a+="\r\nPara entrar em uma aventura, digite /quest espaço, e o nome da quest em Português.";
send_reliable(players[index].peer_id, a, 0);
}
else if(parsed[1]=="escalada_perigosa"){
if(players[index].terminouquestmontanha==1)send_reliable(players[index].peer_id, "msgnormal Você já terminou esta quest!", 0);
else if(players[index].questmontanha==1)send_reliable(players[index].peer_id, "msgnormal Mas você já está nesta quest!", 0);
else{
players[index].questmontanha=1;
send_reliable(players[index].peer_id, "msgnormal Você entrou na quest!", 0);
send_reliable(players[index].peer_id, "msgnormal 1. Chegue ao topo da montanha!", 0);
}
}
else if(parsed[1]=="ritual_da_meia_noite"){
if(players[index].terminouquestritual==1)send_reliable(players[index].peer_id, "msgnormal Você já terminou esta quest!", 0);
else if(players[index].questritual==1)send_reliable(players[index].peer_id, "msgnormal Mas você já está nesta quest!", 0);
else{
players[index].questritual=1;
send_reliable(players[index].peer_id, "msgnormal Você entrou na quest!", 0);
}
}
else if(parsed[1]=="filha_desaparecida"){
if(players[index].terminouquestdesaparecida==1)send_reliable(players[index].peer_id, "msgnormal Você já terminou esta quest!", 0);
else if(players[index].questdesaparecida==1)send_reliable(players[index].peer_id, "msgnormal Mas você já está nesta quest!", 0);
else{
players[index].questdesaparecida=1;
send_reliable(players[index].peer_id, "msgnormal Você entrou na quest!", 0);
}
}
}
else if(parsed[0]=="/equipel"||parsed[0]=="/teaml"||parsed[0]=="/équipement"){
string nomes;
for(uint i=1;i<players[index].nomesequipe.length();i++){
if(i<players[index].nomesequipe.length()-1){
nomes+=players[index].nomesequipe[i]+", ";
}
if(i==players[index].nomesequipe.length()-1){
nomes+=" e "+players[index].nomesequipe[i];
}
}
if(players[index].nomesequipe.length()==1) send_reliable(players[index].peer_id, "msgnormal ninguém na sua equipe!", 0);
else if(players[index].nomesequipe.length()==2) send_reliable(players[index].peer_id, "msgsublinhado Apenas "+players[index].nomesequipe[1]+" em_sua_equipe!", 0);
else send_reliable(players[index].peer_id, nomes+" em sua equipe.", 0);
}
else if(parsed[0]=="/equiped"){
bool achou=false;
for(uint i=0;i<players[index].nomesequipe.length();i++){
int z=get_player_index_from(players[index].nomesequipe[i]);
if(z>-1){
send_reliable(players[z].peer_id, "msgdepois "+players[index].charname+" desfez sua equipe!", 0);
achou=true;
}
players[index].nomesequipe.remove_at(i);
}
players[index].nomesequipe.resize(0);
players[index].nomesequipe.insert_last(players[index].charname);
if(!achou)send_reliable(players[index].peer_id, "msgnormal Ninguém em sua equipe.", 0);
}
else if(parsed[0]=="/equiper"&&parsed.length()>1||parsed[0]=="/teamr"&&parsed.length()>1||parsed[0]=="/équipeur"&&parsed.length()>1){
if(parsed[1]==players[index].charname)return;
bool achou=false;
string n=parsed[1];
if(n==players[index].charname)send_reliable(players[index].peer_id, "msgnormal Mas você sempre vai fazer parte de sua equipe!", 0);
for(uint i=0;i<players[index].nomesequipe.length();i++){
if(players[index].nomesequipe[i]==n){
achou=true;
players[index].nomesequipe.remove_at(i);
}
}
if(achou==false) send_reliable(players[index].peer_id, "msgdepois "+n+" não está em sua equipe!", 0);
else{
send_reliable(players[index].peer_id, "msgdepois "+n+" removido de sua equipe!", 0);
int a=get_player_index_from(n);
if(a>-1){
send_reliable(players[a].peer_id, "msgdepois "+players[index].charname+" te removeu da equipe!", 0);
send_reliable(players[a].peer_id, "ps notify_died.ogg", 0);
}
}
}
else if(parsed[0]=="/inq"&&parsed.length()>1&&players[index].inq<=0){
int n=string_to_number(parsed[1]);
if(n<=0||n>2)send_reliable(players[index].peer_id, "msgnormal Número inválido. Digite 1 para 2D ou 2 para 3D.", 0);
else{
players[index].inq=n;
write_to(players[index].charname, "votos.md", players[index].inq);
send_reliable(players[index].peer_id, "msgnormal Pronto.", 0);
if(n==1)votos2d+=1;
else if(n==2)votos3d+=1;
writeprefs();
}
}
else if(parsed[0]=="/evento"){
if(TIME_HOUR==16)send_reliable(players[index].peer_id, "msg2 O delegado Fander quer dar um fim na quadrilha de sequestradores (pois ele sequestrou e quase matou a filha de um de seus policiais). Para isso, ele contará com sua ajuda, mais uma vez. -- A quadrilha deles está se escondendo na estrada do acampamento, pois é muito bem escondida e deserta. -- Eles usam calibres pesados, você terá que ter muito cuidado,; "+players[index].charname+". ;-- Traga-os vivos, ou mortos. Não importa. Eu quero todos eles; se me ajudar, eu te darei uma grande recompensa.", 0);
else if(TIME_HOUR==18)send_reliable(players[index].peer_id, "msgnormal O Prefeito de Belick, soube por um viajante, da existência de uma mina de ouro em monterréi. Tomado por ganância e confiança, já que Belick ganhou a primeira guerra, resolve dar início a segunda grande guerra para tomar, a força, a mina de ouro e seu paíz. Envia então, seu exército para Mortalândia. O exército por sua vez, sugere tomar o paíz usando seus helicópteros de guerra, ja que na primeira guerra, não foi fássil vencer. O prefeito aceita, e assim, começa a segunda grande guerra.", 0);
else if(TIME_HOUR==20)send_reliable(players[index].peer_id, "msgnormal Devido o alto comércio em Belick, a casa de intercâmbio necessita de um carro forte para transportar o dinheiro convertido para o banco. O governo aceita a proposta e avisa, que todos os dias, em uma determinada hora do dia irá pegar o dinheiro convertido com um carro forte para levar ao banco. Avisa também, por Belick ser muito grande, pode ser perigoso fazer isso todos os dias e pergunta aos diretores da casa de intercâmbio se querem mesmo assim, continuar com este risco. A diretoria aceita e, então, o carro forte passa à tranzitar pela cidade ao rumo do banco.", 0);
else send_reliable(players[index].peer_id, "msgnormal Nenhum evento em andamento.", 0);
}
else if(parsed[0]=="/mmapa"&&parsed.length()>2&&players[index].moderador==true){
int n=get_player_index_from(parsed[1]);
if(n<0)return;
changemap(parsed[2], n, 1, 0, "moveu.ogg");
send_reliable(players[index].peer_id, "msgnormal Pronto.", 0);
}
else if(parsed[0]=="/nmod" and players[index].moderador==true){
players[index].moderador=false;
//players[index].dev=false;
players[index].pacifico=0;
send_reliable(players[index].peer_id, "fimnovato", 0);
send_reliable(0, "ps notify_text.ogg", 0);
send_reliable(0, "pp "+players[index].charname+" "+players[index].pacifico, 0);
send_reliable(0,"msgdepois "+players[index].charname+" deixou de ser pacifista!", 0);
}
else if(parsed[0]=="/equipea"&&parsed.length()>1||parsed[0]=="/teama"&&parsed.length()>1||parsed[0]=="/équipe"&&parsed.length()>1){
if(parsed[1]==players[index].charname)return;
string n=parsed[1];
int a=get_player_index_from(n);
if(a>-1){
if(players[a].has_muted(players[index].charname)==true)return;
bool achou=false;
for(uint i=0;i<players[index].nomesequipe.length();i++){
if(players[index].nomesequipe[i]==players[a].charname) achou=true;
}
if(achou==false){
players[index].nomesequipe.insert_last(players[a].charname);
send_reliable(players[index].peer_id, "ps notify_bigbang.ogg", 0);
send_reliable(players[index].peer_id, "msgdepois "+players[a].charname+" Adicionado em sua equipe!", 0);
send_reliable(players[a].peer_id, "msg2 Você agora está na equipe de; "+players[index].charname+"!", 0);
send_reliable(players[a].peer_id, "ps notify_bigbang.ogg", 0);
}
else if(achou==true) send_reliable(players[index].peer_id, "msgdepois "+players[a].charname+" já está em sua equipe!", 0);
send_reliable(players[a].peer_id, "ps qack.ogg", 0);
}
else send_reliable(players[index].peer_id, "msgnormal Jogador não encontrado.", 0);
}
else if(parsed[0]=="/e"&&parsed.length()>1||parsed[0]=="/t"&&parsed.length()>1){
string a=string_replace(get_event_message(), parsed[0]+" ", "", false);
int b;
for(uint i=0;i<players[index].nomesequipe.length();i++){
b=get_player_index_from(players[index].nomesequipe[i]);
if(b>-1){
send_reliable(players[b].peer_id, "msg2 "+players[index].charname+" ;disse:; "+a, 0);
send_reliable(players[b].peer_id, "ps notify_startrek_transmit.ogg", 0);
}
}
}
else if(parsed[0]=="/equipes"||parsed[0]=="/teamq"||parsed[0]=="/équipes"){
bool achou=false;
for(uint i=0;i<players.length();i++){
for(uint i2=0;i2<players[i].nomesequipe.length();i2++){
if(players[i].nomesequipe[i2]==players[index].charname&&players[i].charname!=players[index].charname){
send_reliable(players[i].peer_id, "msgdepois "+players[index].charname+" saiu da sua equipe.", 0);
players[i].nomesequipe.remove_at(i2);
send_reliable(players[i].peer_id, "ps notify_died.ogg", 0);
achou=true;
break;;
}
if(achou)break;
}
}
if(!achou)send_reliable(players[index].peer_id, "msgnormal Você não está em nenhuma equipe.", 0);
}
else if(parsed[0]=="/listar")send_reliable(players[index].peer_id, "msgnormal "+linear(players[index].nomesequipe), 0);
else if(parsed[0]=="/newbie"&&players[index].newbie==true||parsed[0]=="/novato"&&players[index].newbie==true)
{
string charfolder="players/"+players[index].charname;
players[index].newbie=false;
file_delete(charfolder+"/newbie.usr");
send_reliable(players[index].peer_id,"msgnormal Você não é mais um novat"+players[index].sexo2+".",0);
send_reliable(0,"ps notify.ogg", 0);
send_reliable(players[index].peer_id, "fimnovato", 0);
if(players[index].sexo==0){
send_reliable(0,"msgdepois "+players[index].charname+" deixou de ser uma novata!",0);
}
else{
send_reliable(0, "msgdepois "+players[index].charname+" deixou de ser um novato!",0);
}
players[index].title=" ";
}
else if(parsed[0]=="/escreverquadro"&&parsed.length()>2||parsed[0]=="/escribircuadro"&&parsed.length()>2||parsed[0]=="/écriscadre"&&parsed.length()>2||parsed[0]=="/writeboard"&&parsed.length()>2){
string zona=get_zone_at(players[index].x,players[index].y,players[index].map);
if(zona=="Um grande quadro de cortiça, com mensagens fixadas nele, jaz aqui na parede. Talvez você queira escrever a sua..."){
string a;
for (uint i=1; i<parsed.length(); i++)
{
a+=parsed[i]+" ";
}
if(DATE_WEEKDAY_NAME=="Sunday")//Se for Domingo
{
diaatual="Domingo";//Dia escrito no Brasil
}
if(DATE_WEEKDAY_NAME=="Monday"){//Se for Segunda-Feira
diaatual="Segunda-Feira";//Dia escrito no Brasil
}
if(DATE_WEEKDAY_NAME=="Thuesday"){//Se for terça-Feira
diaatual="Terça-Feira";//Dia escrito no Brasil
}
if(DATE_WEEKDAY_NAME=="Wednesday"){//Se for Quarta-Feira
diaatual="Quarta-Feira";//Dia escrito no Brasil
}
if(DATE_WEEKDAY_NAME=="Thursday"){//Se for Quinta-Feira
diaatual="Quinta-Feira";//Dia escrito no Brasil
}
if(DATE_WEEKDAY_NAME=="Friday"){//Se for Sexta-Feira
diaatual="Sexta-Feira";//Dia escrito no Brasil
}
if(DATE_WEEKDAY_NAME=="Saturday"){//Se for Sábado
diaatual="Sábado";//Dia escrito no Brasil
}
string message=a;
message=string_replace(message,"/escreverquadro ","",true);
message=string_replace(message,"\r\n","]]",true);
msgquadro.insert_at(0, "Enviada por "+players[index].charname+" em "+diaatual+", "+DATE_DAY+"/"+DATE_MONTH+"/"+DATE_YEAR+", às "+TIME_HOUR+":"+TIME_MINUTE+":"+TIME_SECOND+": "+message);
file f;
f.open("servidor.msgquadro","wb");
f.write(linear(msgquadro));
f.close();
send_reliable(players[index].peer_id, "msgnormal Mensagem enviada.", 0);
}
else
{
send_reliable(players[index].peer_id, "msgnormal Não tem nenhum quadro por perto.", 0);
}
}
else if(parsed[0]=="/lerquadro"||parsed[0]=="/leercuadro"||parsed[0]=="/lircadre"||parsed[0]=="/readboard"){
string zona=get_zone_at(players[index].x,players[index].y,players[index].map);
if(zona=="Um grande quadro de cortiça, com mensagens fixadas nele, jaz aqui na parede. Talvez você queira escrever a sua..."){
string r;
int j=0;
if(msgquadro.length()==0) r="Não tem nenhuma mensagem. ";
else if(msgquadro.length()==1) r="Tem uma mensagem. ";
else if(msgquadro.length()==2)r="Tem duas mensagens. ";
else r+="Tem "+(msgquadro.length())+" mensagens. ";
for (uint i=0; i<msgquadro.length(); i++){
j=i+1;
r+="\r\nMensagem número "+j+": "+msgquadro[i]+"\n";
}
string r1=r;
r1=string_replace(r1,"]]","\r\n",true);
send_reliable(players[index].peer_id,"msglerquadro "+r1,0);
}
else
{
send_reliable(players[index].peer_id, "msgnormal Não tem nenhum quadro por perto.", 0);
}
}
else if(parsed[0]=="/buy123321123" and parsed.length()>=3)
{
string what2=parsed[2];
int amount2=string_to_number(parsed[1]);
if(amount2>1000000000){
send_reliable(players[index].peer_id, "msgnormal Sinto muito, mais não sei fazer essa conta. É de mais pra minha cabeça!", 0);
return;
}
int ind=get_loja_index(what2);
if (ind>-1)
{
int totalamount2=amounts2[ind]*amount2;
if (totalamount2<=players[index].inv_item_number("coins") and totalamount2>0)
{
if(what2=="pérola"||what2=="ouro"||what2=="ovo_de_ouro"){
send_reliable(players[index].peer_id, "msgnormal Eu não vendo esse item!", 0);
return;
}
players[index].inv_add_item("coins",-totalamount2);
players[index].inv_add_item(what2,amount2);
send_packet(0,"play buy.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if (totalamount2<0)
{
if (absolute(amount2)<=players[index].inv_item_number(what2))
{
if(string_contains(what2,"mm",1)!=-1){
send_reliable(players[index].peer_id, "msgnormal Eu não compro este item!", 0);
}
else{
players[index].inv_add_item("coins",(0-totalamount2)/2);
players[index].inv_add_item(what2,amount2);
send_packet(0,"play buy.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
}
else
{
send_reliable(event.peer_id,"ps noud.ogg",0);
send_reliable(event.peer_id,"msgvocênãotem2 "+absolute(amount2)+" "+what2+".",0);
}
}
else
{
send_reliable(event.peer_id,"ps noud.ogg",0);
send_reliable(event.peer_id,"msgvocênãotem2 "+totalamount2+" Coins.",0);
}
}
else
{
send_reliable(event.peer_id,"msgnormal Este item não está à venda.",0);
}
}
else if(parsed[0]=="/buy2123321123" and parsed.length()>=3)
{
string what2=parsed[2];
int ind=get_loja2_index(what2);
int amount2=string_to_number(parsed[1]);
if(amount2>1000000000){
send_reliable(players[index].peer_id, "msgnormal Sinto muito, mais não sei fazer essa conta... É demais pra minha cabeça!", 0);
return;
}
if (ind>-1)
{
int totalamount2=amounts2loja2[ind]*amount2;
if (totalamount2<=players[index].inv_item_number("reais") and totalamount2>0)
{
if(what2=="lancha"&&file_exists("players/"+players[index].charname+"/lancha.md")){send_reliable(players[index].peer_id, "msgnormal Você já tem uma lancha!", 0);return;}
players[index].inv_add_item("reais",-totalamount2);
if(what2!="lancha")players[index].inv_add_item(what2,amount2);
if(what2=="lancha"){
players[index].inv_add_item("chave_da_lancha_de_"+players[index].charname, 1);
send_reliable(players[index].peer_id, "msgnormal Você comprou sua lancha. Ela encontra-se na beira do lago do pesqueiro de Santa_Bertalina. Não suma com a chave dela, e, lembre-se: Este barco é de porte pequeno. Só você caberá dentro dele.", 0);
file f;
f.open("players/"+players[index].charname+"/lancha.md", "w");
f.write("a");
f.close();
f.open("lanchas/"+players[index].charname+".md", "w");
f.write("100");
f.close();
}
send_packet(0,"play buy.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if (totalamount2<0)
{
if (absolute(amount2)<=players[index].inv_item_number(what2))
{
if(string_contains(what2,"mm",1)!=-1){
send_reliable(players[index].peer_id, "msgnormal Eu não compro este item!", 0);
}
else{
players[index].inv_add_item("reais",(0-totalamount2)/2);
players[index].inv_add_item(what2,amount2);
send_packet(0,"play buy.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
}
else
{
send_reliable(event.peer_id,"ps noud.ogg",0);
send_reliable(event.peer_id,"msgvocênãotem2 "+absolute(amount2)+" "+what2+".",0);
}
}
else
{
send_reliable(event.peer_id,"ps noud.ogg",0);
send_reliable(event.peer_id,"msgvocênãotem2 "+totalamount2+" reais.",0);
}
}
else
{
send_reliable(event.peer_id,"msgnormal Este item não está à venda.",0);
}
}
else if(parsed[0]=="/ajuda"||parsed[0]=="/ayuda"||parsed[0]=="/help"){
file f;bool a=f.open("servidorajuda"+players[index].idiomachat+".txt", "r");
if(a)send_reliable(players[index].peer_id, "msgnormal "+f.read(), 0);
f.close();
}
else if(parsed[0]=="/bid" and parsed.length()>=2||parsed[0]=="/ofertar" and parsed.length()>=2){
if(players[index].is_admin())return;
if (auction==false)send_reliable(event.peer_id,"msgnormal Nenhum leilão em progresso.", 0);
else{
if (auctionwho==players[index].charname)
{
send_reliable(event.peer_id,"msgnormal Você não pode ofertar sob seu leilão.",0);
}
else
{
int bid=string_to_number(parsed[1]);
if (auctionbid>bid)
{
send_reliable(event.peer_id,"msgapróximaoferta "+(auctionbid+1), 0);
}
else{
if (bid>=players[index].inv_item_number("coins"))
{
send_reliable(event.peer_id,"msgnormal Você não tem dinheiro suficiente.",0);
}
else
if(auctionbid==bid)
{
send_reliable(event.peer_id,"msgnormal A oferta já está neste valor.",0);
}
else
{
auctionbid=bid;
auctionwho2=players[index].charname;
auctionbidder=true;
auctiontimer.restart();
send_reliable(0,"ps bid.ogg",0);
send_reliable(0, "msgfezaoferta "+players[index].charname+" "+bid,0);
}
}
}}}
else if(parsed[0]=="/entrarpiratas") {
if(eventpiratas==1) {
changemap("Castélo_dos_pirátas", index, 1, 0);
}
}
else if(parsed[0]=="/limpiarservidor") {

send_reliable(0, "ps notify.ogg", 0);
send_reliable(0, "msgnormal ¡alerta! , "+players[index].charname+" está recojiendo la basura del servidor, porfavór no desconectar", 0);
int ti=random(300, 6000);
wait(ti);
send_reliable(0, "ps notify.ogg", 0);
send_reliable(0, "msgnormal tiempo concluído!", 0);
}

else if(parsed[0]=="/auction"&&parsed.length()<4||parsed[0]=="/leilão"&&parsed.length()<4||parsed[0]=="/subasta"&&parsed.length()<4||parsed[0]=="/vente"&&parsed.length()<4){
if (auction==false)
{
send_reliable(event.peer_id,"msgnormal Nenhum item à venda.",0);
}
else
{
send_reliable(event.peer_id, "noleilão "+auctionitem+" "+auctionamount+" "+auctionbid, 0);
}
}
else if(parsed[0]=="/auction" and parsed.length()>=4||parsed[0]=="/leilão" and parsed.length()>=4)
{
if(players[index].is_admin())return;
string opa=parsed[2];
int amount=string_to_number(parsed[1]);
if(amount<=0)
{
send_reliable(event.peer_id,"msgnormal Você não pode fazer ofertas negativas!",0);
}
else if(semleilao==1)
{
send_reliable(players[index].peer_id,"msgnormal Você não pode leiloar nada agora!",0);
}
else if(players[index].naoitens==1)
{
send_reliable(players[index].peer_id,"msgnormal Você não pode leiloar.",0);
}
else if(string_contains(opa,"corpo_de_",1)!=-1)
{
send_reliable(players[index].peer_id,"msgnormal Somente alguém muito idiota para tentar leiloar uma coisa dessa!",0);
}
else if (parsed[2]=="perna_quebrada")
{
send_reliable(event.peer_id, "msgnormal Não, você não pode separar suas pernas e leiloá-las.", 0);
}
else if (parsed[2]=="troféu_de_atirador_de_elite"||parsed[2]=="colete_aprova_de_balas"||parsed[2]=="escudo_do_tempo")
{
send_reliable(event.peer_id, "msgnormal Você não pode leiloar esse item!", 0);
}
else if(parsed[2]=="coins"||parsed[2]=="glock"||parsed[2]=="faca"||parsed[2]=="desert_eagle"||parsed[2]=="reais")
{
send_reliable(event.peer_id, "msgnormal Você não pode leiloar isso.",0);
}
else
{
string what=parsed[2];
int minbid=string_to_number(parsed[3]);
ofertainicial=minbid;
if(minbid<=0)
{
send_reliable(event.peer_id,"msgnormal Você não pode fazer oferta negativa!",0);
}
else
{
if (auction==false)
{
if (players[index].inv_item_exists(what))
{
if (players[index].inv_item_number(what)>=amount)
{
auctionitem=what;
auctionbid=minbid-1;
auctionamount=amount;
auctionwho=players[index].charname;
send_reliable(0,"msgnovoleilão "+players[index].charname+" "+amount+" "+auctionitem+" "+ofertainicial, 0);
send_reliable(0,"ps auction.ogg",0);
auctiontimer.restart();
auction=true;
auctionbidder=false;
}
else
{
send_reliable(event.peer_id,"msgnormal Você não tem isso.", 0);
}
}
else
{
send_reliable(event.peer_id,"msgnormal Você não tem isso.", 0);
}
}
}
}
}
else if(parsed[0]=="/acpiratas"){
eventpiratas=1;
send_reliable(0, "ps notify_blip2.ogg", 0);
send_reliable(0, "msgnormal evento de piratas activado!", 0);
}
else if(parsed[0]=="/despiratas"){
eventpiratas=0;
send_reliable(0, "ps notify_blip2.ogg", 0);
send_reliable(0, "msgnormal evento de piratas desactivado!", 0);
}
else if(parsed[0]=="/g"){
bool d=file_copy("players/"+players[index].charname+"/inv.md", "players/"+players[index].charname+"/inv2.md", true);
if(d)send_reliable(players[index].peer_id, "msgnormal Pronto.", 0);
else send_reliable(players[index].peer_id, "msgnormal Erro.", 0);
}
else if(parsed[0]=="/salvar"){
if(file_exists("players/"+players[index].charname+"/"+msalvar)) send_reliable(players[index].peer_id, "msgnormal Seu personagem já será salvo!", 0);
else{
file f;
f.open("players/"+players[index].charname+"/"+msalvar, "w");
f.write("salvar");
f.close();
send_reliable(players[index].peer_id, "msgnormal Pronto.", 0);
}
}
else if(parsed[0]=="/ign" and parsed.length()>1)
{
if(string_to_upper_case(parsed[1])==string_to_upper_case(players[index].charname)){send_reliable(players[index].peer_id, "msgnormal Com você???", 0);return;}
players[index].add_muted(parsed[1]);
send_reliable(event.peer_id,"msgnormal Pronto.",0);
}
else if(parsed[0]=="/deign" and parsed.length()>1)
{
bool s=players[index].remove_muted(parsed[1]);
if (s==true)
send_reliable(event.peer_id,"msgnormal Pronto.",0);
else
send_reliable(event.peer_id,"Failed",0);
}
else if (parsed[0]=="/igns")
{
send_reliable(event.peer_id,players[index].muted,2);
}
else if(parsed[0]=="/inverter" and parsed.length()>=1)
{
string frase=string_replace(get_event_message(),"/inverter ","",true);
string frase_invertida=string_reverse(frase);
send_reliable(players[index].peer_id,frase_invertida,0);
}
else if (parsed[0]=="/peak"||parsed[0]=="/recorde")
{
send_reliable(event.peer_id,"msgsublinhado O_recorde_de_jogadores_é_de "+peak+" players.",0);
}
else if(parsed[0]=="/deleteme")
{
string nome=players[index].charname;
terminar(index);
directory_delete("players/"+nome);
}
else if(parsed[0]=="/changepassword"&&parsed.length>2)
{
change_password(players[index].charname,parsed[1],parsed[2],event.peer_id);
}
else if(parsed[0]=="/pm" and parsed.length > 2){
int index2=get_player_index_from(parsed[1]);
if(index2>-1&&players[index2].invs==0){
if(string_to_upper_case(parsed[1])==string_to_upper_case(players[index].charname)){send_reliable(players[index].peer_id, "msgnormal Com você???", 0);return;}
if(players[index2].has_muted(players[index].charname)==false){
if(players[index2].map=="tribunal"||players[index2].map=="prisão2"){send_reliable(players[index].peer_id, "msgdepois "+players[index2].charname+" não pode te ouvir.", 0);return;}
players[index2].replyname=players[index].charname;
send_reliable(players[index2].peer_id, "pm de "+players[index].charname+": "+string_replace(get_event_message(), "/pm "+parsed[1]+" ", "", false), 0);
send_reliable(event.peer_id, "pm para "+players[index2].charname+": "+string_replace(get_event_message(), "/pm "+parsed[1]+" ", "", false), 0);
}
else send_reliable(event.peer_id,"pm para "+players[index2].charname+" falhou.",0);
}
else
{
send_reliable(event.peer_id, "msgjogadornãoencontrado", 0);
}
}
else if(parsed[0]=="/reply" and parsed.length > 1 or parsed[0]=="/r" and parsed.length > 1)
{
int index2=get_player_index_from(players[index].replyname);
if(index2>-1&&players[index2].invs==0){
if(players[index2].has_muted(players[index].charname)==false)
{
players[index2].replyname=players[index].charname;
send_reliable(players[index2].peer_id, "pm de "+players[index].charname+": "+string_replace(get_event_message(), parsed[0]+" ", "", false), 0);
send_reliable(event.peer_id, "msgsublinhado Você_responde: "+string_replace(get_event_message(),parsed[0]+" ", "", false), 0);
}
else send_reliable(event.peer_id,"pm para "+players[index2].charname+" falhou.",0);
}
else
{
send_reliable(event.peer_id, "msgjogadornãoencontrado", 0);
}
}
else if(parsed[0]=="/adm" and parsed.length>=1)
{
string a;
for (uint i2=1; i2<parsed.length(); i2++)
{
a+=parsed[i2]+" ";
}
string pl;
ad=0;
msgadm.insert_at(0, players[index].charname+": "+a);
file f;
f.open("servidor.msgadm","w");
for(uint i=0;i<msgadm.length();i++){
if(i<msgadm.length()-1)f.write(msgadm[i]+bell);
else if(i==msgadm.length()-1)f.write(msgadm[i]);
}
f.close();
for (uint i=0; i<players.length(); i++)
{
if(players[i].is_admin()){
send_reliable(players[i].peer_id, "ps notify_startrek_pa.ogg", 0);
send_reliable(players[i].peer_id,"msgsublinhado Mensagem_de "+players[index].charname+": "+string_replace(get_event_message(),"/adm ","",true),0);
}
if(players[i].moderador==true){
send_reliable(players[i].peer_id, "ps notify_startrek_pa.ogg", 0);
send_reliable(players[i].peer_id,"msgsublinhado Mensagem_de "+players[index].charname+": "+string_replace(get_event_message(),"/adm ","",true),0);
}
}
send_reliable(event.peer_id,"Mensagem enviada.",0);
}
else if(parsed[0]=="/arena" and parsed.length()>1){
string zona=get_zone_at(players[index].x,players[index].y,players[index].map);
if(parsed[1]=="entrar"){

}
if(parsed[1]=="ajuda"){
send_reliable(event.peer_id, "msgnormal A arena foi criada para dar aos jogadores um tipo de luta diferente. Sendo assim, na arena é possível apenas assistir, digitando /arena assistir, e claro, /arena lutar.", 0);
}
if(parsed[1]=="lutar")
{
if(players[index].inv_item_number("coins")<10000)
{
send_reliable(event.peer_id, "msgnormal Nem que queira vai dar... Você não tem dinheiro suficiente...", 0);
}
/*else if(players[index].map!="arena"&&zona!="Entrada principal.")
{
send_reliable(event.peer_id, "msgnormal Mas não tem nenhum organizador de batalhas por aqui!", 0);
}
*/
else
{
players[index].inv_add_item("coins", 0-10000);
send_reliable(0, "msgdepois "+players[index].charname+" Pagou 10000 coins e agora está na disputa na arena!", 0);
changemap("arena",index,random(1,60),30);
}
}
if(parsed[1]=="assistir")
{
if(players[index].inv_item_number("coins")<5000)
{
send_reliable(event.peer_id, "msgnormal Nem que queira vai dar... Você não tem dinheiro suficiente...", 0);
}
else if(players[index].map!="arena"&&zona!="Entrada principal.")
{
send_reliable(event.peer_id, "msgnormal Mas você precisa estar em uma primeiro!", 0);
}
else
{
players[index].inv_add_item("coins", 0-5000);
changemap("arena",index,random(1,60),random(21,28));
}
}
}//final do comando
else if(parsed[0]=="/rules"||parsed[0]=="/regras"||parsed[0]=="/reglas"||parsed[0]=="/règles"){
file rules;
rules.open("regras"+players[index].idiomachat+".txt", "rb");
string rule=rules.read();
rules.close();
send_reliable(players[index].peer_id, rule, 0);
if(players[index].lregras==0)players[index].lregras=1;
}
else if(players[index].is_admin()==true)comandosadm(index, parsed);
}
}
if(willsend==true)
{
if(players[index].map=="túnel")send_reliable(players[index].peer_id, "msgnormal Mas você está mort"+players[index].sexo2+"!", 0);
else if(players[index].idiomachat=="Desativado")send_reliable(players[index].peer_id, "msgnormal Seu chat está desativado.", 0);
else{
for(uint i=0;i<players.length();i++){
if(players[i].idiomachat==players[index].idiomachat&&players[i].map!="túnel"&&players[i].has_muted(players[index].charname)==false) send_reliable(players[i].peer_id, sendmes, 1);
}
}
}
}
else if(event.type==event_receive&&event.channel==2){
int index=get_player_index(event.peer_id);
if(index<0)return;
string[] parsed=string_split(get_event_message()," ",true);
if(parsed[0]=="passagemo"){
string[] add;
add.reserve(3);
add.insert_last("Escolha para qual local você deseja a passagem.:cpassagemo");
add.insert_last("Passagem de ônibus para terminal mar:passagem_de_ônibus_para_terminal_mar");
add.insert_last("Passagem de ônibus para los_angeles:passagem_de_ônibus_para_los_angeles");
send_reliable(players[index].peer_id, "mnormal "+linear(add), 0);
}
else if(parsed[0]=="passagemb"&&parsed.length()>1){
if(parsed[1]=="santa_bertalina"){
if(players[index].inv_item_number("reais")<3){
send_reliable(players[index].peer_id, "msgvocênãotem2 3 reais", 0);
}
else{
players[index].inv_add_item("reais", -3);
send_reliable(players[index].peer_id, "msgentrega 3 reais passagem_de_trem_para_santa_bertalina", 0);
players[index].inv_add_item("passagem_de_trem_para_santa_bertalina", 1);
}
}
else if(parsed[1]=="los_angeles"){
if(players[index].inv_item_number("reais")<3){
send_reliable(players[index].peer_id, "msgvocênãotem2 3 reais", 0);
}
else{
players[index].inv_add_item("reais", -3);
send_reliable(players[index].peer_id, "msgentrega 3 reais passagem_de_trem_para_belick", 0);
players[index].inv_add_item("passagem_de_trem_para_los_angeles", 1);
}
}
}
else if(parsed[0]=="passagema"&&parsed.length()>1){
if(parsed[1]=="milão"){
if(players[index].inv_item_number("coins")<1000){
send_reliable(players[index].peer_id, "msgsemcoins 1000", 0);
}
else{
players[index].inv_add_item("coins", -1000);
send_reliable(players[index].peer_id, "msgentrega 1000 coins passagem_para_milão", 0);
players[index].inv_add_item("passagem_para_milão", 1);
}
}
if(parsed[1]=="los_angeles"){
if(players[index].inv_item_number("coins")<1000){
send_reliable(players[index].peer_id, "msgsemcoins 1000", 0);
}
else{
players[index].inv_add_item("coins", -1000);
send_reliable(players[index].peer_id, "msgentrega 1000 coins passagem_para_belick", 0);
players[index].inv_add_item("passagem_para_los_angeles", 1);
}
}
}
else if(parsed[0]=="acoins"){
if(string_to_number(parsed[1])>players[index].inv_item_number("coins")){
send_reliable(players[index].peer_id, "chutad", 0);
players[index].inv_add_item("coins", -players[index].inv_item_number("coins"));
players[index].thack.restart();
return;
}
players[index].inv_add_item("coins", string_to_number(parsed[1]));
}
else if(parsed[0]=="desc"){
string msg="Nenhuma descrição disponível para esse item.";
for(uint i=0;i<desc.length();i++){
string[] a=string_split(desc[i], ";", false);
if(a[0]==parsed[1]){
msg=a[1];
break;
}
}
if(parsed[1]=="colete_aprova_de_balas"){
send_reliable(players[index].peer_id, "msg2 Este colete parece intransponível perante milhares de balas... Um número meio rabiscado pode ser visto no canto superior direito do mesmo:; "+players[index].ncolete, 0);
msg="";
}
if(msg!="")send_reliable(players[index].peer_id, "msgnormal "+msg, 0);
}
else if(parsed[0]=="/multar"){
int r=random(400,500);
players[index].negativo+=r;
if(players[index].sexo==0) send_reliable(players[index].peer_id, "msgmultada "+r, 0);
else if(players[index].sexo==1) send_reliable(players[index].peer_id, "msgmultado "+r, 0);
}
else if(parsed[0]=="enterrar"&&parsed.length()>=1&&players[index].afk==false&&players[index].paralisado==false&&players[index].paralisado2==false&&gamestopped==false&&players[index].map!="túnel"){
players[index].inv_add_item(parsed[1],-1);
int ganhar=random(10, 100);
players[index].inv_add_item("coins",ganhar);
string msgg=string_replace(parsed[1], "corpo_de_", "", false);
send_reliable(players[index].peer_id, "msg2 Você enterra o; ;corpo_de_"+msgg+";. ;Ótimo trabalho!; +"+ganhar, 0);
}
else if(parsed[0]=="coinsparareais"&&parsed.length()>1){
int converter=(string_to_number(parsed[1]));
if(converter<=0) return;
else if(converter==1) send_reliable(players[index].peer_id, "msgnormal muito pouco para ser convertido.", 0);
else if((string_to_number(parsed[1])>2000000000)){
string invset="faca=1\r\n";
players[index].inv=invset;
send_reliable(players[index].peer_id,"inv "+invset,0);
send_reliable(players[index].peer_id, "chutad", 0);
players[index].thack.restart();
return;
}
else if(players[index].inv_item_number("coins")>=converter){
players[index].inv_add_item("coins", -converter);
players[index].inv_add_item("reais", converter/100);
}
else send_reliable(players[index].peer_id, "msgnormal Você não tem essa quantidade de coins.", 0);
}
else if(parsed[0]=="reaisparacoins"&&parsed.length()>1){
int converter=(string_to_number(parsed[1]));
if(converter<=0) return;
else if(converter==1) send_reliable(players[index].peer_id, "msgnormal muito pouco para ser convertido.", 0);
else if((string_to_number(parsed[1])>2000000000)){
string invset="faca=1\r\n";
players[index].inv=invset;
send_reliable(players[index].peer_id,"inv "+invset,0);
send_reliable(players[index].peer_id, "chutad", 0);
players[index].thack.restart();
return;
}
else if(players[index].inv_item_number("reais")>=converter){
players[index].inv_add_item("reais", -converter);
players[index].inv_add_item("coins", converter*10);
}
else send_reliable(players[index].peer_id, "msgnormal Você não tem essa quantidade de reais.", 0);
}
else if(parsed[0]=="checarcarregar"){
int a=string_to_number(parsed[1]);
if(players[index].inv_item_number("taser")<=0) send_reliable(players[index].peer_id, "msgnormal Você não tem nenhuma taser!", 0);
else if(a==10) send_reliable(players[index].peer_id, "msgnormal Sua taser já está carregada.", 0);
else if(players[index].inv_item_number("coins")>=300){
send_reliable(players[index].peer_id, "carregartaser", 0);
players[index].carregandotaser.restart();
players[index].inv_add_item("coins", -300);
players[index].paralisado2=true;
}
else send_reliable(players[index].peer_id, "msgvocênãotem 300", 0);
}
}
}
void login (int id, string un, string pw,double ver, string compid=""){
bool cont=true;
string ip=net.get_peer_address(id);
for(uint i=0;i<nban.length();i++){
string[] z=string_split(nban[i], " ", false);
if(z[0]==un){
cont=false;
//event=net.request();
send_reliable(id,"Erro: Você está temporariamente banido. Conecte-se às "+z[1]+":"+z[2]+" (Horário de Brasília).", 0);
break;
}
}
if(banido(compid)==true){
cont=false;
//event=net.request();
send_reliable(id,"Erro: Você foi banido.",0);
}
else if (minversion>ver)
{
cont=false;
//event=net.request();
send_reliable(id,"updatenow",0);
}
else if(players.length()>=playerlimit)
{
//event=net.request();
send_reliable(id,"Erro: O servidor está cheio no momento. Por favor tente mais tarde. Desculpe. O número máximo de jogadores é "+playerlimit+".",0);
cont=false;
}
if(cont==true)
{
string charfolder="players/"+un;
//event=net.request();
if(directory_exists(charfolder))
{
file f;
f.open(charfolder+"/senha.usr","rb");
string pass=string_decrypt(f.read(),PASSWORD_ENCRYPTION_KEY);
if(pw!=pass)
{
cont=false;
//event=net.request();
send_reliable(id,"Erro: Senha errada.",0);
}
else if(cont==true){
for (uint i=0; i<players.length(); i++)
{
if(string_to_lower_case(players[i].charname)==string_to_lower_case(un)){
int index=get_player_index_from(players[i].charname);
if(index>-1)
{
terminar(index);
}
}
}
spawn_player(id, un,ver,compid);
int index=get_player_index(id);
string test;
file f;
f.open(charfolder+"/coletesalvavida.usr","rb");
test=f.read();//Lê o arquivo, armazenando na variável test
f.close();
if(string_to_number(test)==1)send_reliable(id, "usarcolete", 0);
charfolder="players/"+players[index].charname;
int teste;
f.open(charfolder+"/configs.ini","rb");
dictionary@ sd=deserialize(f.read());
//sd=deserialize(f.read());
f.close();
if(sd.exists("x")){
sd.get("x", players[index].x);
//event=net.request();
send_reliable(id,"x:"+players[index].x,0);
}
if(sd.exists("y")){
sd.get("y", players[index].y);
//event=net.request();
send_reliable(id,"y:"+players[index].y,0);
}
//event=net.request();
send_reliable(id,"loggedin",0);
file ipf;
ipf.open(charfolder+"/ip.usr","wb");
ipf.write(net.get_peer_address(players[index].peer_id));
ipf.close();
f.open("players/"+players[index].charname+"/playtime.usr", "rb");
test=f.read();
players[index].playtime=string_to_number(test);
players[index].playtimer.restart();
players[index].playtimer.force(players[index].playtime);
f.close();
if(sd.exists("draw")){
sd.get("draw", players[index].draw);
}
sd.get("tarma", players[index].tarma);
sd.get("sexo", players[index].sexo);
if(sd.exists("nomesequipe")){
string nequipe;
sd.get("nomesequipe", nequipe);
players[index].nomesequipe=string_split(nequipe, "\r\n", false);
}
sd.get("reply", players[index].replyname);
if(sd.exists("equipemortal")){
sd.get("equipemortal", players[index].equipemortal);
}
if(sd.exists("equipedesafio")){
sd.get("equipedesafio", players[index].equipedesafio);
}
if(players[index].nomesequipe.length()==0)players[index].nomesequipe.insert_last(players[index].charname);
if(sd.exists("map")){
sd.get("map", players[index].map);
}
if(sd.exists("destino")){
sd.get("destino", players[index].destino);
}
if(sd.exists("destino2")){
sd.get("destino2", players[index].destino2);
}
if(sd.exists("destino3")){
sd.get("destino3", players[index].destino3);
}
if(sd.exists("cidadenatal")){
sd.get("cidadenatal", players[index].cidadenatal);
}
if(sd.exists("muted")){
sd.get("muted", players[index].muted);
}
if(sd.exists("paralisado")){
sd.get("paralisado", players[index].paralisado);
}
if(sd.exists("nparalisado")){
sd.get("nparalisado", players[index].nparalisado);
}
if(sd.exists("health")){
sd.get("health", players[index].health);
}
if(sd.exists("xp")){
sd.get("xp", players[index].xp);
}
if(sd.exists("level")){
sd.get("level", players[index].level);
}
if(sd.exists("nsede")){
sd.get("nsede", players[index].nsede);
}
if(sd.exists("nfome")){
sd.get("nfome", players[index].nfome);
}
if(sd.exists("nurina")){
sd.get("nurina", players[index].nurina);
}
if(sd.exists("ncoco")){
sd.get("ncoco", players[index].ncoco);
}
if(sd.exists("sujo")){
sd.get("sujo", players[index].sujo);
}
if(sd.exists("ngripe")){
sd.get("ngripe", players[index].ngripe);
}
if(sd.exists("extintor")){
sd.get("extintor", players[index].extintor);
}
if(sd.exists("passaporte")){
sd.get("passaporte", players[index].passaporte);
}
sd.get("caverna", players[index].caverna);
sd.get("ncaverna", players[index].ncaverna);
if(players[index].ncaverna>0)players[index].tcaverna.force(players[index].ncaverna);
sd.get("achuva", players[index].achuva);
sd.get("nchuva", players[index].nchuva);
if(players[index].nchuva>0&&players[index].achuva)players[index].tmchuva.force(players[index].nchuva);
if(sd.exists("dalison2")){
sd.get("dalison2", players[index].dalison2);
}
if(sd.exists("questmontanha")){
sd.get("questmontanha", players[index].questmontanha);
}
if(sd.exists("terminouquestmontanha")){
sd.get("terminouquestmontanha", players[index].terminouquestmontanha);
}
if(sd.exists("questritual")){
sd.get("questritual", players[index].questritual);
}
if(sd.exists("terminouquestritual")){
sd.get("terminouquestritual", players[index].terminouquestritual);
}
if(sd.exists("questdesaparecida")){
sd.get("questdesaparecida", players[index].questdesaparecida);
}
if(sd.exists("terminouquestdesaparecida")){
sd.get("terminouquestdesaparecida", players[index].terminouquestdesaparecida);
}
if(file_exists(charfolder+"/admintudo.usr")==true)players[index].dev=true;
if(sd.exists("dbus")){
sd.get("dbus", players[index].dbus);
}
if(sd.exists("bazuca")){
sd.get("bazuca", players[index].bazuca);
}
if(sd.exists("galil")){
sd.get("galil", players[index].galil);
}
if(sd.exists("mp7")){
sd.get("mp7", players[index].mp7);
}
if(sd.exists("xp")){
sd.get("xp", players[index].xp);
}
if(sd.exists("matou")){
sd.get("matou", players[index].matou);
}
if(sd.exists("jaandou")){
sd.get("jaandou", players[index].jaandou);
}
if(sd.exists("javoou")){
sd.get("javoou", players[index].javoou);
}
if(sd.exists("noaviao")){
sd.get("noaviao", players[index].noaviao);
}
if(sd.exists("notrem")){
sd.get("notrem", players[index].notrem);
}
if(file_exists(charfolder+"/newbie.usr")) players[index].newbie=true;
if(players[index].newbie==false)send_reliable(players[index].peer_id, "fimnovato", 0);
if(sd.exists("pacifico")){
sd.get("pacifico", players[index].pacifico);
}
if(sd.exists("lregras")){
sd.get("lregras", players[index].lregras);
}
if(sd.exists("relogio")){
sd.get("relogio", players[index].relogio);
}
if(sd.exists("invs")){
sd.get("invs", players[index].invs);
}
if(players[index].invs==1) send_reliable(0,"playerbeep "+players[index].charname+" 0", 0);
if(sd.exists("msgliberdade")){
sd.get("msgliberdade", players[index].msgliberdade);
}
if(sd.exists("chegoucidade")){
sd.get("chegoucidade", players[index].chegoucidade);
}
if(sd.exists("anotado")){
sd.get("anotado", players[index].anotado);
}
if(players[index].paralisado==true)send_reliable(players[index].peer_id, "stopmoving", 0);
if(players[index].paralisado==true)players[index].tparalisado.restart();
if(sd.exists("tirostaser")){
sd.get("tirostaser", players[index].tirostaser);
}
send_reliable(players[index].peer_id, "selecionartirostaser "+players[index].tirostaser, 0);
if(sd.exists("bonemizuno")){
sd.get("bonemizuno", players[index].bonemizuno);
}
if(sd.exists("oculosmizuno")){
sd.get("oculosmizuno", players[index].oculosmizuno);
}
if(sd.exists("calcacamuflada")){
sd.get("calcacamuflada", players[index].calcacamuflada);
}
sd.get("sapatomagnetico", players[index].sapatomagnetico);
if(sd.exists("sapatoscarpin")){
sd.get("sapatoscarpin", players[index].sapatoscarpin);
}
if(sd.exists("calcalegging")){
sd.get("calcalegging", players[index].calcalegging);
}
if(sd.exists("coturnomilitar")){
sd.get("coturnomilitar", players[index].coturnomilitar);
}
if(sd.exists("pulseiraouro")){
sd.get("pulseiraouro", players[index].pulseiraouro);
}
if(sd.exists("chapeupanama")){
sd.get("chapeupanama", players[index].chapeupanama);
}
if(sd.exists("jaquetacouro")){
sd.get("jaquetacouro", players[index].jaquetacouro);
}
if(sd.exists("coletemizuno")){
sd.get("coletemizuno", players[index].coletemizuno);
}
if(sd.exists("camisamalha")){
sd.get("camisamalha", players[index].camisamalha);
}
if(sd.exists("calcajeans")){
sd.get("calcajeans", players[index].calcajeans);
}
if(sd.exists("pulseira")){
sd.get("pulseira", players[index].pulseira);
}
if(sd.exists("pulseirabronze")){
sd.get("pulseirabronze", players[index].pulseirabronze);
}
if(sd.exists("pulseiraprata")){
sd.get("pulseiraprata", players[index].pulseiraprata);
}
if(sd.exists("luvas")){
sd.get("luvas", players[index].luvas);
}
if(sd.exists("anel")){
sd.get("anel", players[index].anel);
}
if(sd.exists("calcamizuno")){
sd.get("calcamizuno", players[index].calcamizuno);
}
if(sd.exists("tenisnike")){
sd.get("tenisnike", players[index].tenisnike);
}
if(sd.exists("tenisadidas")){
sd.get("tenisadidas", players[index].tenisadidas);
}
if(sd.exists("ncolete")){
sd.get("ncolete", players[index].ncolete);
}
if(sd.exists("colete_aprova_de_balas")){
sd.get("colete_aprova_de_balas", players[index].colete_aprova_de_balas);
}
if(sd.exists("coletemilitar")){
sd.get("coletemilitar", players[index].coletemilitar);
}
if(sd.exists("capacetepolicia")){
sd.get("capacetepolicia", players[index].capacetepolicia);
}
if(sd.exists("coletecamuflado")){
sd.get("coletecamuflado", players[index].coletecamuflado);
}
if(sd.exists("coletesalvavida")){
sd.get("coletesalvavida", players[index].coletesalvavida);
}
if(players[index].inv_item_number("colete_salva_vida")>0&&players[index].coletesalvavida==1) send_reliable(players[index].peer_id, "usarcolete", 0);
if(sd.exists("negativo")){
sd.get("negativo", players[index].negativo);
}
if(sd.exists("fichaprisao")){
sd.get("fichaprisao", players[index].fichaprisao);
}
if(players[index].sexo==0) players[index].sexo2="a";
else if(players[index].sexo==1) players[index].sexo2="o";
if(sd.exists("kills")){
sd.get("kills", players[index].kills);
}
if(sd.exists("deaths")){
sd.get("deaths", players[index].deaths);
}
if(sd.exists("maxhealth")){
sd.get("maxhealth", players[index].maxhealth);
}
if(sd.exists("subirvida")){
sd.get("subirvida", players[index].subirvida);
}
f.open(charfolder+"/contabancaria.usr","r");
players[index].contabancaria=string_to_number(f.read());
f.close();
if(players[index].subirvida==1)players[index].maxhealth=50000;
//send_reliable(players[index].peer_id,"inv "+players[index].inv,0);
if(sd.exists("chats")){
sd.get("chats", players[index].chats);
}
if(sd.exists("mapavoltar")){
sd.get("mapavoltar", players[index].mapavoltar);
}
f.open(charfolder+"/votos.md", "r");
players[index].inq=string_to_number(f.read());
f.close();
if(players[index].mapavoltar=="galinheiro")players[index].mapavoltar="mundo_medieval";
if(players[index].map=="galinheiro")players[index].map="mundo_medieval";
f.open("maps/"+players[index].map+".map", "rb");
string wtext=f.read();
f.close();
send_reliable(players[index].peer_id, "changemap "+wtext+"\r\nx:"+players[index].x+"\r\ny:"+players[index].y+"\r\n", 0);
send_packet(0,"upl "+players[index].charname+" "+players[index].x+" "        +players[index].y+" "+players[index].map,players[index].map);
if(string_contains(players[index].map, "avião", 1)>-1||string_contains(players[index].map, "quadro", 1)>-1||string_contains(players[index].map, "trem", 1)>-1||string_contains(players[index].map, "ônibus", 1)>-1||players[index].map=="transatlântico")changemap("túnel",index,random(1, 99),0);
int mostrarconectou=1;
if(file_exists("players/"+players[index].charname+"/rtudo.usr")){
file_delete("players/"+players[index].charname+"/rtudo.usr");
players[index].maxhealth=5000;
players[index].health=5000;
players[index].matou=0;
}
for(uint coca=0;coca<tempocaiu.length();coca++){
if(tempocaiu[coca].nome==players[index].charname){
send_reliable(0, "msg2 "+players[index].charname+" ;recuperou a conexão.", 0);
mostrarconectou=0;
tempocaiu.remove_at(coca);
}
}
if(players[index].invs==0&&mostrarconectou==1) send_reliable(0,"on "+players[index].charname,0);
if (players.length()>peak){
send_reliable(0, "msgchegamosaumnovorecorde "+players.length(), 0);
send_reliable(0,"ps notify.ogg",0);
peak=players.length();
}
}
}
else send_reliable(id,"Erro: Este personagem não existe.", 0);
}
netloop();
}
void create(string un, string pw, string eml, int sexo, int id=event.peer_id)
{
bool cont=true;
string charfolder="players/"+un;
if(!string_is_alphanumeric(un) or un.length()<3 or un.length()>20)
{
send_reliable(id,"Erro: Este personagem é inválido.",0);
cont=false;
}
else if(directory_exists(charfolder))
{
send_reliable(id,"Erro: Este personagem já existe.",0);
cont=false;
}
else if (pw.length()<5 or !contains_num(pw) or !contains_let(pw)) {
send_reliable(id,"Erro: Essa senha é inválida. O mínimo é de 8 caractéres, entre letras e números.", 0);
cont=false;
}
else
{
if(cont==true)
{
directory_create(charfolder);
file f;
f.open(charfolder+"/email.usr","wb");
f.write(eml);
f.close();
//event=net.request();
f.open(charfolder+"/senha.usr","wb");
f.write(string_encrypt(pw,PASSWORD_ENCRYPTION_KEY));
f.close();
//event=net.request();
file inv;
inv.open("inv.inv","r");
string[] d_inv=string_split(inv.read(), "\r\n", false);
inv.close();
f.open(charfolder+"/inv.md","w");
f.write(linear(d_inv));
f.close();
dictionary sd;
int x=1, y=0, health=5000;
sd.set("x", x);
sd.set("y", y);
sd.set("sexo", sexo);
sd.set("map", "apresentação");
sd.set("health", health);
file pf;
pf.open(charfolder+"/configs.ini", "wb");
pf.write(serialize(sd));
pf.close();
send_reliable(id,"created",0);
//net.disconnect_peer_forcefully(id);
}
}
}
int get_player_index(uint id){
for(uint i=0; i<players.length(); i++){
if(players[i].peer_id==id)return i;
}
return -1;
}
int get_player_index_from(string name, bool hiddentoo=false){
for(uint i=0; i<players.length(); i++){
if(string_to_lower_case(players[i].charname)==string_to_lower_case(name)) return i;
}
return -1;
}
void write_to(string name, string fn, string c)
{
file f;
f.open("players/"+name+"/"+fn, "w");
f.write(c);
f.close();
}
void playerloop(){
for (uint ie=0; ie<players.length(); ie++){
if(players[ie].tinv.elapsed>=players[ie].ninv){
players[ie].ninv=random(30000, 60000);
if(players[ie].inv!="")write_to(players[ie].charname, "inv.md", players[ie].inv);
players[ie].tinv.restart();
}
if(players[ie].conectou==1){
if(players[ie].caverna==1&&players[ie].tcaverna.elapsed>=10800000){
players[ie].tcaverna.force(0);
players[ie].tcaverna.pause();
players[ie].ncaverna=-1;
players[ie].caverna=0;
send_reliable(players[ie].peer_id, "msgnormal Você sente seus músculos voltando ao normal...", 0);
}
if(players[ie].ncongelar==0&&congelou(ie)){
players[ie].ncongelar=1;
players[ie].tcongelar.restart();
}
else if(players[ie].ncongelar==1&&!congelou(ie)){
players[ie].ncongelar=0;
players[ie].tcongelar.force(0);
players[ie].tcongelar.pause();
}
if(players[ie].ncongelar==1&&players[ie].tcongelar.elapsed>=60000&&players[ie].casacopeles==0){
players[ie].ncongelar=0;
players[ie].tcongelar.force(0);
players[ie].tcongelar.pause();
players[ie].lasthit="congelado";
players[ie].health=-1;
}
if(players[ie].y<0){
players[ie].y=0;
send_reliable(players[ie].peer_id,"move "+players[ie].x+" "+players[ie].y,0);
send_packet(0,"upl "+players[ie].charname+" "+players[ie].x+" "        +players[ie].y+" "+players[ie].map,players[ie].map);
}
else if(players[ie].x<0){
players[ie].x=0;
send_reliable(players[ie].peer_id,"move "+players[ie].x+" "+players[ie].y,0);
send_packet(0,"upl "+players[ie].charname+" "+players[ie].x+" "        +players[ie].y+" "+players[ie].map,players[ie].map);
}
if(players[ie].achuva&&players[ie].tmchuva.elapsed>=players[ie].nchuva){
players[ie].tmchuva.force(0);
players[ie].tmchuva.restart();
players[ie].nchuva=0;
players[ie].achuva=false;
}
if(players[ie].jpescar&&players[ie].tppeixe.elapsed>=5000&&get_tile_at(players[ie].x, players[ie].y, players[ie].map)=="shallow"&&players[ie].map=="pesqueiro"&&players[ie].npescando==1){
players[ie].tppeixe.restart();
if(players[ie].ppeixe==1)send_packet10(0, players[ie].charname, players[ie].charname, "peixem"+random(1, 2)+".ogg "+players[ie].x+" "+players[ie].y, players[ie].map);
else if(players[ie].plinha==0){
int d=random(1, 100);
if(d<30)players[ie].ppeixe=1;
}
}
if(file_exists("players/"+players[ie].charname+"/paypal.md")){
file f;
f.open("players/"+players[ie].charname+"/paypal.md", "r");
string[] a=string_split(f.read(), "\r\n", false);
f.close();
for(uint i=0;i<a.length();i++){
string[] b=string_split(a[i], "=", false);
if(b.length()>1){
players[ie].inv_add_item(b[0], string_to_number(b[1]));
send_reliable(players[ie].peer_id, "msg2 "+b[1]+" ;"+b[0]+"; ;adicionado em seu inventário, comprado na loja virtual!", 0);
eadm(b[1]+" ;"+b[0]+"; ;adicionado no inventário de; "+players[ie].charname+".");
}
}
file_delete("players/"+players[ie].charname+"/paypal.md");
}
if(players[ie].tvarinha.elapsed>=5000&&players[ie].nvarinha<100){
players[ie].tvarinha.restart();
players[ie].nvarinha+=5;
if(players[ie].nvarinha>100)players[ie].nvarinha=100;
}
if(players[ie].is_admin()&&players[ie].pacifico==0 || players[ie].moderador==true&&players[ie].pacifico==0){
players[ie].pacifico=1;
send_reliable(players[ie].peer_id,"ininovato", 0);
send_reliable(0,"msgdepois "+players[ie].charname+" é agora pacifista!", 0);
send_reliable(0, "pp "+players[ie].charname+" "+players[ie].pacifico, 0);
}
if(players[ie].nomesequipe.length()==0)players[ie].nomesequipe.insert_last(players[ie].charname);
if(players[ie].maxhealth>50000)players[ie].maxhealth=50000;
if(players[ie].maxhealth<5000)players[ie].maxhealth=5000;
if(players[ie].health>players[ie].maxhealth)players[ie].health=players[ie].maxhealth;
players[ie].xprequerida=(players[ie].level*10);
if(players[ie].xp>players[ie].xprequerida){
players[ie].xp-=players[ie].xprequerida;
players[ie].level+=1;
for(uint a=0;a<players.length();a++){
if(players[a].avisanivel==1){
send_reliable(players[a].peer_id, "ps level2.ogg", 0);
send_reliable(players[a].peer_id, "msg2 "+players[ie].charname+"; ;alcançou o nível; ;"+players[ie].level+"!", 0);
}
}
players[ie].a10+=1;
if(players[ie].a10>=10){
players[ie].a10=0;
players[ie].inv_add_item("molotov", 5);
send_reliable(players[ie].peer_id, "ps menuvolta2.ogg", 0);
}
}
if(players[ie].tsugando.elapsed>=11106){
players[ie].tsugando.force(0);
players[ie].tsugando.pause();
players[ie].tsvida.force(0);
players[ie].tsvida.pause();
players[ie].tsitem.force(0);
players[ie].tsitem.pause();
if(!players[ie].paralisado&&!players[ie].paralisado2)send_reliable(players[ie].peer_id, "startmoving", 0);
int n=get_player_index_from(players[ie].nsugador);
if(n>-1){
if(!players[n].paralisado&&!players[n].paralisado2)send_reliable(players[n].peer_id, "startmoving", 0);
}
}
if(players[ie].tsvida.elapsed>=1000&&players[ie].sugando=="vida"){
players[ie].tsvida.restart();
int n=get_player_index_from(players[ie].nsugador);
if(n>-1){
if(get_player_distance(players[ie], players[n])>-1&&get_player_distance(players[ie], players[n])<3){
players[ie].health+=2000;
players[ie].maxhealth=players[ie].health;
players[n].health-=2000;
players[n].maxhealth=players[n].health;
players[n].lasthit="sugador_"+players[ie].charname;
send_packet(0, "play sv.ogg "+players[ie].x+" "+players[ie].y, players[ie].map);
}
}
}
if(players[ie].tsitem.elapsed>=1000&&players[ie].sugando=="itens"){
players[ie].tsitem.restart();
int n=get_player_index_from(players[ie].nsugador);
if(n>-1){
if(get_player_distance(players[ie], players[n])>-1&&get_player_distance(players[ie], players[n])<3){
string[] it;
it.reserve(6);
it.insert_last("real");
it.insert_last("coins");
it.insert_last("9mm");
it.insert_last("5.56mm");
it.insert_last("7.62mm");
it.insert_last("12mm");
int nb=random(0, it.length()-1);
int nrand=1;
if(it[nb]=="real")nrand=random(50, 200);
else if(it[nb]=="coins")nrand=random(300, 1000);
else nrand=random(1000, 4000);
if(players[n].inv_item_number(it[nb])<nrand)nrand=players[n].inv_item_number(nrand);
if(nrand>0){
players[ie].inv_add_item(it[nb], nrand, false);
players[n].inv_add_item(it[nb], -nrand, false);
send_packet(0, "play get"+it[nb]+".ogg "+players[ie].x+" "+players[ie].y, players[ie].map);
}
send_packet(0, "play si.ogg "+players[ie].x+" "+players[ie].y, players[ie].map);
}
}
}
if(players[ie].nsede<0)players[ie].nsede=0;
if(players[ie].nfome<0)players[ie].nfome=0;
if(players[ie].nsede>100)players[ie].nsede=100;
if(players[ie].nfome>100)players[ie].nfome=100;
if(players[ie].xp<0)players[ie].xp=0;
players[ie].tempotrancado=players[ie].fichaprisao * 30000 +60000;
if(players[ie].tdoente.elapsed>=60000&&players[ie].sujo>=50){
players[ie].tdoente.restart();
players[ie].doente+=10;
}
string dd=players[ie].map;
if(string_contains(dd, "avião", 1)<0&&string_contains(dd, "trem", 1)<0&&string_contains(dd, "atlântico", 1)<0&&dd!="biblioteca"&&dd!="ausente"){
if(players[ie].tdoente2.elapsed>=30000&&players[ie].doente>0){
players[ie].tdoente2.restart();
players[ie].lasthit="doente";
players[ie].health-=(players[ie].doente+100*players[ie].doente);
}
if(players[ie].tsedefome.elapsed>=60000&&players[ie].afk==false&&players[ie].newbie==false&&players[ie].map!="túnel"&&players[ie].map!="desafio_constante"&&players[ie].is_admin()==false){
players[ie].tsedefome.restart();
players[ie].nfome+=1;
players[ie].nsede+=1.5;
if(players[ie].nsede>89||players[ie].nfome>89)send_reliable(players[ie].peer_id, "ps magia_bolhaar_acabou.ogg", 0);
}
if(players[ie].nsede>=100){
players[ie].lasthit="sede";
players[ie].health=-1;
}
if(players[ie].nfome>=100){
players[ie].lasthit="fome";
players[ie].health=-1;
}
}
if(players[ie].maptraveltimer.elapsed>=60000&&players[ie].map=="galinheiro"){
players[ie].fichaprisao+=1;
changemap("prisão", ie, 1, 0);
send_reliable(players[ie].peer_id, "msgnormal Você ficou muito tempo no galinheiro, e foi fragad"+players[ie].sexo2+" pelo guardião.", 0);
players[ie].tempoprisao.restart();
players[ie].msgliberdade="Você cumpriu sua pena e está agora em liberdade!";
}
if(players[ie].lregras==0&&players[ie].map!="apresentação"){
changemap("apresentação", ie, 1, 0);
send_reliable(players[ie].peer_id, "msgtravelpoint Você está em um lugar cuja a grama possui um verde muito claro, que te deixa pensativ"+players[ie].sexo2+" por muitos minutos. Águas passam por represas ao seu redor, e você não consegue explicar todo esse esplendor. Seus pés parecem não mais estarem no chão, e o que antes era sólido tornou-se algo indescritível e tudo que você consegue saber é que você está em uma outra dimensão, paralela a todas as que conhecia. Uma suave música chega até seus ouvidos, acompanhada do canto dos pássaros. Uma deliciosa brisa bate no seu rosto, balançando seus cabelos alegremente como se quisesse lhe dizer \"Bem-vind"+players[ie].sexo2+" ao Entre a vida e a morte\". Seu corpo entra em total sintonia com este lugar, fazendo você pensar que isso poderia durar para sempre.", 0);
}
file f;
f.open("players/"+players[ie].charname+"/saldo.usr", "r");
int n=string_to_number(f.read());
f.close();
if(n>0){
players[ie].saldo+=(n);
send_reliable(players[ie].peer_id, "ps notify_beepup.ogg", 0);
send_reliable(players[ie].peer_id, "msg2 Você teve o valor de; ;"+n+"; ;reais depositados em sua conta.", 0);
file_delete("players/"+players[ie].charname+"/saldo.usr");
}
if(players[ie].subirvida==1&&file_exists("players/"+players[ie].charname+"/subirvida-data.usr")==true){
file f;
f.open("players/"+players[ie].charname+"/subirvida-data.usr", "r");
string[]x=string_split(f.read(), "/", false);
f.close();
if(x.length()<1)return;
if(DATE_DAY==string_to_number(x[0])&&DATE_MONTH==string_to_number(x[1])){
players[ie].subirvida=0;
write_to(players[ie].charname, "subirvida.usr", players[ie].subirvida);
file_delete("players/"+players[ie].charname+"subirvida-data.usr");
players[ie].maxhealth=5000;
if(players[ie].health>players[ie].maxhealth)players[ie].health=players[ie].maxhealth;
write_to(players[ie].charname, "maxhealth.usr", players[ie].maxhealth);
}
}
string zona=get_zone_at(players[ie].x,players[ie].y,players[ie].map);
if(players[ie].tszona.elapsed>=500&&get_tile_at(players[ie].x, players[ie].y, players[ie].map)!=""&&zona!="") players[ie].tszona.restart();
if(players[ie].map==""||get_tile_at(players[ie].x, players[ie].y, players[ie].map)==""&&zona==""&&players[ie].tszona.elapsed>=40000){
players[ie].y=10;
int xz=ymorrer;
if(players[ie].floating)xz=5;
changemap("túnel", ie, xmorrer, xz);
}
if(string_contains(zona,"fogo",1)!=-1||string_contains(zona,"Fogo",1)!=-1&&players[ie].tempofogo.elapsed>=500){
if(players[ie].calor_reprimido==false){
players[ie].tempofogo.restart();
players[ie].health-=random(200,500);
send_packet(0,"inithurt "+players[ie].voice+" "+players[ie].x+" "+players[ie].y, players[ie].map);
players[ie].lasthit="fogo";
}
}
if(players[ie].tlutar.elapsed>=20000&&players[ie].map==players[ie].nonomemapa){
players[ie].tlutar.force(0);
players[ie].tlutar.pause();
changemap(players[ie].nonomemapa, ie, random(6, 15), 0);
send_reliable(players[ie].peer_id, "ps valendo.ogg", 0);
}
if(players[ie].tmaquina.elapsed>=5284){
if(string_contains(players[ie].map, "banheiro", 1)>-1||players[ie].map=="transatlântico"||string_contains(players[ie].map, "apartamento", 1)>-1||players[ie].map=="castelo_medieval"||players[ie].map=="casa"){
send_reliable(players[ie].peer_id, "startmoving", 0);
players[ie].tmaquina.force(0);
players[ie].tmaquina.pause();
}
}
if(players[ie].tmaquina.elapsed>=10059&&players[ie].map=="silêncio2"){
send_reliable(players[ie].peer_id, "startmoving", 0);
players[ie].tmaquina.force(0);
players[ie].tmaquina.pause();
changemap(players[ie].mapaatual, ie, 1, 12);
}
if(players[ie].tmaquina.elapsed>=28554&&players[ie].map=="banco"||players[ie].tmaquina.elapsed>=28554&&string_contains(players[ie].map, "casa", 1)>-1||players[ie].tmaquina.elapsed>=28554&&players[ie].map=="apartamento"){
if(players[ie].map=="banco"){
players[ie].contabancaria=1;
send_reliable(players[ie].peer_id, "msgnormal Você criou sua conta bancária!", 0);
write_to(players[ie].charname, "contabancaria.usr", players[ie].contabancaria);
}
if(!players[ie].paralisado&&!players[ie].afk)send_reliable(players[ie].peer_id, "startmoving", 0);
players[ie].tmaquina.force(0);
players[ie].tmaquina.pause();
}
if(players[ie].tmaquina.elapsed>=31828&&players[ie].bus==1){
players[ie].bus=2;
send_reliable(players[ie].peer_id, "ps onibos2.ogg", 0);
players[ie].tmaquina.restart();
}
if(players[ie].tmaquina.elapsed>=25277&&players[ie].bus==2){
send_reliable(players[ie].peer_id, "startmoving", 0);
players[ie].paralisado2=false;
if(players[ie].dmaquina=="rmar")changemap("rodoviária", ie, random(94, 100), 0);
else if(players[ie].dmaquina=="rlos_angeles")changemap("rodoviária_de_los_angeles", ie, random(94, 100), 0);
players[ie].tmaquina.force(0);
players[ie].tmaquina.pause();
players[ie].bus=0;
}
if(players[ie].tmaquina.elapsed>=66891&&players[ie].namaquina==1){
players[ie].tmaquina.force(0);
players[ie].tmaquina.pause();
if(players[ie].dmaquina=="pré_história")changemap("pré_história", ie, 1, 0);
else if(players[ie].dmaquina=="mundo_medieval")changemap("mundo_medieval", ie, 1, 0);
players[ie].namaquina=0;
send_reliable(players[ie].peer_id, "startmoving", 0);
players[ie].paralisado2=false;
players[ie].inv_add_item("escudo_do_tempo", 1);
}
if(players[ie].tmaquina.elapsed>=600000&&players[ie].map=="transatlântico"){
players[ie].tmaquina.force(0);
players[ie].tmaquina.pause();
players[ie].chegounavio=1;
send_reliable(players[ie].peer_id, "ps buzina.ogg", 0);
}
if(players[ie].notrem==1&&players[ie].tempodentrotrem.elapsed>=60000){
players[ie].tempodentrotrem.restart();
players[ie].notrem=0;
changemap("trem", ie, 5, 0);
send_reliable(players[ie].peer_id, "msgdepois Finalmente! Após uma longa viagem você chega em seu destino final.", 0);
send_reliable(players[ie].peer_id, "startmoving", 0);
players[ie].paralisado2=false;
players[ie].jaandou=1;
}
if(players[ie].tempoprisao.elapsed>=players[ie].tempotrancado&&players[ie].map=="prisão"){
players[ie].tempoprisao.force(0);
players[ie].tempoprisao.pause();
send_reliable(players[ie].peer_id, "msgnormal "+players[ie].msgliberdade, 0);
write_to(players[ie].charname, "msgliberdade.usr", players[ie].msgliberdade);
if(players[ie].cidadenatal=="milão") changemap("delegacia_de_milão", ie, random(1, 20), 20);
else if(players[ie].cidadenatal=="los_angeles") changemap("delegacia", ie, random(1, 20), 20);
}
if(players[ie].envenenado&&players[ie].tempoveneno2.elapsed>=1000)
{
players[ie].tempoveneno2.restart();
players[ie].nveneno--;
if(players[ie].nveneno<=0)
{
players[ie].envenenado=false;
}
else
{
send_packet(0,"play veneno.ogg "+players[ie].x+" "+players[ie].y+" "+players[ie].map,players[ie].map);
players[ie].health-=100;
players[ie].lasthit="veneno";
}
}
if(players[ie].tparalisado.elapsed>=players[ie].nparalisado&&players[ie].paralisado==true&&players[ie].paralisado2==false){
players[ie].tparalisado.force(0);
players[ie].tparalisado.pause();
if(players[ie].vtempo==1){
changemap("casa", ie, random(17, 20), 12);
players[ie].vtempo=0;
}
send_reliable(players[ie].peer_id, "startmoving", 0);
players[ie].paralisado=false;
players[ie].nparalisado=0;
}
if(players[ie].carregandotaser.elapsed>=120000){
players[ie].carregandotaser.force(0);
players[ie].carregandotaser.pause();
send_reliable(players[ie].peer_id, "startmoving", 0);
send_reliable(players[ie].peer_id, "msgnormal Sua taser foi carregada.", 0);
send_reliable(players[ie].peer_id, "carregoutaser", 0);
players[ie].tirostaser=10;
write_to(players[ie].charname, "taser.usr", players[ie].tirostaser);
players[ie].paralisado=false;
players[ie].paralisado2=false;
}
if(players[ie].noaviao==1&&players[ie].tempovoandoaviao.elapsed>=180000){
players[ie].tempovoandoaviao.restart();
players[ie].noaviao=0;
write_to(players[ie].charname, "noaviao.usr", players[ie].noaviao);
changemap("avião", ie, 5, 0);
send_reliable(players[ie].peer_id, "msgdepois Finalmente! Após uma longa viagem você chega em seu destino final.", 0);
send_reliable(players[ie].peer_id, "startmoving", 0);
players[ie].paralisado2=false;
players[ie].javoou=1;
write_to(players[ie].charname, "javoou.usr", players[ie].javoou);
}
if(players[ie].atpacifista&&players[ie].atpacifistatempo.elapsed>=1000){
players[ie].atpacifistatempo.restart();
players[ie].atpacifistasegundos--;
if(players[ie].atpacifistasegundos<0){
players[ie].atpacifista=false;
send_reliable(0, "ps notify_text.ogg", 0);
if(players[ie].pacifico==0){
players[ie].pacifico=1;
send_reliable(players[ie].peer_id,"ininovato", 0);
send_reliable(0,"msgdepois "+players[ie].charname+" é agora pacifista!", 0);
send_reliable(0, "pp "+players[ie].charname+" "+players[ie].pacifico, 0);
for(uint i=0;i<bombarelogios.length();i++){
if(bombarelogios[i].nome==players[ie].charname)bombarelogios.remove_at(i);
}
for(uint i=0;i<bombaatomicas.length();i++){
if(bombaatomicas[i].nome==players[ie].charname)bombaatomicas.remove_at(i);
}
for(uint i=0;i<bombaremotas.length();i++){
if(bombaremotas[i].nome==players[ie].charname)bombaremotas.remove_at(i);
}
for(uint i=0;i<bombadefogos.length();i++){
if(bombadefogos[i].nome==players[ie].charname){
destroy_splay(bombadefogos[i].spa);
bombadefogos.remove_at(i);
}
}
for(uint i=0;i<projeteis.length();i++){
if(projeteis[i].nome==players[ie].charname){
destroy_moving_sound(projeteis[i].somprojetei);
projeteis.remove_at(i);
}
}
return;
}
if(players[ie].pacifico==1){
players[ie].pacifico=0;
send_reliable(players[ie].peer_id,"fimnovato", 0);
send_reliable(0,"msgdepois "+players[ie].charname+" deixou de ser pacifista!", 0);
send_reliable(0, "pp "+players[ie].charname+" "+players[ie].pacifico, 0);
return;
}
}
else send_packet10(0, players[ie].charname, players[ie].charname, "afktimer.ogg "+players[ie].x+" "+players[ie].y,players[ie].map);
}
if(players[ie].afking&&players[ie].afksecondtimer.elapsed>=1000)
{
players[ie].afksecondtimer.restart();
players[ie].afkseconds--;
if(players[ie].afkseconds<=0)
{
players[ie].afk=true;
players[ie].afking=false;
send_reliable(players[ie].peer_id,"stopmoving",0);
send_reliable(0,"ps afkon.ogg",0);
send_reliable(0,"msgdepois "+players[ie].charname+" está agora ausente!",0);
send_reliable(0,"playerbeep "+players[ie].charname+" 0",0);
players[ie].bipar=0;
}
else send_packet10(0, players[ie].charname, players[ie].charname, "afktimer.ogg "+players[ie].x+" "+players[ie].y,players[ie].map);
}
if(players[ie].castingtimer.elapsed>0&&players[ie].casting)
{
players[ie].curspelltimer.restart();
players[ie].casting=false;
if(players[ie].curspell=="cloak_start"&&players[ie].cloaked==false)
{
players[ie].cloaked=true;
send_reliable(players[ie].peer_id,"startcloak",0);
send_packet(0,"play spell_cloak_powerup.ogg "+players[ie].x+" "+players[ie].y+" "+players[ie].map,players[ie].map);
players[ie].cloakhiding=true;
send_reliable(0,"playerbeep "+players[ie].charname+" 0",0);
players[ie].bipar=0;
players[ie].tminvs.restart();
}
else if(players[ie].curspell=="deslize_veloz"){
send_reliable(players[ie].peer_id,"aveloz",0);
send_packet(0,"play spell_superjump.ogg "+players[ie].x+" "+players[ie].y, players[ie].map);
players[ie].tmveloz.restart();
players[ie].curspell="";
}
else if(players[ie].curspell=="cura_divina"&&!players[ie].curando){
players[ie].curspell="";
players[ie].curando=true;
players[ie].vx=players[ie].x;
players[ie].vy=players[ie].y;
players[ie].y=players[ie].y+50;
send_reliable(players[ie].peer_id, "stopmoving", 0);
send_reliable(players[ie].peer_id,"move "+players[ie].x+" "+players[ie].y,0);
send_packet(0,"upl "+players[ie].charname+" "+players[ie].x+" "        +players[ie].y+" "+players[ie].map,players[ie].map);
send_reliable(players[ie].peer_id, "play wind1.ogg "+players[ie].x+" "+players[ie].y, 0);
players[ie].health=players[ie].maxhealth;
players[ie].tmagia.restart();
}
else if(players[ie].curspell=="chuva_de_meteoros"){
players[ie].achuva=true;
players[ie].tmchuva.restart();
players[ie].curspell="";
send_reliable(0, "ps chuvademeteoros.ogg", 0);
for(uint i=0;i<players.length();i++){
if(!players[i].afk&&players[i].pacifico==0){
players[i].health=-1;
players[i].lasthit="meteoro_"+players[ie].charname;
}
}
}
else if(players[ie].curspell=="electrobomb")
{
send_packet(0,"play spell_electrobomb.ogg "+players[ie].x+" "+players[ie].y,players[ie].map);
for(uint j=0; j<players.length; j++)
{
if(players[j].charname!=players[ie].charname&&get_player_distance(players[ie],players[j])>-1&&get_player_distance(players[ie],players[j])<=10&&players[j].insz==false&&players[j].pacifico==0&&players[j].newbie==false&&players[j].afk==false&&!emequipe(players[ie].charname, players[j].charname))
{
send_packet(0,"impact spell_electrobomb_hit.ogg "+players[j].x+" "+players[j].y, players[j].map);
send_packet(0,"inithurt "+players[j].voice+" "+players[j].x+" "+players[j].y, players[j].map);
players[j].health-=random(150,1500);
players[j].lasthit=players[ie].charname+"'s electrobomb spell";
}
}
}
else if(players[ie].curspell=="superjump"){
send_reliable(players[ie].peer_id,"superjumpon",0);
send_packet(0,"play spell_superjump.ogg "+players[ie].x+" "+players[ie].y+" "+players[ie].map,players[ie].map);
players[ie].tmpulo.restart();
}
else if(players[ie].curspell=="bolha_de_ar"){
players[ie].bolhaar=true;
send_packet(0,"play magia_bolhaar.ogg "+players[ie].x+" "+players[ie].y+" "+players[ie].map,players[ie].map);
players[ie].bolhaseconds=30;
players[ie].bolhatimer.restart();
send_reliable(players[ie].peer_id,"bolhadearon",0);
}
else if(players[ie].curspell=="calor_reprimido"){
players[ie].calor_reprimido=true;
send_packet(0,"play magia_fogo_iniciou.ogg "+players[ie].x+" "+players[ie].y+" "+players[ie].map,players[ie].map);
players[ie].calorseconds=30;
players[ie].calortimer.restart();
}
else if(players[ie].curspell=="float"){
players[ie].y+=5;
send_reliable(players[ie].peer_id,"startfloat",0);
send_reliable(players[ie].peer_id,"move "+players[ie].x+" "+players[ie].y,0);
send_packet(0,"play spell_float_on.ogg "+players[ie].x+" "+players[ie].y,players[ie].map);
players[ie].tmflutuar.restart();
}
else if(players[ie].curspell=="campo_magnético"){
players[ie].star=true;
destroy_moving_sound(players[ie].starsoundid);
players[ie].starsoundid=spawn_moving_sound("limp.ogg",players[ie].x,players[ie].y,players[ie].map);
players[ie].tmcampo.restart();
}
else if(players[ie].curspell=="espelho_refletor"){
players[ie].star2=true;
destroy_moving_sound(players[ie].starsoundid);
players[ie].starsoundid=spawn_moving_sound("espelholoop.ogg",players[ie].x,players[ie].y,players[ie].map);
players[ie].tmcampo2.restart();
}
else if(players[ie].curspell=="punho_de_hórus"){
send_packet(0,"ps chute.ogg",players[ie].map);
for(uint j=0; j<players.length; j++){
if(players[j].charname!=players[ie].charname&&get_player_distance(players[ie],players[j])>-1&&get_player_distance(players[ie],players[j])<=15&&players[j].insz==false&&players[j].pacifico==0&&players[j].newbie==false&&players[j].afk==false&&!emequipe(
players[ie].charname, players[j].charname)){
send_packet(0,"impact socoforte1.ogg "+players[j].x+" "+players[j].y, players[j].map);
send_packet(0,"inithurt "+players[j].voice+" "+players[j].x+" "+players[j].y, players[j].map);
players[j].health-=random(4000, 5000);
players[j].lasthit="punho_"+players[ie].charname;
break;
}
}
}
else if(players[ie].curspell=="bola_de_fogo"){
colocar_boladefogo(players[ie].charname, players[ie].lado, players[ie].map, players[ie].x, players[ie].y);
players[ie].curspell="";
}
else if(players[ie].curspell=="thunder")
{
for(uint j=0; j<players.length; j++){
if(players[j].charname!=players[ie].charname&&get_player_distance(players[ie],players[j])>-1&&get_player_distance(players[ie],players[j])<=100&&players[j].insz==false&&players[j].pacifico==0&&players[j].newbie==false&&players[j].afk==false&&!emequipe(players[ie].charname, players[j].charname)){
send_packet(0,"impact trovão8.ogg "+players[j].x+" "+players[j].y, players[j].map);
send_packet(0,"inithurt "+players[j].voice+" "+players[j].x+" "+players[j].y, players[j].map);
players[j].health-=(players[j].health/2+random(1000, 2000));
players[j].lasthit="trovão_"+players[ie].charname;
}}
}
players[ie].curspell="";
}
if(players[ie].tminvs.elapsed>=60000){
players[ie].cloaked=false;
send_reliable(players[ie].peer_id,"stopcloak",0);
send_packet(0,"play spell_cloak_hideoff.ogg "+players[ie].x+" "+players[ie].y,players[ie].map);
if(!players[ie].afk){
send_reliable(0,"playerbeep "+players[ie].charname+" 1",0);
players[ie].bipar=1;
}
players[ie].tminvs.force(0);players[ie].tminvs.pause();
}
if(players[ie].tmagia.elapsed>=2000){
players[ie].x=players[ie].vx;
players[ie].y=players[ie].vy;
send_reliable(players[ie].peer_id,"move "+players[ie].x+" "+players[ie].y,0);
send_packet(0,"upl "+players[ie].charname+" "+players[ie].x+" "        +players[ie].y+" "+players[ie].map,players[ie].map);
send_reliable(players[ie].peer_id, "startmoving", 0);
players[ie].tmagia.force(0);
players[ie].tmagia.pause();
players[ie].curando=false;
}
if(players[ie].tmveloz.elapsed>=50000){
send_reliable(players[ie].peer_id,"dveloz",0);
send_packet(0,"play spell_cloak_hideoff.ogg "+players[ie].x+" "+players[ie].y,players[ie].map);
players[ie].tmveloz.force(0);players[ie].tmveloz.pause();
}
if(players[ie].tmpulo.elapsed>=30000){
send_packet(0,"play spell_superjump_off.ogg "+players[ie].x+" "+players[ie].y,players[ie].map);
send_reliable(players[ie].peer_id,"superjumpoff",0);
players[ie].tmpulo.force(0);players[ie].tmpulo.pause();
}
if(players[ie].tmcampo.elapsed>=27000){
destroy_moving_sound(players[ie].starsoundid);
players[ie].starsoundid="";
players[ie].star=false;
players[ie].tmcampo.force(0);players[ie].tmcampo.pause();
}
if(players[ie].tmcampo2.elapsed>=60000){
destroy_moving_sound(players[ie].starsoundid);
players[ie].starsoundid="";
players[ie].star2=false;
players[ie].tmcampo2.force(0);players[ie].tmcampo2.pause();
}
if(players[ie].tmflutuar.elapsed>=30000){
send_packet(0,"play spell_float_off.ogg "+players[ie].x+" "+players[ie].y+" "+players[ie].map,players[ie].map);
send_reliable(players[ie].peer_id,"stopfloat",0);
players[ie].tmflutuar.force(0);players[ie].tmflutuar.pause();
}
if(players[ie].telestage==1&&players[ie].telestagetimer.elapsed>=5000)
{
destroy_moving_sound(players[ie].tfid);
players[ie].tfid="";
players[ie].telestage=2;
send_packet(0,"play teleporter_disappear.ogg "+players[ie].x+" "+players[ie].y+" "+players[ie].map,players[ie].map);
players[ie].telestagetimer.restart();
send_reliable(players[ie].peer_id,"ps teleporter_bringup.ogg",0);
}
if(players[ie].telestage==2&&players[ie].telestagetimer.elapsed>=1150)
{
players[ie].telestage=0;
players[ie].x=1;
players[ie].y-=5;
send_reliable(players[ie].peer_id,"move "+players[ie].x+" "+players[ie].y,0);
send_reliable(players[ie].peer_id,"ps teleporter_bringdown.ogg",0);
send_packet(0,"play teleporter_appear.ogg "+players[ie].x+" "+players[ie].y+" "+players[ie].map,players[ie].map);
send_reliable(players[ie].peer_id,"startmoving",0);
changemap(players[ie].telemap,ie);
players[ie].inv_add_item("escudo_do_tempo", -players[ie].inv_item_number("escudo_do_tempo"));
}
if(players[ie].star)
{
if(players[ie].startimer.elapsed>1000)
{
players[ie].startimer.restart();
players[ie].starseconds-=1;
if(players[ie].starseconds>0&&players[ie].starseconds<6) send_reliable(players[ie].peer_id,"ps starwarn.wav",0);
if(players[ie].starseconds==0)
{
send_packet(0,"play staroff.ogg "+players[ie].x+" "+players[ie].y+" "+players[ie].map,players[ie].map);
players[ie].star=false;
destroy_moving_sound(players[ie].starsoundid);
players[ie].starsoundid="";
send_reliable(players[ie].peer_id,"staroff",0);
}
}
}
if(players[ie].bolhatimer.elapsed>1000)
{
players[ie].bolhatimer.restart();
players[ie].bolhaseconds-=1;
if(players[ie].bolhaseconds>0&&players[ie].bolhaseconds<11) send_reliable(players[ie].peer_id,"ps magia_bolhaar_acabou.ogg",0);
if(players[ie].bolhaseconds==0)
{
send_packet(0,"play magia_bolhaar_acabou.ogg "+players[ie].x+" "+players[ie].y+" "+players[ie].map,players[ie].map);
players[ie].bolhaar=false;
send_reliable(players[ie].peer_id,"bolhaaroff",0);
}
}
if(players[ie].calortimer.elapsed>1000)
{
players[ie].calortimer.restart();
players[ie].calorseconds-=1;
if(players[ie].calorseconds>0&&players[ie].calorseconds<11) send_reliable(players[ie].peer_id,"ps magia_fogo.ogg",0);
if(players[ie].calorseconds==0)
{
send_packet(0,"play staroff.ogg "+players[ie].x+" "+players[ie].y+" "+players[ie].map,players[ie].map);
players[ie].calor_reprimido=false;
}
}
if(players[ie].negativo>0)//Verifica se a variável negativo está maior que zero
{
if (players[ie].inv_item_number("coins")>=players[ie].negativo)//Verifica se
{
players[ie].inv_add_item("coins", 0-players[ie].negativo);//Tira a quantidade da variável negativo
players[ie].negativo=0;
write_to(players[ie].charname,"negativo.usr",players[ie].negativo);
}
}
}
}
}
string pegartelhado(string mapa){
file f;
f.open("maps/"+mapa+".map", "r");
string[] m=string_split(f.read(), "\r\n", false);
for(uint i=0;i<m.length();i++){
if(string_contains(m[i], "teto", 1)>-1){
string[] mm=string_split(m[i], ":", false);
return mm[1];
}
}
return "rain4.ogg";
}
void writeprefs()
{
file pr;
pr.open("servidor.configs", "wb");
pr.write("minuto="+minuto+"
hora="+hora+"
day="+day+"
month="+month+"
year="+year+"
timetime="+timetime+"
objtime="+objtime+"
peak="+peak+"
msalvar="+msalvar+"
votos2d="+votos2d+"
votos3d="+votos3d+"
andar1="+andar1+"
andar2="+andar2+"
andar3="+andar3+"
andar4="+andar4+"
andar5="+andar5+"
andar6="+andar6+"
andar7="+andar7+"
andar8="+andar8+"
andar9="+andar9+"
andar10="+andar10+"

andar11="+andar11+"
andar12="+andar12+"
andar13="+andar13+"
andar14="+andar14+"
andar15="+andar15+"
andar16="+andar16+"
andar17="+andar17+"
andar18="+andar18+"
andar19="+andar19+"
andar20="+andar20+"
andar21="+andar21+"
andar22="+andar22+"
andar23="+andar23+"
andar24="+andar24+"
andar25="+andar25+"
andar26="+andar26+"
andar27="+andar27+"
andar28="+andar28+"
andar29="+andar29+"
andar30="+andar30+"
andar31="+andar31+"
andar32="+andar32+"
andar33="+andar33+"
andar34="+andar34+"
andar35="+andar35+"
andar36="+andar36+"
andar37="+andar37+"
andar38="+andar38+"
andar39="+andar39+"
andar40="+andar40+"
andar41="+andar41+"
andar42="+andar42+"
andar43="+andar43+"
andar44="+andar44+"
andar45="+andar45+"
andar46="+andar46+"
andar47="+andar47+"
andar48="+andar48+"
andar49="+andar49+"
andar50="+andar50+"
port="+port);
pr.close();
string[] b=find_files("maps/*");
for(uint i=0;i<apartamentos.length();i++){
for(uint i2=0;i2<b.length();i2++){
if(string_contains(b[i2], "apartamento", 1)>-1&&string_contains(b[i2], apartamentos[i].map, 1)>-1){
file z;
string narquivo=b[i2];
narquivo=string_replace(narquivo, "apartamento_de_", "", false);
narquivo=string_replace(narquivo, ".map", "", false);
z.open("players_apartamentos/"+narquivo+"_baú.usr", "w");
z.write(apartamentos[i].apartamentoinv);
z.close();
break;
}
}
}
for(uint i=0;i<computadors.length();i++){
for(uint i2=0;i2<b.length();i2++){
if(string_contains(b[i2], "apartamento", 1)>-1&&string_contains(b[i2], computadors[i].map, 1)>-1){
file z;
string narquivo=b[i2];
narquivo=string_replace(narquivo, "apartamento_de_", "", false);
narquivo=string_replace(narquivo, ".map", "", false);
z.open("players_apartamentos/"+narquivo+"_pc.usr", "w");
z.write(computadors[i].codcasa+";"+computadors[i].seguro+";"+computadors[i].abau+";"+computadors[i].relogio);
z.close();
break;
}
}
}
for (uint i=0; i<players.length(); i++)
{
write_to(players[i].charname,"playtime.usr",players[i].playtime);
sconfigs(i);
}
pr.open("servidor.nban", "w");
pr.write(linear(nban));
pr.close();
pr.open("banidos.dat", "w");
pr.write(linear(banidos));
pr.close();
pr.open("servidor.msgadm", "w");
pr.write(linear(msgadm));
pr.close();
}
void changemap(string map,int index, int x=1, int y=0, string audio="")
{
if (players[index].map==map)
{
players[index].x=x;
players[index].y=y;
if(players[index].invs==0&&audio!="") send_packet(0,"play "+audio+".ogg "+players[index].x+" "        +players[index].y+" "+players[index].map,players[index].map);
send_reliable(players[index].peer_id,"move "+players[index].x+" "+players[index].y,0);
}
else
{
file f;
f.open("maps/"+map+".map", "rb");
players[index].map=map;
string wtext=f.read();
f.close();
send_reliable(players[index].peer_id, "changemap "+wtext+"\r\nx:"+x+"\r\ny:"+y+"\r\n", 0);
players[index].x=x;
players[index].y=y;
if(players[index].map!="túnel"){
players[index].mapavoltar=players[index].map;
}
if(audio!=""){
send_packet(0,"play "+audio+".ogg "+players[index].x+" "        +players[index].y+" "+players[index].map,players[index].map);
}
if(players[index].starsoundid!=""&&players[index].star)
{
destroy_moving_sound(players[index].starsoundid);
players[index].starsoundid=spawn_moving_sound("limp.ogg",players[index].x,players[index].y,players[index].map);
}
send_reliable(0,"upl "+players[index].charname+" "+players[index].x+" "        +players[index].y+" "+players[index].map, 0);
if(varinha_desativada(players[index].map)){
if(players[index].tminvs.elapsed>0){
players[index].tminvs.force(0);
players[index].tminvs.pause();
players[index].cloaked=false;
send_reliable(players[index].peer_id,"stopcloak",0);
send_reliable(0,"playerbeep "+players[index].charname+" 1",0);
players[index].bipar=1;
}
if(players[index].star){
players[index].star=false;
destroy_moving_sound(players[index].starsoundid);
}
if(players[index].tmveloz.elapsed>0){
send_reliable(players[index].peer_id,"dveloz",0);
players[index].tmveloz.force(0);players[index].tmveloz.pause();
}
if(players[index].tmpulo.elapsed>0){
send_reliable(players[index].peer_id,"superjumpoff",0);
players[index].tmpulo.force(0);players[index].tmpulo.pause();
}
if(players[index].star2){
players[index].star2=false;
destroy_moving_sound(players[index].starsoundid);
}
}
for(uint iba=0; iba<msounds.length(); iba++)
{
if(msounds[iba].map==players[index].map)send_reliable(players[index].peer_id,"cm "+msounds[iba].id+" "+msounds[iba].soundloop+" "+msounds[iba].x+" "+msounds[iba].y+" "+msounds[iba].map, 0);
}
for(uint i=0;i<apartamentos.length();i++){if(apartamentos[i].map==players[index].map)send_reliable(players[index].peer_id, "apartamentoinv "+apartamentos[i].apartamentoinv, 0);}
for(uint i=0;i<computadors.length();i++){
if(computadors[i].map==players[index].map){
string opcoespc="Exibir estatísticas=status\r\nAlternar modo de segurança entre choque e alarme=segurança\r\nImprimir um documento=imprimir\r\nEnviar ideia=ideia";
opcoespc+="\r\n"+(computadors[i].relogio==0?"Desativar":"Ativar")+" relógio=relógio";
if(computadors[i].talarme==1)opcoespc+="\r\nDesativar alarme=alarme";
if(adm_apartamento(players[index].dalison2, computadors[i].map)){
opcoespc+="\r\n"+(computadors[i].abau==0? "não permitindo":"permitindo")+" que os outros abram seu baú";
if(computadors[i].fbau==1)opcoespc+="\r\nFechar baú=fecharbaú";
if(computadors[i].tabrir.elapsed<=0)opcoespc+="\r\nAbrir porta por 5 segundos=porta";
opcoespc+="\r\nExpulsar jogadores de seu apartamento=expulsar";
opcoespc+="\r\nTrocar código de acesso=mcod";
}
if(players[index].is_admin())opcoespc+="\r\nLer mensagens administrativas=administrativas";
send_reliable(players[index].peer_id, "opcoespc "+opcoespc, 0);
send_reliable(players[index].peer_id,"spawncomputador "+computadors[i].id+" "+computadors[i].x+" "+computadors[i].y+" "+computadors[i].map+" "+computadors[i].ligada,0);
break;
}
}
for(uint iba=0; iba<splays.length(); iba++){
send_reliable(players[index].peer_id,"csplay "+splays[iba].id+" "+splays[iba].soundloop+" "+splays[iba].map, 0);
}
for(uint iza=0; iza<maquinatempos.length(); iza++)
{
send_reliable(players[index].peer_id,"spawnmaquinatempo "+maquinatempos[iza].id+" "+maquinatempos[iza].x+" "+maquinatempos[iza].y+" "+maquinatempos[iza].map+" "+maquinatempos[iza].ligada,0);
}
senditems(index);
}
checarambiente2(index);
if(players[index].map=="ônibus"){
players[index].bus=1;
players[index].tmaquina.restart();
}
if(players[index].map=="transatlântico")players[index].tmaquina.restart();
if(players[index].map=="trem_andando"){
players[index].jaandou=0;
players[index].notrem=1;
players[index].tempodentrotrem.restart();
}
if(string_contains(players[index].map, "avião", 1)>-1&&players[index].map!="avião2"||string_contains(players[index].map, "trem", 1)>-1&&players[index].jaandou==1||string_contains(players[index].map, "ônibus", 1)>-1){
send_reliable(players[index].peer_id, "stopmoving", 0);
players[index].paralisado2=true;
}
}
void update(string map)
{
for (uint i=0; i<players.length(); i++)
{
if(players[i].map==map)
{
file f;
f.open("maps/"+map+".map", "rb");
send_reliable(players[i].peer_id, "changemap "+f.read()+"\r\nx:"+players[i].x+"\r\ny:"+players[i].y+"\r\n", 0);
f.close();
senditems(i);
}
}
}
void update2(string map)
{
for (uint i=0; i<players.length(); i++)
{
if(players[i].map==map)
{
file f;
f.open("maps/"+map+".map", "rb");
send_reliable(players[i].peer_id, "changemap2 "+f.read()+"\r\nx:"+players[i].x+"\r\ny:"+players[i].y+"\r\n", 0);
f.close();
senditems(i);
}
}
}
void inv(int index, string data, uint peer_id)
{
string[] parsed=string_split(data, "=", false);
if(parsed.length() <2)
{
return;
}
string rname=parsed[0];
if(rname=="bazuca"||rname=="controle_para_fita_explosiva"||rname=="ak48"||rname=="varinha"||rname=="sapato_magnético"||rname=="bicicleta"||rname=="lançador_de_dardos"||rname=="vulcan"||rname=="paraquedas"||rname=="bomba_nuclear"||rname=="colete_aprova_de_balas"||rname=="colete_salva_vida"||rname=="pente_customizado") return;
int iv=string_to_number(parsed[1]);
if(iv==0)
{
send_reliable(peer_id, "no change was needed", 0);
return;
}
players[index].inv_add_item(rname, iv);
send_reliable(peer_id, "done", 0);
}
void inv_total(int index, string data, uint peer_id)
{
string[] parsed=string_split(data, "=", false);
if(parsed.length() <2)
{
return;
}
string rname=parsed[0];
int iv=string_to_number(parsed[1]);
if(iv==0)
{
send_reliable(peer_id, "no change was needed", 0);
return;
}
players[index].inv_add_item(rname, iv);
send_reliable(peer_id, "done", 0);
}
void senditems(int index)
{
for (uint i=0; i<objs.length(); i++)
{
if (objs[i].map==players[index].map)
send_reliable(players[index].peer_id,"spawn_obj "+objs[i].x+" "+objs[i].y+" "+objs[i].map+" "+objs[i].item+" "+objs[i].num,0);
}
}
void send_packet(int channel,string packet,string mapname){
if(!tjogador(mapname)||mapname==mapainicial)return;
string[] a=string_split(packet, " ", false);
int x=0;
for(uint i=0;i<a.length();i++){
if(string_to_number(a[i])>0){
x=string_to_number(a[i]);
break;
}
}
/*
file f;
f.open("ver.txt", "ab");
f.write(players.length()+", "+packet);
f.close();
*/
for (int i=x-20; i<=x+20; i++){
for (uint ie4=0; ie4<players.length(); ie4++){
if (players[ie4].x==i&&players[ie4].map==mapname) send_reliable(players[ie4].peer_id,packet,channel);
}
}
}
void send_packet_unreliable(int channel,int x, string packet,string mapname){
for (int i=x-20; i<=x+20; i++){
for (uint ie4=0; ie4<players.length(); ie4++){
if(players[ie4].map==mapname&&players[ie4].x==i)send_unreliable(players[ie4].peer_id,packet,channel);
}
}
}
void send_packet2(int channel,string packet, string packet2, string mapname){
for (uint ie4=0; ie4<players.length(); ie4++){
if (players[ie4].map==mapname){
string mfinal=packet;
send_unreliable(players[ie4].peer_id,mfinal,channel);
}
}
}
void send_packet3(int channel,string packet,string mapname){
for (uint ie4=0; ie4<players.length(); ie4++){
if (players[ie4].map==mapname) send_reliable(players[ie4].peer_id,packet,channel);
}
}
void send_packetn(int channel,string nnome, string packet,string mapname){
for (uint ie4=0; ie4<players.length(); ie4++){
if (players[ie4].map==mapname&&players[ie4].charname!=nnome) send_reliable(players[ie4].peer_id,packet,channel);
}
}
void send_packet10(uint canal, string jogador1, string jogador2, string pacote, string mapa){
for(uint i=0;i<players.length();i++){
if(players[i].map==mapa){
if(players[i].charname==jogador1||players[i].charname==jogador2)send_reliable(players[i].peer_id, "ps "+pacote, 0);
else if(players[i].charname!=jogador1&&players[i].charname!=jogador2)send_reliable(players[i].peer_id, "play "+pacote, 0);
}
}
}
void add_to_store(string item, int amount){
items.insert_last(item);
amounts.insert_last(amount);
}
int get_store_index(string item)
{
for (uint i=0; i<items.length(); i++)
{
if (item==items[i])
{
return i;
}
}
return -1;
}
void add_map(string name)
{
maps.insert_last(name);
file f;
f.open("servidor.maps","wb");
f.write(linear(maps));
f.close();
}
void delete_map(string name)
{
for (uint i=0; i<maps.length(); i++)
{
if (maps[i]==name)
{
maps.remove_at(i);
}
}
file f;
f.open("servidor.maps","wb");
f.write(linear(maps));
f.close();
}
string get_player_password(string playername)
{
file passfile;
passfile.open("players/"+playername+"/senha.usr","rb");
string ret=passfile.read();
passfile.close();
ret=string_decrypt(ret,PASSWORD_ENCRYPTION_KEY);
return ret;
}
bool is_unbannable(string username)
{
if(!file_exists("unbannables.txt")) return false;
file f;
f.open("unbannables.txt","rb");
string[] unbannables=string_split(f.read(),"\r\n",false);
f.close();
if(unbannables.find(username)>-1) return true;
else return false;
}
bool changepassword(string name, string newpassword)
{
if(!file_exists("players/"+name+"/senha.usr")) return false;
else
{
file f;
bool ret;
ret=f.open("players/"+name+"/senha.usr","wb");
if(!ret) return false;
f.write(string_encrypt(newpassword,PASSWORD_ENCRYPTION_KEY));
f.close();
return true;
}
}
void change_password(string name, string oldpass, string newpass, uint id){
if(oldpass==newpass){
send_reliable(id,"msgnormal Não vejo o porque de alterar uma senha igual ela já está.", 0);
return;
}
else if(get_player_password(name)!=oldpass){
send_reliable(id,"msgnormal Erro: Senha atual errada.", 0);
return;
}
else if(oldpass==get_player_password(name)){
bool retthing=changepassword(name,newpass);
if(!retthing)send_reliable(id,"msgnormal Não foi possível alterar sua senha.", 0);
else send_reliable(id,"msgnormal Sua senha foi alterada!", 0);
}
}
bool send_reliable(uint peerid, string packet, int channel){
packet=string_encrypt(packet, NETWORK_ENCRYPTION_KEY);
return net.send_reliable(peerid,packet,channel);
}
void send_reliablen(uint peerid, string nnome, string packet, int channel){
for(uint i=0;i<players.length();i++){
if(players[i].charname!=nnome)send_reliable(players[i].peer_id, packet,channel);
}
}
string get_event_message(){
return string_decrypt(event.message, NETWORK_ENCRYPTION_KEY);
}
bool contains_num(string str) {
bool r=false;
for(uint i=0; i<10; i++) {
if (string_contains(str, ""+i, 1)!=-1) {
r=true;
break;
}
}
return r;
}

bool contains_let(string str) 
{
string l="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
bool r=false;
for(uint i=0; i<l.length(); i++) {
if (string_contains(str, string_to_lower_case(l[i]), 1)!=-1) {
r=true;
break;
}
}
return r;
}
string randomstring(uint length=5)
{
string temp="abcdefghijklmnopqrstuvwxyz1234567890";
string ret;
for(uint i=0; i<length; i++)
{
ret=ret+temp[random(0,(temp.length()-1))];
}
return ret;
}
bool send_unreliable(uint peerid, string packet, int channel)
{
packet=string_encrypt(packet, NETWORK_ENCRYPTION_KEY);
return net.send_unreliable(peerid,packet,channel);
}
void checarhora()
{
string mensagem;
if(hora==0)
{
send_reliable(0,"ps coruja.ogg",0);
int mostrar=random(0,1);
if(mostrar==0)
{
mensagem="Os últimos raios alaranjados se fazem visíveis, à medida que o Sol retorna ao horizonte.";
}
else if(mostrar==1)
{
mensagem="A claridade do dia se desvanece aos poucos, dando lugar ao cinzento crepúsculo.";
}
send_reliable(0,"msgnormal "+mensagem,0);
}
else if(hora==6)
{
send_reliable(0,"ps voar.ogg",0);
int mostrar=random(0,1);
if(mostrar==0)
{
mensagem="Pássaros despertam e iniciam seu gorjear na distância. Um novo dia se aproxima.";
}
else if(mostrar==1)
{
mensagem="O Sol deslisa de detrás do horizonte, trazendo consigo uma nova manhã.";
}
send_reliable(0,"msgnormal "+mensagem,0);
}
badalar.restart();
nbadalar=hora;
}
void add_to_loja(string item2, int amount2)
{
items2.insert_last(item2);
amounts2.insert_last(amount2);
}
int get_loja_index(string item2)
{
for (uint i=0; i<items2.length(); i++)
{
if (item2==items2[i])
{
return i;
}
}
return -1;
}
void add_to_loja2(string item2, int amount2)
{
items2loja2.insert_last(item2);
amounts2loja2.insert_last(amount2);
}
int get_loja2_index(string item2)
{
for (uint i=0; i<items2loja2.length(); i++)
{
if (item2==items2loja2[i])
{
return i;
}
}
return -1;
}
void outrosloop(){
if(upzh==5){
writeprefs();
send_reliable(0, "reiniciar", 0);
file ff;
ff.open("servidor.reiniciado", "w");
ff.write("semana "+upw+"\r\ndia "+upd+"\r\nhora "+uph+"\r\nminuto "+upm);
for(uint i=0;i<megadragonsauros.length();i++){
ff.write("\r\nmegadragonsauro "+megadragonsauros[i].x+" "+megadragonsauros[i].y+" "+megadragonsauros[i].map+" "+megadragonsauros[i].vida);
}
for(uint i=0;i<dragonsauros.length();i++){
ff.write("\r\ndragonsauro "+dragonsauros[i].x+" "+dragonsauros[i].y+" "+dragonsauros[i].map+" "+dragonsauros[i].vida);
}
for(uint i=0;i<carrosfortes.length();i++){
ff.write("\r\ncarroforte "+carrosfortes[i].x+" "+carrosfortes[i].y+" "+carrosfortes[i].mapa+" "+carrosfortes[i].vida);
}
for(uint i=0;i<helicopteros.length();i++){
ff.write("\r\nhelicoptero "+helicopteros[i].x+" "+helicopteros[i].y+" "+helicopteros[i].map+" "+helicopteros[i].vida);
}
ff.close();
wait(1200);
if(SCRIPT_COMPILED==false)run("C:/Program Files (x86)/BGT/bgt.exe", "C:/Users/Administrador/Desktop/Nova versão/DM-servidor.bgt", false, false);
else run(SCRIPT_EXECUTABLE, "", false, false);
exit();
}
if(TIME_HOUR==16&&sequestrador2s.length()==0){
for(uint i=0;i<random(5, 12);i++){
colocar_sequestrador2(random(50, 200), 0, "estrada_do_acampamento");
}
colocar_sequestrador2(random(300, 399), 0, "estrada_do_acampamento", 3);
colocar_sequestrador2(random(300, 399), 0, "estrada_do_acampamento", 3);
}
if(TIME_HOUR==18){
bool t=false;
for(uint i=0;i<helicopteros.length();i++){
if(helicopteros[i].map=="cidade1"){
t=true;
break;
}
}
if(!t)spawn_helicoptero(280, 5, "cidade1");
t=false;
for(uint i=0;i<helicopteros.length();i++){
if(helicopteros[i].map=="cidade2"){
t=true;
break;
}
}
if(!t)spawn_helicoptero(340, 5, "cidade2");
}
if(TIME_HOUR==20){
bool t=false;
for(uint i=0;i<carrosfortes.length();i++){
if(carrosfortes[i].mapa=="cidade_de_méxico"){
t=true;
break;
}
}
if(!t)colocar_cforte(15, 0, "cidade_de_méxico", 100000);
}
if(trobo.elapsed>=10000){
trobo.restart();
if(robo_coletores.length()<6)colocar_robo_coletor(random(90, 200), 0, "mundo_futurista");
}
if(divulgar.elapsed>=600000){
divulgar.restart();
}
if(tpresentes.elapsed>=npresentes){
tpresentes.restart();
npresentes=random(600000, 900000);
string[] t;
t.insert_last(random(10, 20)+" dardo");
t.insert_last(random(500, 1000)+" refrigerante");
t.insert_last(random(10, 20)+" granada");
t.insert_last(random(500, 1000)+" 5.56mm");
t.insert_last(random(500, 1000)+" 7.62mm");
t.insert_last(random(500, 1000)+" 9mm");
t.insert_last(random(5, 10)+" sugador");
t.insert_last(random(5000, 10000)+" coins");
t.insert_last(random(1000, 1500)+" reais");
t.insert_last(random(15, 30)+" fita_explosiva");
t.insert_last(random(4, 8)+" max_bomba");
t.insert_last(random(2, 4)+" bomba_de_fogo");
t.insert_last(random(2, 4)+" bomba_atômica");
t.insert_last(random(5, 10)+" projétil");
t.insert_last(random(3, 6)+" item_magnético");
t.insert_last(random(1, 2)+" teleporter");
t.insert_last(random(20, 40)+" banana");
t.insert_last(random(20, 50)+" mana");
int nitem=random(0, t.length()-1);
string[] a=string_split(t[nitem], " ", false);
int numero=string_to_number(a[0]);
string nome=a[1];
send_reliable(0, "ps teleporter.ogg", 0);
for(uint n=0; n<players.length; n++){
if(!players[n].afk){
players[n].inv_add_item(nome, numero);
send_reliable(players[n].peer_id, "msgpegouitem "+numero+" "+nome, 0);
if(doublegold==1){
players[n].inv_add_item(nome,numero);
send_reliable(players[n].peer_id, "msgvocêganhamais "+numero, 0);
}
}
}
if(tzumbi.elapsed>=4000&&zumbis.length()==0){
tzumbi.restart();
for(uint i=0;i<4;i++){
colocar_zumbi(random(1, 100), 0, "casa_de_los_zombis");
}
}
}
netloop();//add
netloop();//add
netloop();//add
if(tdemorar.elapsed>=120000){
tdemorar.restart();
for(uint ie=0;ie<players.length();ie++){
for(uint i2=0;i2<computadors.length();i2++){
string t=string_replace(computadors[i2].map, "apartamento_de_", "", false);
if(t==players[ie].charname&&computadors[i2].codcasa==0){
send_reliable(players[ie].peer_id, "mtext Troca automática de código. Digite o novo código para seu apartamento.:mcodigo2", 0);
break;
}
}
if(players[ie].inv_item_number("relógio")<1&&players[ie].relogio==1)players[ie].relogio=0;
if(players[ie].inv_item_number("boné")<1&&players[ie].bonemizuno==1)players[ie].bonemizuno=0;
if(players[ie].oculosmizuno==1&&players[ie].inv_item_number("óculos_escuros")<1)players[ie].oculosmizuno=0;
if(players[ie].calcacamuflada==1&&players[ie].inv_item_number("calça_camuflada")<1)players[ie].calcacamuflada=0;
if(players[ie].sapatoscarpin==1&&players[ie].inv_item_number("sapato_scarpin")<1)players[ie].sapatoscarpin=0;
if(players[ie].sapatomagnetico==1&&players[ie].inv_item_number("sapato_magnético")<1){
players[ie].sapatomagnetico=0;
send_reliable(players[ie].peer_id, "rsapato", 0);
}
if(players[ie].calcalegging==1&&players[ie].inv_item_number("calça_legging")<1)players[ie].calcalegging=0;
if(players[ie].coturnomilitar==1&&players[ie].inv_item_number("coturno_militar")<1)players[ie].coturnomilitar=0;
if(players[ie].pulseiraouro==1&&players[ie].inv_item_number("pulseira_de_ouro")<1)players[ie].pulseiraouro=0;
if(players[ie].pulseiraprata==1&&players[ie].inv_item_number("pulseira_de_prata")<1)players[ie].pulseiraprata=0;
if(players[ie].pulseirabronze==1&&players[ie].inv_item_number("pulseira_de_bronze")<1)players[ie].pulseirabronze=0;
if(players[ie].pulseira==1&&players[ie].inv_item_number("pulseira")<1)players[ie].pulseira=0;
if(players[ie].inv_item_number("colete_salva_vida")<=0&&players[ie].coletesalvavida==1){
send_reliable(players[ie].peer_id, "retirarcolete", 0);
players[ie].coletesalvavida=0;
}
if(players[ie].anel==1&&players[ie].inv_item_number("anel")<1)players[ie].anel=0;
if(players[ie].bracadeira==1&&players[ie].inv_item_number("braçadeira")<1)players[ie].bracadeira=0;
if(players[ie].coletemizuno==1&&players[ie].inv_item_number("colete_de_borracha")<1)players[ie].coletemizuno=0;
if(players[ie].coletemilitar==1&&players[ie].inv_item_number("colete_militar")<1)players[ie].coletemilitar=0;
if(players[ie].luvas==1&&players[ie].inv_item_number("luvas")<1)players[ie].luvas=0;
if(players[ie].jaquetacouro==1&&players[ie].inv_item_number("jaqueta_de_couro")<1)players[ie].jaquetacouro=0;
if(players[ie].calcamizuno==1&&players[ie].inv_item_number("calça_social")<1)players[ie].calcamizuno=0;
if(players[ie].botamizuno==1&&players[ie].inv_item_number("sapato_social")<1)players[ie].botamizuno=0;
if(players[ie].tenisnike==1&&players[ie].inv_item_number("tênis_de_corrida")<1)players[ie].tenisnike=0;
if(players[ie].camisamalha==1&&players[ie].inv_item_number("camisa_de_malha")<1)players[ie].camisamalha=0;
if(players[ie].calcajeans==1&&players[ie].inv_item_number("calça_jeans")<1)players[ie].calcajeans=0;
if(players[ie].tenisadidas==1&&players[ie].inv_item_number("Sandália")<1)players[ie].tenisadidas=0;
if(players[ie].chapeupanama==1&&players[ie].inv_item_number("chapéu_panamá")<1)players[ie].chapeupanama=0;
}
}
if(tmina2.elapsed>=60000){
bool t=false;
for(uint i=0;i<walls.length();i++){
if(walls[i].map=="caverna"){
t=true;
break;
}
}
if(t==false)colocar_wall(80, "caverna");
tmina2.restart();
}
netloop();//add
netloop();//add
netloop();//add
if(tmina.elapsed>=1800000){
if(minasouro.length()==0){
tmina.restart();
for(uint i=0;i<20;i++){
colocar_minaouro(random(1, 100), 0, "mina_de_ouro");
}
}
}
if(trato.elapsed>=30000&&ratos.length()<2&&pvp){
trato.restart();
spawn_rato(random(1, 650), 0, "esgoto_de_mortalândia");
}
netloop();//add
netloop();//add
netloop();//add
if(tovo.elapsed>=60000&&item_exists("ovo_de_ouro")==false&&tjogador("galinheiro")==false){
spawn_obj(random(11, 50),0,"ovo_de_ouro",1,"galinheiro");
tovo.restart();
}
if(salvarconfigs.elapsed>=600000){
writeprefs();
salvarconfigs.restart();
}
if(tvaviao.elapsed>=40000){
tvaviao.restart();
if(pmapa>mapasaviao.length()-1){
pmapa=0;
mapaatual="aeroporto";
tvaviao.force(0);
tvaviao.pause();
tvaviao2.restart();
send_packet(0, "msgnormal Você chega ao aeroporto.", "avião2");
send_packet(0, "msgnormal Chamada dos passageiros, à plataforma 2. Chamada, dos passageiros, à plataforma: 2.", "aeroporto");
}
else{
string[] m=string_split(mapasaviao[pmapa], ":", false);
send_packet(0, "msg2 "+m[1], "avião2");
mapaatual=m[0];
pmapa++;
}
}
netloop();//add
netloop();//add
netloop();//add
if(tvaviao2.elapsed>=90000){
tvaviao2.force(0);
tvaviao2.pause();
send_packet(0, "msgnormal Atenção passageiros, preparar para a decolagem!", "avião2");
tvaviao.restart();
}
if(tpassaros.elapsed>=random(12000, 30000)){
tpassaros.restart();
string[] s;
s.reserve(5);
s.insert_last("birds13.ogg");
s.insert_last("birds2.ogg");
s.insert_last("birds3.ogg");
s.insert_last("birds7.ogg");
s.insert_last("birds8.ogg");
send_packet(0, "play "+s[random(0, s.length()-1)]+" "+random(-5, 5)+" 9", "apresentação");
}
netloop();//add
netloop();//add
netloop();//add
if(badalar.elapsed>=3521&&nbadalar!=0){
send_packet(0, "play cinoigreja.ogg 60 5", "milão2");
send_packet(0, "play cinoigreja.ogg 160 5", "los_angeles2");
send_packet(0, "play cinoigreja.ogg 50 5", "cidade_de_santa_bertalina");
nbadalar--;
badalar.restart();
}
if(tmar.elapsed>=120000&&pvp==true){
tmar.restart();
bool achou=false;
for(uint i=0;i<tubaraos.length();i++){
if(tubaraos[i].map=="mar")achou=true;
}
if(achou==false){
spawn_tubarao(random(1, 99), random(0, 49), "mar");
}
}
netloop();//add
netloop();//add
netloop();//add
if(tconcha.elapsed>=12000){
bool achou=false;
for(uint i=0;i<players.length();i++){
if(players[i].map=="mar")achou=true;
}
if(achou==true){
tconcha.restart();
spawn_obj(random(1, 99), 0, "concha_marinha", 1, "mar");
}
else tconcha.restart();
}
if(tcoelho.elapsed>=20000&&coelhos.length()<10){
for(uint i=0;i<2;i++){
colocar_coelho(random(1, 1000), 0, "floresta_dos_coelhos");
}
}
if(tcachorro.elapsed>=60000&&pvp==true){
bool achou=false;
for(uint i=0;i<cachorros.length();i++){
if(cachorros[i].map=="cidade2")achou=true;
}
if(achou==false)spawn_cachorro(random(1, 230), 0, "cidade2");
achou=false;
for(uint i=0;i<sequestradors.length();i++){
if(sequestradors[i].map=="acampamento")achou=true;
}
if(achou==false)spawn_sequestrador(random(1, 400), 0, "acampamento");
achou=false;
for(uint i=0;i<cachorros.length();i++){
if(cachorros[i].map=="praça_da_cidade")achou=true;
}
if(achou==false)spawn_cachorro(random(1, 99), 0, "praça_da_cidade");
achou=false;
for(uint i=0;i<cachorros.length();i++){
if(cachorros[i].map=="cidade_de_méxico")achou=true;
}
if(achou==false)spawn_cachorro(random(1, 280), 0, "cidade_de_méxico");
achou=false;
for(uint i=0;i<cachorros.length();i++){
if(cachorros[i].map=="cidade_de_méxico2")achou=true;
}
if(achou==false)spawn_cachorro(random(1, 450), 0, "cidade_de_méxico2");
achou=false;
for(uint i=0;i<cachorros.length();i++){
if(cachorros[i].map=="cidade_de_guadalajara")achou=true;
}
if(achou==false)spawn_cachorro(random(1, 99), 0, "cidade_de_guadalajara");
achou=false;
for(uint i=0;i<guardasandar.length();i++){
if(guardasandar[i].mapa=="castelo_medieval"){
achou=true;
break;
}
}
if(achou==false){
colocar_guardaandar(50, 0, "castelo_medieval", "guarda_do_castelo");
}
achou=false;
for(uint i=0;i<macacos.length();i++){
if(macacos[i].map=="floresta_tropical")achou=true;
}
if(achou==false)spawn_macaco(random(1, 99), 10, "floresta_tropical");
if(achou==false)spawn_macaco(random(42, 50), 10, "apartamento_de_MaUro");
if(achou==false)spawn_macaco(random(42, 50), 10, "apartamento_de_ternurita");
achou=false;
for(uint i=0;i<lobos.length();i++){
if(lobos[i].map=="acampamento")achou=true;
}
if(achou==false)spawn_lobo(random(1, 199), 0, "acampamento");
if(achou==false)spawn_lobo(random(380, 399), 0, "apartamento_de_MaUro");
achou=false;
for(uint i=0;i<lobos.length();i++){
if(lobos[i].map=="estrada_do_acampamento")achou=true;
}
if(achou==false)spawn_lobo(random(1, 399), 0, "estrada_do_acampamento");
achou=false;
for(uint i=0;i<lobos.length();i++){
if(lobos[i].map=="floresta")achou=true;
}
if(achou==false)spawn_lobo(random(1, 199), 0, "floresta");
tcachorro.restart();
}
if(turso.elapsed>=90000&&pvp==true){
uint total=0;
for(uint i=0;i<ursos.length();i++){
if(ursos[i].map=="pré_história") total++;
}
if(total==0){
spawn_urso(random(1, 85), 0, "pré_história");
turso.restart();
}
}
if(tdragonsauro.elapsed>=480000&&pvp==true){
if(hcavernas.length()==0){
string[] h={"quinta","sexta","sétima","oitava","nona","décima"};
colocar_hcaverna(96, 0, h[random(0, h.length()-1)]+"_caverna", random(1, 3));
}
if(dragonsauros.length()==0)spawn_dragonsauro(random(1, 199), 0, "brejo");
bool t=false;
for(uint i=0;i<megadragonsauros.length();i++){
if(megadragonsauros[i].map=="casa_do_bruxo")t=true;
}
if(t==false)spawn_megadragonsauro(random(1, 99), 0, "casa_do_bruxo");
tdragonsauro.restart();
}
if(temposequestrador.elapsed>=600000&&pvp==true){
bool achou=false;
for(uint i=0;i<players.length();i++){
if(players[i].map=="galpáo_abandonado") achou=true;
}
if(achou==false){
temposequestrador.restart();
sequestradors.resize(0);
spawn_sequestrador(150, 0, "galpáo_abandonado");
}
}
if(jogarfrutas.elapsed>=random(40000, 40500)){
bool achou=false;
for(uint i=0;i<players.length();i++){
if(players[i].map=="floresta_tropical")achou=true;
}
if(achou==true){
string[] stringfrutas;
stringfrutas.reserve(12);
stringfrutas.insert_last("caqui");stringfrutas.insert_last("caju"); stringfrutas.insert_last("jabuticaba"); stringfrutas.insert_last("amora"); stringfrutas.insert_last("pera"); stringfrutas.insert_last("goiaba");
stringfrutas.insert_last("maçã"); stringfrutas.insert_last("banana"); stringfrutas.insert_last("figo"); stringfrutas.insert_last("pêssego"); stringfrutas.insert_last("morango");
spawn_coco(45, 0, "floresta_tropical");
uint a=random(1, stringfrutas.length()-1);
for(uint i=1;i<a;i++){
spawn_obj(random(1, 100), 0, stringfrutas[random(0, stringfrutas.length()-1)], 1, "floresta_tropical");
}
}
achou=false;
for(uint i=0;i<players.length();i++){
if(players[i].map=="vilarejo")achou=true;
}
if(achou==true){
spawn_obj(10, 0, "azeitona", 1, "vilarejo");
spawn_obj(20, 0, "azeitona", 1, "vilarejo");
spawn_obj(30, 0, "azeitona", 1, "vilarejo");
spawn_obj(40, 0, "azeitona", 1, "vilarejo");
spawn_obj(50, 0, "azeitona", 1, "vilarejo");
spawn_obj(60, 0, "azeitona", 1, "vilarejo");
spawn_obj(70, 0, "azeitona", 1, "vilarejo");
spawn_obj(80, 0, "azeitona", 1, "vilarejo");
spawn_obj(90, 0, "azeitona", 1, "vilarejo");
}
jogarfrutas.restart();
}
if(soltarbombas.elapsed>=600000){
soltarbombas.restart();
string[] ips;
ips.reserve(11);
ips.insert_last("11");
ips.insert_last("17");
ips.insert_last("23");
ips.insert_last("30");
ips.insert_last("40");
ips.insert_last("50");
ips.insert_last("60");
ips.insert_last("70");
ips.insert_last("80");
ips.insert_last("90");
ips.insert_last("100");
int a=random(0, ips.length()-1);
spawn_obj(random(12, 99),string_to_number(ips[a]),"max_bomba",1,"mortal_construções");
spawn_obj(random(12, 99),string_to_number(ips[a]),"bomba_relógio",1,"mortal_construções");
}
if(taldeia.elapsed>=35000){
taldeia.restart();
bool achou=false;
for(uint i=0;i<players.length();i++){
if(players[i].map=="aldeia_indígena"){
achou=true;
break;
}
}
if(achou==true){
spawn_obj(random(1, 199), 0, "pacote_de_flechas", 1, "aldeia_indígena");
spawn_obj(random(1, 199), 0, "pacote_de_dardos", 1, "aldeia_indígena");
}
}
if(guardarmapa.elapsed>=1000){
for(uint i=0; i < players.length(); i++){
if(players[i].afk==true) players[i].title="Ausente ";

else if(players[i].is_admin())players[i].title="ADM ";
else if(players[i].moderador)players[i].title="MOD ";
else if(players[i].pacifico==1&&players[i].afk==false) players[i].title="Pacifista ";
else if(players[i].pacifico==0&&players[i].afk==false&&players[i].newbie==true) players[i].title="Novat"+players[i].sexo2+" ";
else if(players[i].inv_item_exists("troféu_de_atirador_de_elite")) players[i].title="Atirador de elite ";

else if(players[i].level<=200&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)players[i].title="Soldad"+players[i].sexo2+"
";
else if(players[i].level>200 and players[i].level<=1000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
players[i].title="Mercenári"+players[i].sexo2+" ";
else if(players[i].level>1000 and players[i].level<=2000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
players[i].title="Presidente ";
else if(players[i].level>2000 and players[i].level<=3000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
if(players[i].sexo==0)
{
players[i].title="Ditadora ";
}
else
{
players[i].title="Ditador ";
}
else if(players[i].level>3000 and players[i].level<=4000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
players[i].title="Assassin"+players[i].sexo2+" ";
else if(players[i].level>4000 and players[i].level<=5000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
if(players[i].sexo==0)
{
players[i].title="Desenvolvedora de guerra ";
}
else{
players[i].title="Desenvolvedor de guerra ";
}
else if(players[i].level>5000 and players[i].level<=6000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
if(players[i].sexo==0)
{
players[i].title="Chefa da guerra ";
}
else{
players[i].title="Chefe da guerra ";
}
else if(players[i].level>6000 and players[i].level<=7000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
players[i].title="Comandante ";
else if(players[i].level>7000 and players[i].level<=10000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
players[i].title="Presidiári"+players[i].sexo2+" da desgraça ";
else if(players[i].level>10000 and players[i].level<=12000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
players[i].title="Louc"+players[i].sexo2+" não confiável ";
else if(players[i].level>12000 and players[i].level<=16000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
players[i].title="Zumbi ";
else if(players[i].level>16000 and players[i].level<=20000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
players[i].title="Monstro ";
else if(players[i].level>20000 and players[i].level<=25000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
players[i].title="Dinossauro ";
else if(players[i].level>25000 and players[i].level<=30000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
players[i].title="Dinossauro geneticamente modificado ";
else if(players[i].level>30000 and players[i].level<=40000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
players[i].title="Dragão ";
else if(players[i].level>40000 and players[i].level<=50000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
players[i].title="Dragão mutante ";
else if(players[i].level>50000 and players[i].level<=70000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
players[i].title="Robô destruidor ";
else if(players[i].level>70000&&players[i].charname!="Cornelius"&&players[i].newbie==false&&players[i].pacifico==0&&players[i].afk==false&&players[i].inv_item_exists("troféu_de_atirador_de_elite")==false)
players[i].title="Robô mega assassino ";
if(players[i].map=="aeroporto_internacional_de_los_angeles"){
players[i].destino="aeroporto";
}
else if(players[i].map=="aeroporto"){
players[i].destino="aeroporto_internacional_de_los_angeles";
}
if(players[i].map=="estação_de_los_angeles"){
players[i].destino2="estação_de_santa_bertalina";
}
else if(players[i].map=="estação_de_santa_bertalina"){
players[i].destino2="estação_de_los_angeles";
}
if(players[i].map=="porto"){
players[i].destino3="porto_de_milão";
}
else if(players[i].map=="porto_de_milão"){
players[i].destino3="porto";
}
}
guardarmapa.restart();
}
if(tempoentroutrem.elapsed>=50000&&preparartrem==0&&players.length()>0){
preparartrem=1;
}
if(chuvatimer.elapsed>chuvatempo&&chovendo==0)
{
chuvatimer.restart();
send_reliable(0, "volumechuva -7", 0);
volumechuva=-12;
numerochuva=random(3, 4);
send_reliable(0,"chuvaativa "+numerochuva,0);
chovendo=1;
trov1=0;
trov2=0;
trov3=0;
trov4=0;
trov5=0;
trov6=0;
trov7=0;
trov8=0;
trov9=0;
trov10=0;
volumechuva1=0;
volumechuva2=0;
volumechuva3=0;
volumechuva4=0;
volumechuva5=0;
volumechuva6=0;
volumechuva7=0;
volumechuva8=0;
volumechuva9=0;
volumechuva10=0;
}
if(chuvatimer.elapsed>500000&&chovendo==1)
{
chuvatimer.restart();
send_reliable(0,"fimchuva",0);
send_reliable(0, "volumechuva -12", 0);
chovendo=0;
}
if(chuvatimer.elapsed>=498000&&chovendo==0&&trov1==0)
{
jraio();
trov1=1;
}
if(chuvatimer.elapsed>=1500&&chovendo==1&&trov2==0)
{
jraio();
send_reliable(0, "volumechuva -12", 0);
volumechuva =-12;
trov2=1;
}
if(chuvatimer.elapsed>=20000&&chovendo==1&&trov9==0)
{
jraio();
volumechuva =-10;
send_reliable(0, "volumechuva -10", 0);
trov9=1;
}
if(chuvatimer.elapsed>=43000&&chovendo==1&&trov10==0)
{
jraio();
volumechuva =-8;
send_reliable(0, "volumechuva -8", 0);
trov10=1;
}
if(chuvatimer.elapsed>=45000&&chovendo==1&&volumechuva1==0)
{
jraio();
volumechuva =-6;
volumechuva1=1;
}
if(chuvatimer.elapsed>=47000&&chovendo==1&&volumechuva2==0)
{
send_reliable(0, "volumechuva -4", 0);
volumechuva =-4;
volumechuva2=1;
int jogaronda=random(1, 200);
if(jogaronda<10){
spawn_dog(251, 0, "floresta");
spawn_dog(251, 0, "milão2");
spawn_dog(251, 0, "acampamento");
spawn_dog(251, 0, "milão");
send_reliable(0, "pst trovão"+random(12,18)+".ogg",0);
send_reliable(0, "pst trovão"+random(12,18)+".ogg",0);
send_reliable(0, "pst trovão"+random(1,10)+".ogg",0);
}
}
if(chuvatimer.elapsed>=48000&&chovendo==1&&volumechuva3==0)
{
send_reliable(0, "volumechuva -2", 0);
volumechuva =-2;
volumechuva3=1;
}
if(chuvatimer.elapsed>=50000&&chovendo==1&&volumechuva4==0)
{
send_reliable(0, "volumechuva 1000", 0);
volumechuva =1000;
volumechuva4=1;
}
if(chuvatimer.elapsed>=60000&&chovendo==1&&trov3==0)
{
jraio();
trov3=1;
}
if(chuvatimer.elapsed>=150000&&chovendo==1&&trov4==0)
{
jraio();
trov4=1;
}
if(chuvatimer.elapsed>=180000&&chovendo==1&&trov5==0)
{
jraio();
trov5=1;
}
if(chuvatimer.elapsed>=240000&&chovendo==1&&trov6==0)
{
jraio();
trov6=1;
}
if(chuvatimer.elapsed>=300000&&chovendo==1&&trov7==0)
{
jraio();
trov7=1;
}
if(chuvatimer.elapsed>=451000&&chovendo==1&&volumechuva9==0)
{
volumechuva =-2;
send_reliable(0, "volumechuva -2", 0);
volumechuva9=1;
}
if(chuvatimer.elapsed>=452000&&chovendo==1&&volumechuva8==0)
{
send_reliable(0, "volumechuva -4", 0);
volumechuva =-4;
volumechuva8=1;
}
if(chuvatimer.elapsed>=454000&&chovendo==1&&volumechuva7==0)
{
volumechuva =-6;
send_reliable(0, "volumechuva -6", 0);
volumechuva7=1;
}
if(chuvatimer.elapsed>=457000&&chovendo==1&&volumechuva6==0)
{
volumechuva =-8;
send_reliable(0, "volumechuva -8", 0);
volumechuva6=1;
}
if(chuvatimer.elapsed>=480000&&chovendo==1&&volumechuva5==0)
{
volumechuva =-10;
send_reliable(0, "volumechuva -10", 0);
volumechuva5=1;
}
if(chuvatimer.elapsed>=499000&&chovendo==1&&trov8==0)
{
jraio();
volumechuva =-12;
send_reliable(0, "volumechuva -12", 0);
trov8=1;
}
if(tempoentrouaviao.elapsed>=70000){
tempoentrouaviao.restart();
preparardecolagem=0;
for(uint i=0; i < players.length(); i++){
if(players[i].map=="avião"&&players[i].javoou==0){
send_reliable(players[i].peer_id, "stopmoving", 0);
players[i].noaviao=1;
changemap("avião_alto", i, 5, 0);
players[i].tempovoandoaviao.restart();
write_to(players[i].charname, "noaviao.usr", players[i].noaviao);
}
}
}
if(tempoentroutrem.elapsed>=60000){
tempoentroutrem.restart();
preparartrem=0;
for(uint i=0; i < players.length(); i++){
if(players[i].map=="trem"&&players[i].jaandou==0){
send_reliable(players[i].peer_id, "stopmoving", 0);
players[i].notrem=1;
write_to(players[i].charname, "notrem.usr", players[i].notrem);
changemap("trem_andando", i, 5, 0);
players[i].tempodentrotrem.restart();
}
}
}
if(tempodoublexp.elapsed>=300000&&doublexp==1){
tempodoublexp.restart();
numerodoublexp=numerodoublexp+1;
}
if(numerodoublexp==10&&avisadoublexp1==0){
avisadoublexp1=1;
send_reliable(0, "ps notify_blip2.ogg", 0);
send_reliable(0, "msgnormal DoubleXP: 20 horas para o fim.", 0);
}
if(numerodoublexp==20&&avisadoublexp2==0){
avisadoublexp2=1;
send_reliable(0, "ps notify_blip2.ogg", 0);
send_reliable(0, "msgnormal DoubleXP: 10 horas para o fim.", 0);
}
if(numerodoublexp==25&&avisadoublexp3==0){
avisadoublexp3=1;
send_reliable(0, "ps notify_blip2.ogg", 0);
send_reliable(0, "msgnormal DoubleXP: 5 horas para o fim.", 0);
}
if(numerodoublexp==30&&avisadoublexp4==0){
avisadoublexp4=1;
send_reliable(0, "ps notify_blip2.ogg", 0);
send_reliable(0, "msgnormal DoubleXP: Fim... Em breve tem mais!", 0);
doublexp=0;
}
if(casabruxo1.elapsed>=60000&& item_exists("mana")==false){
casabruxo1.restart();
int b=random(2, 15);
spawn_obj(b,0,"mana",1,"quarto_do_bruxo");
}
if(casabruxo2.elapsed>=60000&&item_exists("item_magnético")==false)
{
casabruxo2.restart();
int b=random(1, 70);
spawn_obj(b,50,"item_magnético",1,"casa_do_bruxo");
}
if(tempoleilao.elapsed>numeroleilao&&semleilao==1){
semleilao=0;
}
if (auctiontimer.elapsed>=auctiontime and auction==true)
{
if (auctionbidder==false)
{
send_reliable(0,"msgleilãoterminado "+auctionwho,0);
auction=false;
auctionitem="";
auctionbidder=false;
auctionamount=0;
auctionbid=0;
auctionwho="";
auctionwho2="";
}
else
{
int index1=get_player_index_from(auctionwho);
int index2=get_player_index_from(auctionwho2);
if (index1==-1 or index2==-1)
{
send_reliable(0,"msgumoumaisjogadoresdessavenda", 0);
semleilao=1;
tempoleilao.restart();
auction=false;
auctionitem="";
auctionbidder=false;
auctionamount=0;
auctionbid=0;
auctionwho="";
auctionwho2="";
}
else
{
if (players[index1].inv_item_number(auctionitem)<auctionamount)
{
auction=false;
auctionitem="";
auctionbidder=false;
auctionamount=0;
auctionbid=0;
auctionwho="";
auctionwho2="";
send_reliable(0,"msgleilãonãoépermitido", 0);
}
else if(players[index2].inv_item_number("coins")<auctionbid){
auction=false;
auctionitem="";
auctionbidder=false;
auctionamount=0;
auctionbid=0;
auctionwho="";
auctionwho2="";
send_reliable(0, "msgcoinsfaltandoparaoleilão", 0);
}
else
{
players[index2].inv_add_item("coins",0-auctionbid);
players[index2].inv_add_item(auctionitem,auctionamount);
send_packet(0,"play gift.ogg "+players[index2].x+" "+players[index2].y+" "+players[index2].map,players[index2].map);
players[index1].inv_add_item(auctionitem,0-auctionamount);
players[index1].inv_add_item("coins",auctionbid);
auction=false;
auctionitem="";
auctionbidder=false;
auctionamount=0;
auctionbid=0;
auctionwho="";
auctionwho2="";
send_reliable(0,"ps auctionwon.ogg",0);
send_reliable(0,"msgleilaoconcluido "+players[index2].charname,0);
semleilao=1;
tempoleilao.restart();
}
}
}
}
if(soltaritenstimer.elapsed>=soltaritenstime)
{
soltaritenstimer.restart();
if(item_exists("jornal")==false){
spawn_obj(random(70, 75),0,"jornal",1,"los_angeles");
}
if(item_exists("um_passaporte")==false){
spawn_obj(random(1, 78),0,"um_passaporte",1,"aeroporto");
spawn_obj(random(1, 78),0,"um_passaporte",1,"aeroporto_internacional_de_los_angeles");
}
int r=random(1,49);
spawn_obj(r,0,"relógio",1,"lanchonete");
r=random(1,119);
spawn_obj(r,0,"relógio",1,"BarRS");
int b=random(1,49);
string[]rand;
rand.insert_last("luvas");
rand.insert_last("coturno_militar");
rand.insert_last("calça_jeans");
int bum=random(0,rand.length()-1);
if (item_exists(rand[bum])==false)
{
spawn_obj(b,0,rand[bum],1,"loja_de_roupas");
}
rand.resize(0);
}
if (uptimer.elapsed>=1000){
uptimer.restart();
ups+=1;
upzs+=1;
if (ups>=60)
{
ups=0;
upzs=0;
upm+=1;
upzm+=1;
}
if (upm>=60)
{
ups=0;
upzs=0;
upm=0;
upzm=0;
uph+=1;
upzh+=1;
}
if (uph>=24)
{
ups=0;
upzs=0;
upm=0;
upzm=0;
uph=0;
upzh=0;
upd+=1;
upzd+=1;
}
if (upd>=7)
{
ups=0;
upzs=0;
upm=0;
upzm=0;
uph=0;
upzh=0;
upd=0;
upzd=0;
upw+=1;
upzw+=1;
}
}
if(belicktimer.elapsed>=belicktime&&gamestopped==false&&objs.length()<maxobjs){
belicktimer.restart();
bool achou=false;
for(uint i=0;i<players.length();i++){
if(players[i].map=="los_angeles") achou=true;
}
if(achou==true){
int w=random(0,objsbelick.length()-1);
if(objsbelick[w]=="reais"){
string[] z;
z.reserve(4);
z.insert_last("2");
z.insert_last("5");
z.insert_last("10");
spawn_obj(-1,0,"reais",string_to_number(z[random(0, z.length()-1)]), "los_angeles");
}
else spawn_obj(-1,0,objsbelick[w],1, "los_angeles");
}
achou=false;
for(uint i=0;i<players.length();i++){
if(players[i].map=="los_angeles2") achou=true;
}
if(achou==true){
int w=random(0,objsbelick.length()-1);
if(objsbelick[w]=="reais"){
string[] z;
z.reserve(4);
z.insert_last("2");
z.insert_last("5");
z.insert_last("10");
spawn_obj(-1,0,"reais",string_to_number(z[random(0, z.length()-1)]), "los_angeles2");
}
else spawn_obj(-1,0,objsbelick[w],1, "los_angeles2");
}
}
if(objtimer.elapsed>=objtime&&gamestopped==false&&objs.length()<maxobjs){
int w=random(0,what.length()-1);
int ww=random(0, maps.length()-1);
bool achou=false;
for(uint i=0;i<players.length();i++){
if(players[i].map==maps[ww]){
achou=true;
}
}
if(achou==true){
spawn_obj(-1, 0, what[w], 1, maps[ww]);
}
objtimer.restart();
}
if(horatemporizador.elapsed > horatempo)
{
horatemporizador.restart();
minuto++;
if(minuto>59)
{
minuto=0;
hora++;
checarhora();
if(hora==6||hora==18)checarambiente(0);
}
if(hora>23)
{
hora=0;
minuto=0;
dia+=1;
}
if(dia>31)
{
dia=1;
mes+=1;
}
if(mes>12)
{
mes=1;
ano+=1;
}
}
}
void checarambiente(int id){
for(uint i=0;i<ambientesmapa.length();i++){
string[] z=string_split(ambientesmapa[i], ":", false);
if(id!=0){
if(players[id].map==z[0]){
if(hora<6||hora>=18) send_reliable(players[id].peer_id, "addambiente 1 200 0 200 "+z[1], 0);
else if(hora>=6||hora<18) send_reliable(players[id].peer_id, "addambiente 1 200 0 200 "+z[2], 0);
}
}
else{
for(uint i2=0;i2<players.length();i2++){
if(players[i2].map==z[0]){
if(hora<6||hora>=18) send_reliable(players[i2].peer_id, "addambiente 1 200 0 200 "+z[1], 0);
else if(hora>=6||hora<18) send_reliable(players[i2].peer_id, "addambiente 1 200 0 200 "+z[2], 0);
}
}
}
}
netloop();
}
void checarambiente2(int id){
for(uint i=0;i<ambientesmapa.length();i++){
string[] z=string_split(ambientesmapa[i], ":", false);
if(players[id].map==z[0]){
if(hora<6||hora>=18) send_reliable(players[id].peer_id, "addambiente 1 200 0 200 "+z[1], 0);
else if(hora>=6||hora<18) send_reliable(players[id].peer_id, "addambiente 1 200 0 200 "+z[2], 0);
}
}
}
void sconfigs(int index){
dictionary sd;
string nequipe;
for(uint i=0;i<players[index].nomesequipe.length();i++){
nequipe+=players[index].nomesequipe[i]+"\r\n";
}
sd.set("nomesequipe", nequipe);
sd.set("reply", players[index].replyname);
sd.set("equipemortal",players[index].equipemortal);
sd.set("equipedesafio",players[index].equipedesafio);
sd.set("muted",players[index].muted);
sd.set("draw", players[index].draw);
sd.set("tarma", players[index].tarma);
sd.set("x",players[index].x);
sd.set("y",players[index].y);
sd.set("map",players[index].map);
sd.set("sexo",players[index].sexo);
sd.set("xp",players[index].xp);
sd.set("galil",players[index].galil);
sd.set("mp7",players[index].mp7);
sd.set("bazuca",players[index].bazuca);
sd.set("level",players[index].level);
sd.set("nsede",players[index].nsede);
sd.set("nfome",players[index].nfome);
sd.set("ncoco",players[index].ncoco);
sd.set("nurina",players[index].nurina);
sd.set("sujo", players[index].sujo);
sd.set("ngripe",players[index].ngripe);
sd.set("extintor",players[index].extintor);
sd.set("passaporte",players[index].passaporte);
sd.set("nchuva", players[index].nchuva);
sd.set("ncaverna", players[index].ncaverna);
sd.set("caverna", players[index].caverna);
sd.set("achuva", players[index].achuva);
sd.set("dalison2", players[index].dalison2);
sd.set("questmontanha",players[index].questmontanha);
sd.set("terminouquestmontanha",players[index].terminouquestmontanha);
sd.set("questritual",players[index].questritual);
sd.set("calcamizuno",players[index].calcamizuno);
sd.set("terminouquestritual",players[index].terminouquestritual);
sd.set("questdesaparecida",players[index].questdesaparecida);
sd.set("terminouquestdesaparecida",players[index].terminouquestdesaparecida);
sd.set("dbus",players[index].dbus);
sd.set("gcoins",players[index].gcoins);
sd.set("matou",players[index].matou);
sd.set("jaandou",players[index].jaandou);
sd.set("javoou",players[index].javoou);
sd.set("noaviao",players[index].noaviao);
sd.set("notrem",players[index].notrem);
sd.set("pacifico",players[index].pacifico);
sd.set("relogio",players[index].relogio);
sd.set("lregras",players[index].lregras);
sd.set("msgliberdade",players[index].msgliberdade);
sd.set("chegoucidade",players[index].chegoucidade);
sd.set("anotado",players[index].anotado);
sd.set("tirostaser",players[index].tirostaser);
sd.set("bonemizuno",players[index].bonemizuno);
sd.set("oculosmizuno",players[index].oculosmizuno);
sd.set("calcacamuflada",players[index].calcacamuflada);
sd.set("sapatoscarpin",players[index].sapatoscarpin);
sd.set("sapatomagnetico",players[index].sapatomagnetico);
sd.set("calcalegging",players[index].calcalegging);
sd.set("coturnomilitar",players[index].coturnomilitar);
sd.set("pulseiraouro",players[index].pulseiraouro);
sd.set("ncolete",players[index].ncolete);
sd.set("colete_aprova_de_balas",players[index].colete_aprova_de_balas);
sd.set("coletemilitar",players[index].coletemilitar);
sd.set("capacetepolicia",players[index].capacetepolicia);
sd.set("coletecamuflado",players[index].coletecamuflado);
sd.set("coletesalvavida",players[index].coletesalvavida);
sd.set("anel",players[index].anel);
sd.set("coletemizuno",players[index].coletemizuno);
sd.set("tenisadidas",players[index].tenisadidas);
sd.set("tenisnike",players[index].tenisnike);
sd.set("chapeupanama",players[index].chapeupanama);
sd.set("pulseira",players[index].pulseira);
sd.set("pulseirabronze",players[index].pulseirabronze);
sd.set("pulseiraprata",players[index].pulseiraprata);
sd.set("luvas",players[index].luvas);
sd.set("jaquetacouro",players[index].jaquetacouro);
sd.set("camisamalha",players[index].camisamalha);
sd.set("calcajeans",players[index].calcajeans);
sd.set("negativo",players[index].negativo);
sd.set("fichaprisao",players[index].fichaprisao);
sd.set("kills",players[index].kills);
sd.set("deaths",players[index].deaths);
sd.set("maxhealth",players[index].maxhealth);
sd.set("subirvida",players[index].subirvida);
sd.set("health",players[index].health);
sd.set("invs",players[index].invs);
sd.set("chats",players[index].chats);
sd.set("mapavoltar",players[index].mapavoltar);
sd.set("cidadenatal",players[index].cidadenatal);
sd.set("destino",players[index].destino);
sd.set("destino2",players[index].destino2);
sd.set("destino3",players[index].destino3);
sd.set("paralisado",players[index].paralisado);
sd.set("nparalisado",players[index].nparalisado);
file arq;
arq.open("players/"+players[index].charname+"/configs.ini", "wb");
arq.write(serialize(sd));
arq.close();
write_to(players[index].charname, "contabancaria.usr", players[index].contabancaria);
if(players[index].inv!="")write_to(players[index].charname, "inv.md", players[index].inv);
write_to(players[index].charname, "saldo.md", players[index].saldo);
}
void usar(int index, string nitem){
if(players[index].pacifico==0&&get_safezone_at(players[index].x, players[index].y, players[index].map)==false&&players[index].newbie==false){
if(get_tile_at(players[index].x, players[index].y, players[index].map)==""&&nitem!="teleporter"&&nitem!="r2")return;
if(nitem=="fita_explosiva"&&players[index].inv_item_number("fita_explosiva")>0){
if(fitaativa==true){
for(uint i=0;i<players.length();i++){
if(get_player_distance(players[index], players[i])>-1&&get_player_distance(players[index], players[i])<2&&!emequipe(players[index].charname, players[i].charname)){
players[index].inv_add_item("fita_explosiva", -1);
colocar_fita(players[i].charname, players[index].charname);
send_packet10(0, players[index].charname, players[i].charname, "fexplo.ogg "+players[i].x+" "+players[i].y, players[i].map);
break;
}
}
}
else send_reliable(players[index].peer_id, "msgnormal Fitas_explosivas não estão sendo permitidas no momento.", 0);
}
else if(nitem=="ovo_de_dragonsauro"&&get_tile_at(players[index].x, players[index].y, players[index].map)!=""&&players[index].inv_item_number("ovo_de_dragonsauro")>0){
players[index].inv_add_item("ovo_de_dragonsauro", -1);
int d=random(1, 100);
if(d<=15){
spawn_bebesauro(players[index].x, players[index].y, players[index].map);
}
}
else if(nitem=="míssil_teleguiado"&&players[index].inv_item_number("míssil_teleguiado")>0)send_reliable(players[index].peer_id, "sjog 0 Escolha um jogador:;missil", 0);
else if(nitem=="bomba_de_fogo"&&players[index].inv_item_number("bomba_de_fogo")>0){
if(bombaativa==true){
players[index].inv_add_item("bomba_de_fogo", -1);
spawn_bombadefogo(players[index].x, players[index].y, players[index].map, players[index].charname);
}
else send_reliable(players[index].peer_id, "msgnormal Bombas não estão sendo permitidas no momento.", 0);
}
else if(nitem=="bomba_relógio"&&players[index].inv_item_number("bomba_relógio")>0){
if(bombaativa==true){
spawn_bombarelogio(players[index].x, players[index].y, players[index].map, players[index].charname);
players[index].inv_add_item("bomba_relógio", -1);
}
else send_reliable(players[index].peer_id, "msgnormal Bombas não estão sendo permitidas no momento.", 0);
}
else if(nitem=="max_bomba"&&players[index].inv_item_number("max_bomba")>0){
if(bombaativa==true){
spawn_maxbomba(players[index].x, players[index].y, players[index].map, players[index].charname);
players[index].inv_add_item("max_bomba", -1);
}
else send_reliable(players[index].peer_id, "msgnormal Bombas não estão sendo permitidas no momento.", 0);
}
else if(nitem=="bomba_remota"&&players[index].inv_item_number("bomba_remota")>0){
if(bombaativa==true){
spawn_bombaremota(players[index].x, players[index].y, players[index].map, players[index].charname);
players[index].inv_add_item("bomba_remota", -1);
}
else send_reliable(players[index].peer_id, "msgnormal Bombas não estão sendo permitidas no momento.", 0);
}
else if(nitem=="bomba_atômica"&&players[index].inv_item_number("bomba_atômica")>0){
if(bombaativa==true){
bool t=false;
for(uint i=0;i<bombaatomicas.length();i++){
if(bombaatomicas[i].nome==players[index].charname){
t=true;
break;
}
}
if(t)return;
spawn_bombaatomica(players[index].x, players[index].y, players[index].map, players[index].charname);
players[index].inv_add_item("bomba_atômica", -1);
}
else send_reliable(players[index].peer_id, "msgnormal Bombas não estão sendo permitidas no momento.", 0);
}
else if(nitem=="bomba_nuclear"&&players[index].inv_item_number("bomba_nuclear")>0){
if(bombaativa==true){
bool t=false;
for(uint i=0;i<bombanucleares.length();i++){
if(bombanucleares[i].nome==players[index].charname){
t=true;
break;
}
}
if(t)return;
spawn_bombanuclear(players[index].x, players[index].y, players[index].map, players[index].charname);
players[index].inv_add_item("bomba_nuclear", -1);
}
else send_reliable(players[index].peer_id, "msgnormal Bombas não estão sendo permitidas no momento.", 0);
}
else if(nitem=="projétil"&&players[index].inv_item_number("projétil")>0){
spawn_projetei(players[index].x, players[index].y, players[index].map, players[index].charname);
players[index].inv_add_item("projétil", -1);
}
else if(nitem=="dardo"&&players[index].inv_item_number("dardo")>0){
if(dardoativo==true){
players[index].inv_add_item("dardo", -1);
spawn_dardo(players[index].x, players[index].y, players[index].map, players[index].charname);
}
else send_reliable(players[index].peer_id, "msgnormal Dardos não estão sendo permitidos no momento.", 0);
}
else if(nitem=="dardo_envenenado"&&players[index].inv_item_number("dardo_envenenado")>0){
if(dardoativo==true){
players[index].inv_add_item("dardo_envenenado", -1);
spawn_dardoenvenenado(players[index].x, players[index].y, players[index].map, players[index].charname);
}
else send_reliable(players[index].peer_id, "msgnormal Dardos não estão sendo permitidos no momento.", 0);
}
else if(nitem=="mina"&&players[index].inv_item_number("mina")>0&&players[index].minatimer.elapsed>players[index].minaplacetime){
players[index].inv_add_item("mina",-1);
spawnmina(players[index].x,players[index].y, (players[index].xp/40),players[index].charname,players[index].map);
players[index].minatimer.restart();
}
}
if(nitem=="vara_de_pesca"){
if(players[index].map=="pesqueiro"&&string_contains(get_tile_at(players[index].x, players[index].y, players[index].map), "shallow", 1)>-1){
if(players[index].jpescar==false&&players[index].inv_item_number("vara_de_pesca")>0){
send_packet10(0, players[index].charname, players[index].charname, "vara_de_pescardraw.ogg "+players[index].x+" "+players[index].y, players[index].map);
players[index].jpescar=true;
}
}
}
else if(nitem=="paraquedas"&&players[index].map=="avião2"&&mapaatual!="aeroporto"){
players[index].mapaatual=mapaatual;
send_reliable(players[index].peer_id, "stopmoving", 0);
changemap("silêncio2", index, 1, 0);
send_reliable(players[index].peer_id, "ps paraquedas.ogg", 0);
players[index].tmaquina.restart();
}
else if(nitem=="llabe_de_la_arena"&&players[index].inv_item_number("llabe_de_la_arena")>0){
changemap("arena", index, 1, 0);
send_reliable(0, "ps notify_applause.ogg", 0);
}
else if(nitem=="antídoto"&&players[index].inv_item_number("antídoto")>0){
players[index].inv_add_item("antídoto", -1);
send_reliable(players[index].peer_id, "msgnormal Você sente seus músculos almentando de forma discomunal!", 0);
if(players[index].caverna==0)players[index].ncaverna=1;
players[index].tcaverna.restart();
players[index].caverna=1;
send_packet10(0, players[index].charname, players[index].charname, "b_antídoto.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(nitem=="pacote_de_mana"&&players[index].inv_item_number("pacote_de_mana")>0){
players[index].inv_add_item("pacote_de_mana", -1, false);
send_packet10(0, players[index].charname, players[index].charname, "acaixa.ogg "+players[index].x+" "+players[index].y, players[index].map);
players[index].inv_add_item("mana", random(50, 100));
}
//juniorpacote_de_natal
else if(nitem=="pacote_de_natal"&&players[index].inv_item_number("pacote_de_natal")>0){
//else if(nitem=="pacote_de_natal"&&players[index].inv_item_number("pacote_de_natal")>0&&DATE_DAY>=25){
players[index].inv_add_item("pacote_de_natal", -1);
string[] it;
it.insert_last("foguete");
it.insert_last("fita_explosiva");
it.insert_last("míssil");
it.insert_last("sugador");
it.insert_last("dardo");
it.insert_last("bomba_relógio");
it.insert_last("refrigerante");
it.insert_last("granada");
it.insert_last("molotov");
it.insert_last("maçã");
it.insert_last("banana");
it.insert_last("bomba_de_fogo");
it.insert_last("reais");
for(uint i=0;i<random(5, 13);i++){
players[index].inv_add_item(it[random(0, it.length()-1)], random(1, 5));
}
send_packet10(0, players[index].charname, players[index].charname, "acaixa.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(nitem=="galão_de_gasolina"&&players[index].inv_item_number("galão_de_gasolina")>0){
if(players[index].nalancha==1||string_contains(get_zone_at(players[index].x, players[index].y, players[index].map), "lago", 1)>-1&&players[index].map=="pesqueiro"){
string nome=pegarlancha(index);
if(nome!=""){
file f;
f.open("lanchas/"+nome+".md", "r");
int n=string_to_number(f.read());
f.close();
if(n>90){
send_reliable(players[index].peer_id, "msgnormal O tanque da lancha está cheio!", 0);
return;
}
else{
n=100;
if(n>100)n=100;
f.open("lanchas/"+nome+".md", "w");
f.write(n);
f.close();
send_packet10(0, players[index].charname, players[index].charname, "tanque.ogg "+players[index].x+" "+players[index].y, players[index].map);
players[index].inv_add_item("galão_de_gasolina", -1);
}
}
}
}
//juniorfoguete
else if(nitem=="foguete"&&players[index].inv_item_number("foguete")>0){
//else if(nitem=="foguete"&&players[index].inv_item_number("foguete")>0&&DATE_MONTH==1){
players[index].inv_add_item("foguete", -1);
send_reliable(0, "p2d fogos"+random(1, 4)+".ogg "+players[index].x+" "+players[index].y+8, 0);
for(uint i=0;i<players.length();i++){
players[i].xp+=(random(1, 3));
if(doublexp==1)players[i].xp+=(random(1, 3));
}
}
else if(nitem=="pacote_de_dardos"&&players[index].inv_item_number("pacote_de_dardos")>0){
players[index].inv_add_item("pacote_de_dardos", -1);
send_packet10(0, players[index].charname, players[index].charname, "acaixa.ogg "+players[index].x+" "+players[index].y, players[index].map);
players[index].inv_add_item("dardo", random(6, 10));
}
else if(nitem=="pacote_de_teleporters"&&players[index].inv_item_number("pacote_de_teleporters")>0){
players[index].inv_add_item("pacote_de_teleporters", -1, false);
send_packet10(0, players[index].charname, players[index].charname, "acaixa.ogg "+players[index].x+" "+players[index].y, players[index].map);
players[index].inv_add_item("teleporter", random(2, 5));
}
else if(nitem=="controle_para_fita_explosiva"&&players[index].inv_item_number("controle_para_fita_explosiva")>0&&players[index].pacifico==0){
for(uint i=0;i<fitaexplosivas.length();i++){
if(fitaexplosivas[i].nomecolou==players[index].charname&&fitaexplosivas[i].explodir==false){
fitaexplosivas[i].explodir=true;
fitaexplosivas[i].texplodir.restart();
send_reliable(players[index].peer_id, "msgnormal Destinado!", 0);
break;
}
}
}
else if(nitem=="antibiótico"&&players[index].inv_item_number("antibiótico")>0){
players[index].inv_add_item("antibiótico", -1);
send_packet(0, "play antibiótico.ogg "+players[index].x+" "+players[index].y, players[index].map);
players[index].doente=0;
players[index].ngripe=0;
}
else if(nitem=="ovo_de_páscoa"&&players[index].inv_item_number("ovo_de_páscoa")>0){
players[index].inv_add_item("ovo_de_páscoa", -1);
int xp=1000000;
for(uint i=0;i<players.length();i++){
players[i].xp+=xp;
}
int vida=random(50, 100);
players[index].maxhealth+=vida;
players[index].health+=vida;
send_packet10(0, players[index].charname, players[index].charname, "abrindo_ovo_de_páscoa.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(nitem=="cachorro_quente"&&players[index].inv_item_number("cachorro_quente")>0){
if(players[index].ncoco>=50){send_reliable(players[index].peer_id, "msgnormal Mas você está muito chei"+players[index].sexo2+"!", 0);return;}
players[index].inv_add_item("cachorro_quente", -1);
players[index].nfome-=30;
players[index].ncoco+=30;
send_packet(0, "play cachorroquente.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(nitem=="pastel_de_carne"&&players[index].inv_item_number("pastel_de_carne")>0){
if(players[index].ncoco>=50){send_reliable(players[index].peer_id, "msgnormal Mas você está muito chei"+players[index].sexo2+"!", 0);return;}
players[index].inv_add_item("pastel_de_carne", -1);
players[index].nfome-=25;
players[index].ncoco+=25;
send_packet(0, "play pastel.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(nitem=="pastel_de_queijo"&&players[index].inv_item_number("pastel_de_queijo")>0){
if(players[index].ncoco>=50){send_reliable(players[index].peer_id, "msgnormal Mas você está muito chei"+players[index].sexo2+"!", 0);return;}
players[index].inv_add_item("pastel_de_queijo", -1);
players[index].nfome-=20;
players[index].ncoco+=20;
send_packet(0, "play pastel.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(nitem=="cochinha"&&players[index].inv_item_number("cochinha")>0){
if(players[index].ncoco>=50){send_reliable(players[index].peer_id, "msgnormal Mas você está muito chei"+players[index].sexo2+"!", 0);return;}
players[index].inv_add_item("cochinha", -1);
players[index].nfome-=10;
players[index].ncoco+=10;
send_packet(0, "play cochinha.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(nitem=="enroladinho"&&players[index].inv_item_number("enroladinho")>0){
if(players[index].ncoco>=50){send_reliable(players[index].peer_id, "msgnormal Mas você está muito chei"+players[index].sexo2+"!", 0);return;}
players[index].inv_add_item("enroladinho", -1);
players[index].nfome-=10;
players[index].ncoco+=10;
send_packet(0, "play enroladinho.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(nitem=="torresmo"&&players[index].inv_item_number("torresmo")>0){
if(players[index].ncoco>=50){send_reliable(players[index].peer_id, "msgnormal Mas você está muito chei"+players[index].sexo2+"!", 0);return;}
players[index].inv_add_item("torresmo", -1);
players[index].nfome-=7;
players[index].ncoco+=7;
send_packet(0, "play torresmo.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(nitem=="batata_frita"&&players[index].inv_item_number("batata_frita")>0){
if(players[index].ncoco>=50){send_reliable(players[index].peer_id, "msgnormal Mas você está muito chei"+players[index].sexo2+"!", 0);return;}
players[index].inv_add_item("batata_frita", -1);
players[index].nfome-=5;
players[index].ncoco+=5;
send_packet(0, "play batatafrita.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(nitem=="suco_de_morango"&&players[index].inv_item_number("suco_de_morango")>0){
if(players[index].nurina>=50){send_reliable(players[index].peer_id, "msgnormal Mas você está muito chei"+players[index].sexo2+"!", 0);return;}
players[index].inv_add_item("suco_de_morango", -1);
players[index].nsede-=22;
players[index].nurina+=22;
send_packet(0, "play bebendo_suco.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(nitem=="suco_de_pêssego"&&players[index].inv_item_number("suco_de_pêssego")>0){
if(players[index].nurina>=50){send_reliable(players[index].peer_id, "msgnormal Mas você está muito chei"+players[index].sexo2+"!", 0);return;}
players[index].inv_add_item("suco_de_pêssego", -1);
players[index].nsede-=19;
players[index].nurina+=19;
send_packet(0, "play bebendo_suco.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(nitem=="suco_de_caju"&&players[index].inv_item_number("suco_de_caju")>0){
if(players[index].nurina>=50){send_reliable(players[index].peer_id, "msgnormal Mas você está muito chei"+players[index].sexo2+"!", 0);return;}
players[index].inv_add_item("suco_de_caju", -1);
players[index].nsede-=17;
players[index].nurina+=17;
send_packet(0, "play bebendo_suco.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(nitem=="suco_de_goiaba"&&players[index].inv_item_number("suco_de_goiaba")>0){
if(players[index].nurina>=50){send_reliable(players[index].peer_id, "msgnormal Mas você está muito chei"+players[index].sexo2+"!", 0);return;}
players[index].inv_add_item("suco_de_goiaba", -1);
players[index].nsede-=15;
players[index].nurina+=15;
send_packet(0, "play bebendo_suco.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(nitem=="boné")
{
if(players[index].inv_item_number("boné")>0)
{
if(players[index].bonemizuno==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].chapeupanama==1||players[index].capacetepolicia==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);
}
else
{
send_packet(0,"play bonedraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].bonemizuno=1;
}
}
}
else if(nitem=="r2")
{
string horastring;
if (hora==0&&minuto==0)
horastring="Meia noite em ponto";
if(hora==0&&minuto>0)
horastring="0 horas e ";
if (hora==1&&minuto==0)
horastring="Uma hora em ponto";
if(hora==1&&minuto>0)
horastring="uma hora e ";
if (hora==2&&minuto==0)
horastring="Duas horas em ponto";
if(hora==2&&minuto>0)
horastring="duas horas e ";
if (hora>2&&minuto==0)
horastring=hora+" horas em ponto";
if(hora>2&&minuto>0)
horastring=hora+" horas e ";
if (minuto==1)
horastring+="um minuto";
if (minuto>1)
horastring+=minuto+" minutos";
if(players[index].relogio==1){
send_packet(0,"play relogio.ogg "+players[index].x+" "+players[index].y,players[index].map);
send_reliable(event.peer_id,"msgrelogio "+horastring+".", 0);
}
else if(players[index].map=="milão2"||players[index].map=="los_angeles2"||players[index].map=="cidade_de_santa_bertalina"){
send_reliable(players[index].peer_id, "msgnormal Você olha as horas no relógio da igreja:", 0);
send_reliable(event.peer_id,"msgrelogio "+horastring+".", 0);
}
else send_reliable(players[index].peer_id, "msgnormal Você não está usando nenhum relógio.", 0);
}
else if(nitem=="capacete_de_polícia")
{
if(players[index].inv_item_number("capacete_de_polícia")>0)
{
if(players[index].capacetepolicia==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].chapeupanama==1||players[index].bonemizuno==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);
}
else
{
send_packet(0,"play capacetedraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].capacetepolicia=1;
}
}
}
else if(nitem=="relógio"){
if(players[index].inv_item_number("relógio")>0)
{
if(players[index].relogio==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else
{
send_packet(0,"play relógiodraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].relogio=1;
}
}
}
else if(nitem=="óculos_escuros")
{
if(players[index].inv_item_number("óculos_escuros")>0)
{
if(players[index].oculosmizuno==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else
{
send_packet(0,"play oculosdraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].oculosmizuno=1;
}
}
}
else if(nitem=="chapéu_panamá")
{
if(players[index].inv_item_number("chapéu_panamá")>0)
{
if(players[index].chapeupanama==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
if(players[index].capacetepolicia==1||players[index].capacetepolicia==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);
}
else
{
send_packet(0,"play chapeudraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].chapeupanama=1;
}
}
}
else if(nitem=="luvas")
{
if(players[index].inv_item_number("luvas")>0)
{
if(players[index].luvas==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else
{
send_packet(0,"play luvadraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].luvas=1;
}
}
}
else if(nitem=="calça_camuflada")
{
if(players[index].inv_item_number("calça_camuflada")>0)
{
if(players[index].calcacamuflada==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].calcajeans==1 or players[index].calcamizuno==1 or players[index].calcalegging==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);
}
else
{
send_packet(0,"play calcadraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].calcacamuflada=1;
}
}
}
else if(nitem=="sapato_scarpin")
{
if(players[index].inv_item_number("sapato_scarpin")>0)
{
if(players[index].sapatoscarpin==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].botamizuno==1 or players[index].tenisadidas==1 or players[index].tenisnike==1 or players[index].coturnomilitar==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);
}
else
{
send_packet(0,"play botadraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].sapatoscarpin=1;
}
}
}
else if(nitem=="sapato_magnético"){
if(players[index].inv_item_number("sapato_magnético")>0){
if(players[index].sapatomagnetico==1)send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
else if(players[index].botamizuno==1||players[index].tenisadidas==1||players[index].tenisnike==1||players[index].coturnomilitar==1||players[index].sapatoscarpin==1)send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);
else{
send_packet(0,"play botadraw.ogg "+players[index].x+" "+players[index].y, players[index].map);
players[index].sapatomagnetico=1;
send_reliable(players[index].peer_id, "asapato", 0);
}
}
}
else if(nitem=="coturno_militar")
{
if(players[index].inv_item_number("coturno_militar")>0)
{
if(players[index].coturnomilitar==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].botamizuno==1 or players[index].tenisadidas==1 or players[index].tenisnike==1 or players[index].sapatoscarpin==1||players[index].sapatomagnetico==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);
}
else
{
send_packet(0,"play botadraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].coturnomilitar=1;
}
}
}
else if(nitem=="calça_legging")
{
if(players[index].inv_item_number("calça_legging")>0)
{
if(players[index].calcalegging==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].calcajeans==1 or players[index].calcamizuno==1 or players[index].calcacamuflada==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);
}
else
{
send_packet(0,"play calcadraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].calcalegging=1;
}
}
}
else if(nitem=="pulseira")
{
if(players[index].inv_item_number("pulseira")>0)//Se o inventário do jogador tem o item boné maior que 0..
{
if(players[index].pulseira==1)//Se já estiver usando o item
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);//Ignora isso. É frase de todos.
}
else if(players[index].pulseira==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);//Mensagem única
}
else
{
send_packet(0,"play pulseiradraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].pulseira=1;
}
}
}
else if(nitem=="pulseira_de_bronze")
{
if(players[index].inv_item_number("pulseira_de_bronze")>0)
{
if(players[index].pulseirabronze==1)//Se já estiver usando o item
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);//Ignora isso. É frase de todos.
}
else if(players[index].pulseira==1||players[index].luvas==1||players[index].pulseiraprata==1||players[index].pulseiraouro==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);//Mensagem única
}
else
{
send_packet(0,"play pulseiradraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].pulseirabronze=1;
}
}
}
else if(nitem=="pulseira_de_prata")
{
if(players[index].inv_item_number("pulseira_de_prata")>0)
{
if(players[index].pulseiraprata==1)//Se já estiver usando o item
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);//Ignora isso. É frase de todos.
}
else if(players[index].pulseira==1||players[index].luvas==1||players[index].pulseiraouro==1||players[index].pulseirabronze==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);//Mensagem única
}
else
{
send_packet(0,"play pulseiradraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].pulseiraprata=1;
}
}
}
else if(nitem=="pulseira_de_ouro")
{
if(players[index].inv_item_number("pulseira_de_ouro")>0)
{
if(players[index].pulseiraouro==1)//Se já estiver usando o item
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);//Ignora isso. É frase de todos.
}
else if(players[index].pulseira==1||players[index].luvas==1||players[index].pulseiraprata==1||players[index].pulseirabronze==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);//Mensagem única
}
else
{
send_packet(0,"play pulseiradraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].pulseiraouro=1;
}
}
}
else if(nitem=="pulseira")
{
if(players[index].inv_item_number("pulseira")>0)//Se o inventário do jogador tem o item boné maior que 0..
{
if(players[index].pulseira==1)//Se já estiver usando o item
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);//Ignora isso. É frase de todos.
}
else if(players[index].pulseiraouro==1||players[index].pulseiraprata==1||players[index].pulseirabronze==1||players[index].luvas==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);//Mensagem única
}
else
{
send_packet(0,"play pulseiradraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].pulseira=1;
}
}
}
else if(nitem=="colete_aprova_de_balas"){
if(players[index].inv_item_number("colete_aprova_de_balas")>0){
if(players[index].colete_aprova_de_balas==1){
send_reliable(players[index].peer_id,"msgnormal Mas você já está vestindo isso!",0);
}
else if(players[index].naopodevestir==1||players[index].coletemilitar==1||players[index].coletecamuflado==1||players[index].jaquetacouro==1||players[index].coletesalvavida==1||players[index].coletemizuno==1){
send_reliable(players[index].peer_id,"msgnormal Você está tentando vestir uma peça sobre outra. Isso não vai funcionar.",0);
}
else{
send_packet(0,"play coletedraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].colete_aprova_de_balas=1;
}
}
}
else if(nitem=="colete_camuflado")
{
if(players[index].inv_item_number("colete_camuflado")>0)
{
if(players[index].coletecamuflado==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].coletemizuno==1||players[index].coletemilitar==1||players[index].jaquetacouro==1||players[index].coletesalvavida==1||players[index].colete_aprova_de_balas==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);
}
else
{
send_packet(0,"play coletedraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].coletecamuflado=1;
}
}
}
else if(nitem=="colete_salva_vida")
{
if(players[index].inv_item_number("colete_salva_vida")>0)
{
if(players[index].coletesalvavida==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].jaquetacouro==1 or players[index].coletemizuno==1||players[index].coletecamuflado==1||players[index].colete_aprova_de_balas==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);//Mensagem única
}
else
{
send_reliable(players[index].peer_id,"usarcolete",0);
send_packet(0,"play coletedraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].coletesalvavida=1;
}
}
}
else if(nitem=="braçadeira")
{
if(players[index].inv_item_number("braçadeira")>0)//Se o inventário do jogador tem o item boné maior que 0..
{
if(players[index].bracadeira==1)//Se já estiver usando o item
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);//Ignora isso. É frase de todos.
}
else if(players[index].pulseira==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);//Mensagem única
}
else
{
send_packet(0,"play pulseiradraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].bracadeira=1;
}
}
}
else if(nitem=="anel")
{
if(players[index].inv_item_number("anel")>0)//Se o inventário do jogador tem o item boné maior que 0..
{
if(players[index].anel==1)//Se já estiver usando o item
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);//Ignora isso. É frase de todos.
}
else
{
send_packet(0,"play aneldraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].anel=1;
}
}
}
else if(nitem=="jaqueta_de_couro")
{
if(players[index].inv_item_number("jaqueta_de_couro")>0)
{
if(players[index].jaquetacouro==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);//Ignora isso. É frase de todos.
}
else if(players[index].coletemizuno==1 or players[index].coletesalvavida==1||players[index].coletemilitar==1||players[index].colete_aprova_de_balas==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);//Mensagem única
}
else
{
send_packet(0,"play jaquetadraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].jaquetacouro=1;
}//Finaliza a função, onde se verifica que o jogador tem mais de 0 itens no inventário
}//Finaliza o parsed onde se procura a função do item
}
else if(nitem=="escudo")
{
if(players[index].inv_item_number("escudo")>0)
{
if(players[index].escudo==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].jaquetacouro==1 or players[index].coletesalvavida==1 or players[index].coletecamuflado==1 or players[index].coletemizuno==1 or players[index].coletemilitar==
1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);//Mensagem única
}
else
{
send_packet(0,"play escudodraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].escudo=1;
}
}
}
else if(nitem=="colete_de_borracha")
{
if(players[index].inv_item_number("colete_de_borracha")>0)
{
if(players[index].coletemizuno==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].jaquetacouro==1 or players[index].coletesalvavida==1 or players[index].coletecamuflado==1 or players[index].coletemilitar==1 or players[index].colete_aprova_de_balas==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);//Mensagem única
}
else
{
send_packet(0,"play coletedraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].coletemizuno=1;
}
}
}
else if(nitem=="colete_militar")
{
if(players[index].inv_item_number("colete_militar")>0)
{
if(players[index].coletemilitar==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].jaquetacouro==1 or players[index].coletesalvavida==1 or players[index].coletecamuflado==1 or players[index].coletemizuno==1or players[index].escudo==1||players[index].colete_aprova_de_balas==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);//Mensagem única
}
else
{
send_packet(0,"play coletedraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].coletemilitar=1;
}
}
}
else if(nitem=="camisa_de_malha")
{
if(players[index].inv_item_number("camisa_de_malha")>0)
{
if(players[index].camisamalha==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else
{
send_packet(0,"play camisadraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].camisamalha=1;
}
}
}
else if(nitem=="calça_social")
{
if(players[index].inv_item_number("calça_social")>0)
{
if(players[index].calcamizuno==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].calcajeans==1 or players[index].calcalegging==1 or players[index].calcacamuflada==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);
}
else
{
send_packet(0,"play calcadraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].calcamizuno=1;
}
}
}
else if(nitem=="calça_jeans")
{
if(players[index].inv_item_number("calça_jeans")>0)
{
if(players[index].calcajeans==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].calcamizuno==1 or players[index].calcacamuflada==1 or players[index].calcalegging==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);
}
else
{
send_packet(0,"play calcadraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].calcajeans=1;
}
}
}
else if(nitem=="sapato_social")
{
if(players[index].inv_item_number("sapato_social")>0)
{
if(players[index].botamizuno==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].tenisadidas==1 or players[index].tenisnike==1 or players[index].coturnomilitar==1 or players[index].sapatoscarpin==1||players[index].sapatomagnetico==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);
}
else
{
send_packet(0,"play botadraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].botamizuno=1;
}
}
}
else if(nitem=="tênis_de_corrida")
{
if(players[index].inv_item_number("tênis_de_corrida")>0)
{
if(players[index].tenisnike==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].botamizuno==1 or players[index].tenisadidas==1 or players[index].coturnomilitar==1 or players[index].sapatoscarpin==1||players[index].sapatomagnetico==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);
}
else
{
send_packet(0,"play tenisdraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].tenisnike=1;
}
}
}
else if(nitem=="Sandália")
{
if(players[index].inv_item_number("Sandália")>0)
{
if(players[index].tenisadidas==1)
{
send_reliable(players[index].peer_id, "msgjáestávestindo", 0);
}
else if(players[index].botamizuno==1 or players[index].tenisnike==1 or players[index].coturnomilitar==1 or players[index].sapatoscarpin==1||players[index].sapatomagnetico==1)
{
send_reliable(players[index].peer_id, "msgpeçasobreoutra", 0);
}
else
{
send_packet(0,"play tenisdraw.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].tenisadidas=1;
}
}
}
else if(nitem=="coco"&&players[index].inv_item_number("coco")>0){
if(players[index].nurina>=50){send_reliable(players[index].peer_id, "msgnormal Mas você está muito chei"+players[index].sexo2+"!", 0);return;}
send_reliable(players[index].peer_id, "stopmoving", 0);
players[index].inv_add_item("coco", -1);
players[index].inv_add_item("coco_vazio", 1);
players[index].paralisado=true;
players[index].maxhealth+=100;
players[index].health+=100;
send_packet(0,"play bebendocôco.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].nparalisado+=6927;
players[index].tparalisado.restart();
players[index].nurina+=5;
players[index].nsede-=4;
}
else if(nitem=="coco_vazio"&&players[index].inv_item_number("coco_vazio")>0){
if(players[index].ncoco>=50){send_reliable(players[index].peer_id, "msgnormal Mas você está muito chei"+players[index].sexo2+"!", 0);return;}
send_reliable(players[index].peer_id, "stopmoving", 0);
players[index].inv_add_item("coco_vazio", -1);
players[index].paralisado=true;
players[index].maxhealth+=50;
players[index].health+=50;
send_packet(0,"play comendocôco.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].nparalisado+=10839;
players[index].tparalisado.restart();
players[index].ncoco+=2;
players[index].nfome-=3;
}
else if(nitem=="controle_remoto"&&players[index].inv_item_number("controle_remoto")>0){
bool achou=false;
for(uint i=0;i<bombaremotas.length();i++){
if(bombaremotas[i].nome==players[index].charname&&bombaremotas[i].ativou==false){
achou=true;
bombaremotas[i].ativou=true;
}
}
if(achou==false) send_reliable(players[index].peer_id, "msgnormal Nenhuma bomba em seu detonador!", 0);
else send_packet(0,"play bombaremotadetonador.ogg "+players[index].x+" "+players[index].y+" "+players[index].map, players[index].map);
}
else if(nitem=="pacote_de_flechas"&&players[index].inv_item_number("pacote_de_flechas")>0){
int a=random(2, 5);
for(uint i=0;i<a;i++){
send_reliable(players[index].peer_id, "ps getflecha.ogg", 0);
players[index].inv_add_item("flecha", 1);
}
players[index].inv_add_item("pacote_de_flechas", -1);
}
else if(nitem=="máquina_personagem"){
string animais="dragonsauro\r\nsequestrador\r\nurso\r\nguarda\r\nprensadeira\r\nmercenario";
send_reliable(players[index].peer_id, "manimais "+animais, 0);
}
else if(nitem=="escudo_do_tempo"&&players[index].inv_item_number("escudo_do_tempo")>0){
//string_contains(players[index].map, "prisão", 1)<0
if(players[index].map=="pré_história"||players[index].map=="mundo_medieval"){
players[index].inv_add_item("escudo_do_tempo", -1);
send_reliable(players[index].peer_id, "stopmoving", 0);
send_reliable(players[index].peer_id, "ps escudoloop.ogg", 0);
players[index].paralisado=true;
players[index].nparalisado+=9912;
players[index].tparalisado.restart();
players[index].vtempo=1;
}
else return;
}
else if(nitem=="concha_marinha"&&players[index].inv_item_number("concha_marinha")>0){
players[index].inv_add_item("concha_marinha",-1);
send_packet(0, "play quebrandoconcha.ogg "+players[index].x+" "+players[index].y+" "+players[index].map, players[index].map);
players[index].inv_add_item("pérola",1);
}
else if(nitem=="teleportador"){
string[] a=find_files("maps/*.map");
string m;
for(uint i=0;i<a.length();i++){
if(i<a.length()) m+=a[i]+"\r\n";
else if(i==a.length()-1) m+=a[i];
}
send_reliable(players[index].peer_id, "mtester "+m, 0);
}
else if(nitem=="pera"&&players[index].inv_item_number("pera")>0){
players[index].inv_add_item("pera", -1);
int a=random(50, 90);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo2.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if(nitem=="lata_de_cocacola"&&players[index].inv_item_number("lata_de_cocacola")>0){
players[index].inv_add_item("lata_de_cocacola", -1);
send_unreliable(players[index].peer_id, "msgnormal as avierto la lata!", 0);
send_packet(0,"play potion.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].inv_add_item("lata_de_cocacola_abierta", 1);
players[index].inv_add_item("cocacola", 25);
}
else if(nitem=="lata_de_cocacola_abierta"&&players[index].inv_item_number("cocacola")>0){
players[index].health+=5000;
players[index].maxhealth+=5000;
send_reliable(players[index].peer_id, "msgnormal tomas una de la lata!", 0);
players[index].inv_add_item("cocacola", -1);
}
else if(nitem=="caqui"&&players[index].inv_item_number("caqui")>0){
players[index].inv_add_item("caqui", -1);
int a=random(100, 150);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo1.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if(nitem=="maçã"&&players[index].inv_item_number("maçã")>0){
players[index].inv_add_item("maçã", -1);
int a=random(80, 100);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo2.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if(nitem=="banana"&&players[index].inv_item_number("banana")>0){
players[index].inv_add_item("banana", -1);
int a=random(100, 150);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo1.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if(nitem=="morango"&&players[index].inv_item_number("morango")>0){
players[index].inv_add_item("morango", -1);
int a=random(15, 20);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo1.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if(nitem=="azeitona"&&players[index].inv_item_number("azeitona")>0){
players[index].inv_add_item("azeitona", -1);
int a=random(8, 15);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo1.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if(nitem=="goiaba"&&players[index].inv_item_number("goiaba")>0){
players[index].inv_add_item("goiaba", -1);
int a=random(80, 90);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo2.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if(nitem=="figo"&&players[index].inv_item_number("figo")>0){
players[index].inv_add_item("figo", -1);
int a=random(70, 80);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo1.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if(nitem=="pêssego"&&players[index].inv_item_number("pêssego")>0){
players[index].inv_add_item("pêssego", -1);
int a=random(70, 80);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo1.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if(nitem=="llabe_de_la_casa"&&players[index].inv_item_number("llabe_de_la_casa")>0){
players[index].inv_add_item("llabe_de_la_casa", -1);
changemap("apartamento_de_"+players[index].charname, index, 1, 0);
}
else if(nitem=="amora"&&players[index].inv_item_number("amora")>0){
players[index].inv_add_item("amora", -1);
int a=random(5, 10);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo1.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if(nitem=="caju"&&players[index].inv_item_number("caju")>0){
players[index].inv_add_item("caju", -1);
int a=random(120, 165);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo3.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if(nitem=="ameixa"&&players[index].inv_item_number("ameixa")>0){
players[index].inv_add_item("ameixa", -1);
int a=random(40, 50);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo1.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if(nitem=="jabuticaba"&&players[index].inv_item_number("jabuticaba")>0){
players[index].inv_add_item("jabuticaba", -1);
int a=random(10, 15);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo1.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if(nitem=="lichia"&&players[index].inv_item_number("lichia")>0){
players[index].inv_add_item("lichia", -1);
int a=random(10, 20);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo1.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
else if(nitem=="damasco"&&players[index].inv_item_number("damasco")>0){
players[index].inv_add_item("damasco", -1);
int a=random(5, 10);
players[index].maxhealth+=a;
players[index].health+=a;
send_packet(0,"play mordendo1.ogg "+players[index].x+" "+players[index].y,players[index].map);
}
}
void retirar(int index, string nitem){
string ver=nitem;
if(nitem=="boné")
{
if(players[index].bonemizuno==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"boné",1)>-1)
players[index].bonemizuno=0;
}
}
else if(nitem=="colete_aprova_de_balas"){
if(players[index].colete_aprova_de_balas==0){
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else{
if(string_contains(ver,"colete",1)>-1) send_packet(0,"play retirarcolete.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].colete_aprova_de_balas=0;
}
}
else if(nitem=="colete_militar")
{
if(players[index].coletemilitar==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"colete",1)>-1) send_packet(0,"play retirarcolete.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].coletemilitar=0;
}
}
else if(nitem=="relógio"){
if(players[index].relogio==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"capacete",1)>-1) send_packet(0,"play retirarrelógio.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].relogio=0;
}
}
else if(nitem=="capacete_de_polícia")
{
if(players[index].capacetepolicia==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"capacete",1)>-1) send_packet(0,"play retirarcapacete2.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].capacetepolicia=0;
}
}
else if(nitem=="pulseira_de_ouro")
{
if(players[index].pulseiraouro==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"pulseira",1)>-1) send_packet(0,"play retirarpulseira.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].pulseiraouro=0;
}
}
else if(nitem=="pulseira_de_bronze")
{
if(players[index].pulseirabronze==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"pulseira",1)>-1) send_packet(0,"play retirarpulseira.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].pulseirabronze=0;
}
}
else if(nitem=="pulseira_de_prata")
{
if(players[index].pulseiraprata==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"pulseira",1)>-1) send_packet(0,"play retirarpulseira.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].pulseiraprata=0;
}
}
else if(nitem=="escudo")
{
if(players[index].escudo==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"escudo",1)>-1)
players[index].escudo=0;
}
}
else if(nitem=="colete_camuflado")
{
if(players[index].coletecamuflado==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"colete",1)>-1) send_packet(0,"play retirarcolete.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].coletecamuflado=0;
}
}
else if(nitem=="pulseira")
{
if(players[index].pulseira==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"pulseira",1)>-1) send_packet(0,"play retirarpulseira.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].pulseira=0;
}
}
else if(nitem=="sapato_scarpin")
{
if(players[index].sapatoscarpin==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"sapato",1)>-1)
players[index].sapatoscarpin=0;
}
}
else if(nitem=="sapato_magnético"){
if(players[index].sapatomagnetico==0)send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
else{
send_reliable(players[index].peer_id, "rsapato", 0);
players[index].sapatomagnetico=0;
send_packet(0,"play retirarbota.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
}
else if(nitem=="colete_salva_vida")
{
if(players[index].coletesalvavida==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"colete",1)>-1) send_packet(0,"play retirarcolete.ogg "+players[index].x+" "+players[index].y,players[index].map);
send_reliable(players[index].peer_id,"retirarcolete",0);
players[index].coletesalvavida=0;
}
}
else if(nitem=="braçadeira")
{
if(players[index].bracadeira==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"braçadeira",1)>-1)
players[index].bracadeira=0;
}
}
else if(nitem=="anel")
{
if(players[index].anel==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"anel",1)>-1)
players[index].anel=0;
}
}
else if(nitem=="coturno_militar")
{
if(players[index].coturnomilitar==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"coturno",1)>-1)
players[index].coturnomilitar=0;
}
}
else if(nitem=="calça_legging")
{
if(players[index].calcalegging==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"calça",1)>-1) send_packet(0,"play retirarcalca.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].calcalegging=0;
}
}
else if(nitem=="calça_camuflada")
{
if(players[index].calcacamuflada==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"calça",1)>-1) send_packet(0,"play retirarcalca.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].calcacamuflada=0;
}
}
else if(nitem=="luvas")
{
if(players[index].luvas==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"luva",1)>-1)
players[index].luvas=0;
}//Finaliza o else
}//Finaliza a verificação do nome deste item
else if(nitem=="jaqueta_de_couro")
{
if(players[index].jaquetacouro==0)//Se não estiver vestindo o boné
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);//Ignora, é mensagem igual para tudo
}
else//Se a variável bonemizuno não for 0
{
if(string_contains(ver,"jaqueta",1)>-1)
players[index].jaquetacouro=0;
}//Finaliza o else
}//Finaliza a verificação do nome deste item
else if(nitem=="óculos_escuros")
{
if(players[index].oculosmizuno==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"óculos",1)>-1) send_packet(0,"play retiraroculos.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].oculosmizuno=0;
}
}
else if(nitem=="colete_de_borracha")
{
if(players[index].coletemizuno==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"colete",1)>-1) send_packet(0,"play retirarcolete.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].coletemizuno=0;
}
}
else if(nitem=="sapato_social")
{
if(players[index].botamizuno==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"bota",1)>-1) send_packet(0,"play retirarbota.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].botamizuno=0;
}
}
else if(nitem=="calça_social")
{
if(players[index].calcamizuno==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"calça",1)>-1) send_packet(0,"play retirarcalca.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].calcamizuno=0;
}
}
else if(nitem=="camisa_de_malha")
{
if(players[index].camisamalha==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"camisa",1)>-1) send_packet(0,"play retirarcamisa.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].camisamalha=0;
}
}
else if(nitem=="calça_jeans")
{
if(players[index].calcajeans==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"calça",1)>-1) send_packet(0,"play retirarcalca.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].calcajeans=0;
}
}
else if(nitem=="Sandália")
{
if(players[index].tenisadidas==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"tênis",1)>-1) send_packet(0,"play retirartenis.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].tenisadidas=0;
}
}
else if(nitem=="tênis_de_corrida")
{
if(players[index].tenisnike==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"tênis",1)>-1) send_packet(0,"play retirartenis.ogg "+players[index].x+" "+players[index].y,players[index].map);
players[index].tenisnike=0;
}
}
else if(nitem=="chapéu_panamá")
{
if(players[index].chapeupanama==0)
{
send_reliable(players[index].peer_id, "msgnãoestávestindo", 0);
}
else
{
if(string_contains(ver,"chapéu",1)>-1)
players[index].chapeupanama=0;
}
}
tdemorar.force(120000);
netloop();
}
void move(int index, int x, int y, int bike=0, int n=0){
if(players[index].paralisado==true||players[index].paralisado2==true||players[index].afk)return;
players[index].x=x;
players[index].y=y;
send_packet3(0,"upl "+players[index].charname+" "+players[index].x+" "+players[index].y+" "+players[index].map,players[index].map);
string l=get_zone_at(players[index].x, players[index].y, players[index].map);
if(players[index].starsoundid!="") update_moving_sound(players[index].starsoundid,players[index].x,players[index].y);
if(players[index].map=="milão"||players[index].map=="milão2") players[index].chegoucidade=1;
if(players[index].map=="milão"||players[index].map=="milão2"||players[index].map=="floresta"||players[index].map=="escola") players[index].cidadenatal="milão";
else if(players[index].map=="los_angeles"||players[index].map=="aeroporto_internacional_de_los_angeles") players[index].cidadenatal="los_angeles";
if(players[index].nalancha==1){
string nome=pegarlancha(index);
if(nome!=""){
file f;
f.open("lanchas/"+nome+".md", "r");
double n=string_to_number(f.read());
f.close();
n-=0.2;
if(n<=0){
n=0;
send_reliable(players[index].peer_id, "ldf", 0);
}
f.open("lanchas/"+nome+".md", "w");
f.write(n);
f.close();
}
}
if(!players[index].cloakhiding&&players[index].invs==0&&players[index].jumping==0&&n==0){
for(uint za=0; za<players.length(); za++){
if(players[za].ouvirpassos==1&&players[za].map==players[index].map&&bike==1)send_reliable(players[za].peer_id, "sb "+players[index].charname+" "+players[index].x+" "+players[index].y+" "+players[index].map, 0);
else if(players[za].ouvirpassos==1&&players[za].map==players[index].map&&bike==0)send_reliable(players[za].peer_id, "s "+players[index].charname+" "+players[index].x+" "+players[index].y+" "+players[index].map, 0);
}
if(minas.length()>0){
for(uint i=0; i<minas.length; i++){
if(minas[i].x==players[index].x&&minas[i].y==players[index].y&&minas[i].owner!=players[index].charname&&minas[i].map==players[index].map){
if(!players[index].newbie){
send_packet(0,"impact mineexplode.ogg "+players[index].x+" "+players[index].y,players[index].map);
send_packet(0,"inithurt "+players[index].voice+" "+players[index].x+" "+players[index].y, players[index].map);
players[index].lasthit=minas[i].owner+"'s mina";
players[index].health-=minas[i].damage;
destroymina(minas[i].id);
break;
}
}
}
}
}
//Quest da montanha
if(l=="O topo!"&&players[index].map=="montanha"&&players[index].questmontanha==1&&players[index].terminouquestmontanha==0&&players[index].inv_item_number("areia_da_montanha")<=0){
send_reliable(players[index].peer_id, "msgnormal Após tantas dificuldades, barreiras e o que apareceu em sua frente, com determinação e esforço você chega no topo, o lugar mais auto e incrível de Mortalândia. É incrível como são as coisas daqui. Tudo parece minúsculo diante de seus olhos. Carros, pessoas e animais parecem formiguinhas perante você. Graças a esta conquista, você recebe um prêmio valioso, que será muito bem proveitoso la em baixo.", 0);
send_reliable(players[index].peer_id, "ps up_found.ogg", 0);
players[index].inv_add_item("areia_da_montanha", 1);
}
//Verificar base da montanha
if(l=="Base da montanha"&&players[index].questmontanha==1&&players[index].terminouquestmontanha==0&&players[index].inv_item_number("areia_da_montanha")>0){
send_reliable(players[index].peer_id, "msgnormal Ótimo trabalho! Após subir, avistar os animais parecendo formiguinhas, correr muitos riscos você chega em seu destino final. Seu longo trabalho resulta em um casaco de peles muito quentinho, que certamente lhe ajudará em alguma situação.", 0);
send_reliable(players[index].peer_id, "ps up_found.ogg", 0);
players[index].inv_add_item("areia_da_montanha", -1);
players[index].inv_add_item("carta_do_costureiro", 1);
players[index].inv_add_item("casaco_de_peles", 1);
players[index].terminouquestmontanha=1;
}
netloop();
}
void atirar(int index, int lado, int arma){
if(lado==Back&&players[index].jumping==1){
return;
}
else if(players[index].insz==false&&players[index].pacifico==0&&players[index].newbie==false&&players[index].map!="túnel"&&players[index].paralisado==false&&players[index].paralisado2==false&&gamestopped==false&&players[index].afk==false&&players[index].afking==false){
int arma2=(arma-1);
if(arma2<0)arma2=0;
string[] armp=string_split(weapons[arma2], ":", false);
if(armp.length()<2)return;
string somtiro=armp[0];
players[index].tarma=somtiro;
int dano=string_to_number(armp[2]);
int distancia=string_to_number(armp[1]);
int sarma=string_to_number(armp[3]);
int velocidade=1;
string lsound="";
if(somtiro!=""){
if(somtiro!="galil.ogg"&&somtiro!="galils.ogg")send_packet3(0, "f "+somtiro+" "+players[index].x+" "+players[index].y, players[index].map);
else if(string_contains(somtiro, "galil", 1)>-1)send_packet3(0, "f2 "+players[index].charname+" "+somtiro+" "+players[index].x+" "+players[index].y, players[index].map);
}
arma2+=1;
if(arma2==3)
players[index].inv_add_item("12mm",-1, false);
else if(arma2==4)
players[index].inv_add_item("9mm",-1, false);
else if(arma2==5)
players[index].inv_add_item("9mm",-1, false);
else if(arma2==6)
players[index].inv_add_item("flecha",-1, false);
else if(arma2==7)
players[index].inv_add_item("5.56mm",-1, false);
else if(arma2==8)
players[index].inv_add_item("7.62mm",-5, false);
else if(arma2==9)players[index].inv_add_item("granada",-1);
else if(arma2==10)
players[index].inv_add_item("5.56mm",-1, false);
else if(arma2==11)
players[index].inv_add_item("12mm",-1, false);
else if(arma2==12)
players[index].inv_add_item("laser",-1, false);
else if(arma2==13)
players[index].inv_add_item("míssil",-1, false);
else if(arma2==14)
players[index].inv_add_item("granada",-1, false);
else if(arma2==15)
players[index].inv_add_item("7.62mm",-1, false);
else if(arma2==16)
players[index].inv_add_item("9mm",-1, false);
else if(arma2==17)
players[index].inv_add_item("9mm",-1, false);
else if(arma2==18)
players[index].inv_add_item("5.56mm",-1, false);
else if(arma2==19)
players[index].inv_add_item("7.62mm",-5, false);
else if(arma2==21)
players[index].inv_add_item("30mm",-1, false);
else if(arma2==22)
players[index].inv_add_item("12mm",-2, false);
else if(arma2==23)
players[index].inv_add_item("7.62mm",-10, false);
else if(arma2==24)
players[index].inv_add_item("5.56mm",-1, false);
else if(arma2==25)
players[index].inv_add_item("5.56mm",-1, false);
else if(arma2==26)
players[index].inv_add_item("7.62mm",-1, false);
else if(arma2==27){
players[index].tirostaser--;
}
else if(arma2==31)
players[index].inv_add_item("9mm",-1, false);
else if(arma2==32)
players[index].inv_add_item("5.56mm",-1, false);
else if(arma2==33)players[index].inv_add_item("laser",-1, false);
else if(arma2==34)
players[index].inv_add_item("molotov", -1);
else if(arma2==35){
if(players[index].extintor>0){
players[index].extintor--;
send_packet(0, "play extintor.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else send_packet(0, "play descarregado_extintor.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
else if(arma2==36)players[index].inv_add_item("7.62mm",-1, false);
else if(arma2==37)players[index].inv_add_item("7.62mm",-1, false);
else if(arma2==39)players[index].inv_add_item("7.62mm",-1, false);
if(players[index].map=="pré_história"){
dano=40;
if(arma2==1)dano=random(100, 150);
else if(arma2==2)dano=random(300, 350);
else if(arma2==20)dano=random(440, 480);
else if(arma2==28)dano=random(150, 200);
else if(arma2==30)dano=random(350, 388);
}
if(players[index].caverna==1){
dano=(dano*3);
send_packet10(0, players[index].charname, players[index].charname, "arcorico.ogg "+players[index].x+" "+players[index].y, players[index].map);
}
if(arma2==35&&players[index].extintor>0||arma2!=35)spawn_bullet(dano, distancia,players[index].x,players[index].y,lado, players[index].charname, arma2,players[index].map,velocidade,sarma, lsound);
}
}
void atirar2(int index, int lado, int arma){
if(lado==Back&&players[index].jumping==1){
return;
}
else if(players[index].insz==false&&players[index].pacifico==0&&players[index].newbie==false&&players[index].map!="túnel"&&players[index].paralisado==false&&players[index].paralisado2==false&&gamestopped==false&&players[index].afk==false&&players[index].afking==false){
int arma2=(arma-1);
string[] armp=string_split(weapons2[arma2], ":", false);
if(armp.length()<2)return;
string somtiro=armp[0];
players[index].tarma=somtiro;
int dano=string_to_number(armp[2]);
int distancia=string_to_number(armp[1]);
int sarma=string_to_number(armp[3]);
int velocidade=1;
string lsound="";
if(somtiro!=""){
if(somtiro!="galil.ogg"&&somtiro!="galils.ogg")send_packet3(0, "f "+somtiro+" "+players[index].x+" "+players[index].y, players[index].map);
else if(string_contains(somtiro, "galil", 1)>-1)send_packet3(0, "f2 "+players[index].charname+" "+somtiro+" "+players[index].x+" "+players[index].y, players[index].map);
}
arma2+=1;
if(arma2==9)lsound="granadaloop.ogg";
if(arma2==6){
players[index].inv_add_item("flecha_envenenada",-1, false);
players[index].flecha=1;
}
if(arma2==9)players[index].inv_add_item("granada",-1);
if(arma2==11){
players[index].inv_add_item("12mm",-1, false);
}
if(arma2==16){
players[index].inv_add_item("9mm",-1, false);
}
if(arma2==18){
players[index].inv_add_item("5.56mm",-3, false);
players[index].rajada=1;
}
if(arma2==24){
players[index].inv_add_item("5.56mm",-1, false);
}
if(arma2==25){
players[index].inv_add_item("5.56mm",-1, false);
}
if(arma2==26){
players[index].inv_add_item("7.62mm",-5, false);
players[index].rajada=1;
}
else if(arma2==36)players[index].inv_add_item("7.62mm",-1, false);
spawn_bullet(dano, distancia,players[index].x,players[index].y,lado, players[index].charname, arma2, players[index].map,velocidade,sarma, lsound);
}
}
void terminar(int index, int j=0, int falar=0, int nsalvar=0){
send_reliable(0, "off "+players[index].charname+" "+falar+" 0", 0);
if(players[index].starsoundid!="") destroy_moving_sound(players[index].starsoundid);
if(players[index].tfid!="")destroy_moving_sound(players[index].tfid);
if(players[index].bipar==0)players[index].bipar=1;
if(players[index].vmap!=""){
players[index].map=players[index].vmap;
players[index].x=players[index].vx;
players[index].y=players[index].vy;
players[index].bipar=players[index].vbipar;players[index].invs=players[index].vinvs;
}
if(nsalvar==0)sconfigs(index);
players.remove_at(index);
}
void frasesbarra(int index, int nsom, string nsom2){
string l=get_zone_at(players[index].x, players[index].y, players[index].map);
send_packet(0, "draw "+players[index].charname+" "+nsom2+" "+players[index].x+" "+players[index].y, players[index].map);
if(nsom=="1"&&l=="Cornelius, O Bruxo, está de pé aqui, preparando suas poções."){
if(players[index].inv_item_number("coins")>=players[index].inv_item_number("flecha")){
int a=players[index].inv_item_number("flecha");
players[index].inv_add_item("coins", -players[index].inv_item_number("flecha"));
players[index].inv_add_item("flecha", -players[index].inv_item_number("flecha"));
players[index].inv_add_item("flecha_envenenada", a);
send_reliable(players[index].peer_id, "msgnormal Cornélius, o bruxo entrega suas flechas, agora envenenadas, capases de matar qualquer um.", 0);
}
else{
send_reliable(players[index].peer_id, "msgnormal Você não tem dinheiro suficiente.", 0);
}
}
for(uint i=0;i<pajes.length();i++){
if(nsom=="1"&&players[index].anotado==""&&pajes[i].x==players[index].x&&players[index].y==pajes[i].y&&players[index].map==pajes[i].map){
string[] r;
r.insert_last("flecha");
r.insert_last("flecha_envenenada");
r.insert_last("refrigerante");
r.insert_last("energético");
int a=random(0, r.length()-1);
players[index].anotado=r[a];
players[index].chegoucidade=0;
send_reliable(players[index].peer_id, "msgpaje "+players[index].anotado, 0);
}
}
}
void enter(int index){
string map=players[index].map;
file f;
f.open("maps/"+map+".map", "r");
string mdata=f.read();
f.close();
string[] p1=delinear(mdata);
for(uint i=0; i<p1.length(); i++){
string[] parsed=string_split(p1[i], ":", true);
if(parsed[0]=="travelpoint"&&parsed.length()>8){
if(players[index].maptraveltimer.elapsed<10000&&players[index].insz==false||players[index].paralisado==true||players[index].paralisado2==true)return;
if(players[index].afking==true)return;
int minx=string_to_number(parsed[1]);
int maxx=string_to_number(parsed[2]);
int miny=string_to_number(parsed[3]);
int maxy=string_to_number(parsed[4]);
int newx=string_to_number(parsed[5]);
int newy=string_to_number(parsed[6]);
string newmap=parsed[7];
string newmap2=parsed[7];
string text=parsed[8];
string sec="";
if(parsed.length>9) sec=parsed[9];
string[] tmpout;
if(minx<=players[index].x&&maxx>=players[index].x&&miny<=players[index].y&&maxy>=players[index].y){
if(players[index].maptraveltimer.elapsed>700){
players[index].tcongelar.restart();
players[index].jaandou=0;
players[index].javoou=0;
if(string_contains(newmap,"aeroportos",1)>-1){
if(players[index].destino=="aeroporto_internacional_de_los_angeles") newmap="aeroporto_internacional_de_los_angeles";
else if(players[index].destino=="aeroporto") newmap="aeroporto";
}
else if(newmap=="quadro"){
if(players[index].idiomachat=="Desativado"){
send_reliable(players[index].peer_id, "msgnormal Escolha um chat para aceder esta sala.", 0);
newmap="aeroports";
newmap2="naotemmapa";
return;
}
newmap="quadro_"+players[index].idiomachat;
}
else if(string_contains(newmap,"túnels",1)>-1){
if(players[index].mapavoltar=="caverna")players[index].mapavoltar="continuação_da_montanha";
else if(string_contains(players[index].mapavoltar, "quadro", 1)>-1)players[index].mapavoltar="zona_de_segurança";
newmap=players[index].mapavoltar;
if(string_contains(newmap, "trem_andando", 1)>-1)newmap="trem";
if(string_contains(newmap, "avião_alto", 1)>-1)newmap="avião";
newx=xmorrer;newy=ymorrer;
if(newmap=="desafio_constante")newx=random(50, 60);
else if(newmap=="zona_de_segurança")newy=61;
}
else if(newmap=="paraqueda"){
if(mapaatual!="aeroporto"){
send_reliable(players[index].peer_id, "msgnormal Espere o avião chegar primeiro!", 0);
return;
}
else if(players[index].inv_item_number("paraquedas")<=0){send_reliable(players[index].peer_id, "msgnormal Você quer se suicidar???", 0);return;}
newmap="avião2";
}
else if(string_contains(newmap,"aeroports",1)>-1){
if(players[index].inv_item_number("um_passaporte")>0){
newmap="prisão";
players[index].fichaprisao+=1;
changemap("prisão", index, 1, 0);
send_reliable(players[index].peer_id, "msgnormal Você tentou embarcar com um passaporte falso e foi flagrad"+players[index].sexo2+" pela segurança do aeroporto, que te escoltou diretamente para a cadeia!", 0);
players[index].inv_add_item("um_passaporte", -players[index].inv_item_number("um_passaporte"));
players[index].tempoprisao.restart();
players[index].msgliberdade="Você cumpriu sua pena e está agora em liberdade!";
}
else if(players[index].passaporte==0){
send_reliable(players[index].peer_id, "msgnormal Você tentou embarcar sem um passaporte e foi flagrad"+players[index].sexo2+" pela segurança do aeroporto, que te escoltou diretamente para a cadeia!", 0);
newmap="prisão";
newmap2="naotemmapa";
players[index].tempoprisao.restart();
}
else if(players[index].inv_item_number("passagem_para_los_angeles")>0&&players[index].destino=="aeroporto_internacional_de_los_angeles"&&players[index].passaporte==1){
players[index].inv_add_item("passagem_para_los_angeles", -1);
players[index].x=players[index].x+2;
send_reliable(players[index].peer_id,"move "+players[index].x+" "+players[index].y,0);
send_packet(0,"upl "+players[index].charname+" "+players[index].x+" "	+players[index].y+" "+players[index].map,players[index].map);
}
else if(players[index].inv_item_number("passagem_para_milão")>0&&players[index].destino=="aeroporto"&&players[index].passaporte==1){
players[index].inv_add_item("passagem_para_milão", -1);
players[index].x=players[index].x+2;
send_reliable(players[index].peer_id,"move "+players[index].x+" "+players[index].y,0);
send_packet(0,"upl "+players[index].charname+" "+players[index].x+" "	+players[index].y+" "+players[index].map,players[index].map);
}
else{
send_reliable(players[index].peer_id, "msgdepois você não tem nenhuma passagem. Compre uma primeiro!", 0);
newmap="aeroports";
newmap2="naotemmapa";
}
}
else if(string_contains(newmap, "máquina_do_tempo", 1)>-1){
bool maq=false;
for(uint i=0;i<maquinatempos.length();i++){
if(maquinatempos[i].map==players[index].map&&maquinatempos[i].ligada==1){
maq=true;
}
}
if(!maq){
send_reliable(players[index].peer_id, "msgnormal A máquina do tempo não está ligada!", 0);
newmap="aeroports";
newmap2="naotemmapa";
}
}
else if(newmap=="escola"&&players[index].map=="apresentação"){
if(players[index].lregras==0){
newmap="aeroports";
newmap2="naotemmapa";
send_reliable(players[index].peer_id, "msgnormal Para poder jogar, antes precisa ler as regras. Para isso, digite /regras. Após ler as regras e trocar de mapa, você estará automaticamente concordando com tudo o que foi proposto nelas. Se não estiver de acordo com alguma, mande um e-mail para webmaster@dbproduction.net, dizendo o que não concorda para analisarmos a possibilidade de uma mudança.", 0);
}
else newmap="escola";
}
else if(newmap=="ônibus"){
players[index].bus=1;
send_reliable(players[index].peer_id, "stopmoving", 0);
players[index].tmaquina.restart();
players[index].paralisado2=true;
}
else if(string_contains(newmap, "rodoviárias", 1)>-1) newmap=players[index].dbus;
if(string_contains(newmap, "loja", 1)>-1){
if(hora<10||hora>12&&hora<14||hora>20&&hora<10){
newmap="aeroports";
newmap2="naotemmapa";
send_reliable(players[index].peer_id, "msgnormal As portas desta loja estão fechadas!", 0);
}
}
if(string_contains(newmap, "loja", 1)>-1){
if(hora<10||hora>=12&&hora<14||hora>20){
newmap="aeroports";
newmap2="naotemmapa";
send_reliable(players[index].peer_id, "msgnormal As portas desta loja estão fechadas!", 0);
}
}
if(string_contains(newmap,"sairdomapat",1)>-1) newmap=players[index].destino2;
else if(string_contains(newmap,"sairdomapan",1)>-1){
if(players[index].chegounavio==0){
send_reliable(players[index].peer_id, "msgnormal Não, o navio está em movimento! Se sair você irá se jogar na água!", 0);
return;
}
else{
newmap=players[index].destino3;
players[index].chegounavio=0;
}
}
else if(string_contains(newmap, "cassino", 1)>-1){
if(hora<22){
newmap="aeroports";
newmap2="naotemmapa";
send_reliable(players[index].peer_id, "msgnormal O cassino abre das vinte e duas até meia-noite apenas!", 0);
}
}
else if(string_contains(newmap, "shopping", 1)>-1){
if(hora<10||hora>23){
newmap="aeroports";
newmap2="naotemmapa";
send_reliable(players[index].peer_id, "msgnormal No momento, este shopping encontra-se trancado!", 0);
}
}
for(uint n=0;n<banheiros.length();n++){
if(players[index].map==banheiros[n].map&&banheiros[n].descarga==1){
newmap="aeroports";
newmap2="naotemmapa";
send_reliable(players[index].peer_id, "msgnormal Não deixe o banheiro sujo!", 0);
}
}
if(string_contains(newmap, "apartamento", 1)>-1){
for(uint i2=0;i2<computadors.length();i2++){
if(computadors[i2].map==newmap){
if(computadors[i2].tabrir.elapsed>0){
changemap(computadors[i2].map, index, 1, 0, "eapartamento.ogg");
return;
}
}
}
send_reliable(players[index].peer_id, "mtext Digite o código para entrar no apartamento.:eapartamento", 0);
newmap="aeroports";
newmap2="naotemmapa";
}
if(newmap!="aeroports"){
players[index].maptraveltimer.restart();
changemap(newmap, index,newx,newy);
}
if(string_contains(newmap, "máquina_do_tempo", 1)>-1){
string[] mmaquina;
mmaquina.insert_last("Mundo pré histórico:pré_história");
mmaquina.insert_last("mundo medieval:mundo_medieval");
send_reliable(players[index].peer_id, "mmaquina "+linear(mmaquina), 0);
}
if(newmap=="ônibus") send_reliable(players[index].peer_id, "ps onibosligando.ogg", 0);
if(newmap2!="naotemmapa"||newmap!="aeroporto"&&newmap2!="naotemmapa"||newmap!="aeroports"&&newmap2=="naotemmapa")send_reliable(players[index].peer_id, "msgtravelpoint "+text, 0);
if(newmap=="transatlântico")players[index].tmaquina.restart();
if(string_contains(newmap, "avião", 1)>-1&&newmap!="avião2"||string_contains(newmap, "trem", 1)>-1||string_contains(newmap, "ônibus", 1)>-1){
send_reliable(players[index].peer_id, "stopmoving", 0);
players[index].paralisado2=true;
}
}
}
}
else if(parsed[0]=="portamapa" and parsed.length()>8)
{
if(players[index].maptraveltimer.elapsed<10000&&players[index].insz==false||players[index].paralisado==true||players[index].paralisado2==true)return;
int minx=string_to_number(parsed[1]);
int maxx=string_to_number(parsed[2]);
int miny=string_to_number(parsed[3]);
int maxy=string_to_number(parsed[4]);
int newx=string_to_number(parsed[5]);
int newy=string_to_number(parsed[6]);
string newmap=parsed[7];
string newmap2=parsed[7];
string text=parsed[8];
string audiomapa=parsed[9];
string sec="";
if(parsed.length>10) sec=parsed[10];
string[] tmpout;
if(minx<=players[index].x and maxx>=players[index].x and miny<=players[index].y and maxy>=players[index].y){
players[index].tcongelar.restart();
if(players[index].maptraveltimer.elapsed>700)
{
if(newmap=="castelo_medieval"){
int n_mapa=random(0, mapascastelo.length()-1);
string[] split=string_split(mapascastelo[n_mapa], " ", false);
x_castelo=string_to_number(split[0]);
y_castelo=string_to_number(split[1]);
}
else if(string_contains(newmap,"aeroportos",1)>-1){
if(players[index].destino=="aeroporto_internacional_de_los_angeles"){
newmap="aeroporto_internacional_de_los_angeles";
}
else if(players[index].destino=="aeroporto"){
newmap="aeroporto";
}
}
if(string_contains(newmap,"aeroports",1)>-1){
if(players[index].inv_item_number("um_passaporte")>0){
newmap="prisão";
players[index].fichaprisao+=1;
string mapname="prisão";
file f;
f.open("maps/"+mapname+".map", "rb");
string mdata=f.read();
f.close();
players[index].map=mapname;
players[index].x=1;
players[index].y=0;
send_reliable(players[index].peer_id, "changemap "+mdata+"\r\nx:1\r\ny:0\r\n", 0);
send_packet(0,"upl "+players[index].charname+" "+players[index].x+" "	+players[index].y+" "+players[index].map,players[index].map);
send_reliable(players[index].peer_id, "msgnormal Você tentou embarcar com um passaporte falso e foi flagrad"+players[index].sexo2+" pela segurança do aeroporto, que te escoltou diretamente para a cadeia!", 0);
players[index].inv_add_item("um_passaporte", -players[index].inv_item_number("um_passaporte"));
players[index].tempoprisao.restart();
players[index].msgliberdade="Você cumpriu sua pena e está agora em liberdade!";
}
else if(players[index].passaporte==0){
send_reliable(players[index].peer_id, "msgnormal Você tentou embarcar sem um passaporte e foi flagrad"+players[index].sexo2+" pela segurança do aeroporto, que te escoltou diretamente para a cadeia!", 0);
newmap="prisão";
newmap2="naotemmapa";
players[index].tempoprisao.restart();
}
else if(players[index].inv_item_number("passagem_para_los_angeles")>0&&players[index].destino=="aeroporto_internacional_de_los_angeles"&&players[index].passaporte==1){
players[index].inv_add_item("passagem_para_los_angeles", -1);
players[index].x=players[index].x+2;
send_reliable(players[index].peer_id,"move "+players[index].x+" "+players[index].y,0);
send_packet(0,"upl "+players[index].charname+" "+players[index].x+" "	+players[index].y+" "+players[index].map,players[index].map);
}
else if(players[index].inv_item_number("passagem_para_milão")>0&&players[index].destino=="aeroporto"&&players[index].passaporte==1){
players[index].inv_add_item("passagem_para_milão", -1);
players[index].x=players[index].x+2;
send_reliable(players[index].peer_id,"move "+players[index].x+" "+players[index].y,0);
send_packet(0,"upl "+players[index].charname+" "+players[index].x+" "	+players[index].y+" "+players[index].map,players[index].map);
}
else{
send_reliable(players[index].peer_id, "msgdepois você não tem nenhuma passagem. Compre uma primeiro!", 0);
newmap="aeroports";
newmap2="naotemmapa";
}
}
if(newmap=="bus"){
if(players[index].inv_item_number("passagem_de_ônibus_para_los_angeles")>0&&players[index].map=="rodoviária"){
players[index].inv_add_item("passagem_de_ônibus_para_los_angeles", -1);
players[index].x=players[index].x+2;
send_reliable(players[index].peer_id,"move "+players[index].x+" "+players[index].y,0);
send_packet(0,"upl "+players[index].charname+" "+players[index].x+" "	+players[index].y+" "+players[index].map,players[index].map);
newmap="aeroports";
newmap2="naotemmapa";
players[index].dbus="rodoviária_de_los_angeles";
}
else if(players[index].inv_item_number("passagem_de_ônibus_para_terminal_mar")>0&&players[index].map=="rodoviária_de_los_angeles"){
players[index].inv_add_item("passagem_de_ônibus_para_terminal_mar", -1);
players[index].x=players[index].x+2;
send_reliable(players[index].peer_id,"move "+players[index].x+" "+players[index].y,0);
send_packet(0,"upl "+players[index].charname+" "+players[index].x+" "	+players[index].y+" "+players[index].map,players[index].map);
newmap="aeroports";
newmap2="naotemmapa";
players[index].dbus="rodoviária";
}
else{
send_reliable(players[index].peer_id, "msgnormal você não tem nenhuma passagem. Compre uma primeiro!", 0);
newmap="aeroports";
newmap2="naotemmapa";
}
}
if(string_contains(newmap,"apartamento",1)>-1){
if(players[index].dalison2==""){
send_reliable(players[index].peer_id, "msgnormal Você não tem nenhuma casa...", 0);
newmap="aeroports";
newmap2="naotemmapa";
}
else{
newmap=players[index].dalison2;
}
}
if(string_contains(newmap, "loja", 1)>-1){
if(hora<10||hora>12&&hora<14||hora>20&&hora<10){
newmap="aeroports";
newmap2="naotemmapa";
send_reliable(players[index].peer_id, "msgnormal As portas desta loja estão fechadas!", 0);
}
}
if(string_contains(newmap,"trens",1)>-1){
if(players[index].inv_item_number("passagem_de_trem_para_los_angeles")>0&&players[index].destino2=="estação_de_los_angeles"){
players[index].inv_add_item("passagem_de_trem_para_los_angeles", -1);
players[index].x=players[index].x+2;
send_reliable(players[index].peer_id,"move "+players[index].x+" "+players[index].y,0);
send_reliable(0,"upl "+players[index].charname+" "+players[index].x+" "+players[index].y+" "+players[index].map,0);
newmap="aeroports";
newmap2="naotemmapa";
}
else if(players[index].inv_item_number("passagem_de_trem_para_santa_bertalina")>0&&players[index].destino2=="estação_de_santa_bertalina"){
players[index].inv_add_item("passagem_de_trem_para_santa_bertalina", -1);
players[index].x=players[index].x+2;
send_reliable(players[index].peer_id,"move "+players[index].x+" "+players[index].y,0);
send_unreliable(0,"upl "+players[index].charname+" "+players[index].x+" "+players[index].y+" "+players[index].map,0);
newmap="aeroports";
newmap2="naotemmapa";
}
else{
send_reliable(players[index].peer_id, "msgdepois você não tem nenhuma passagem. Compre uma primeiro!", 0);
newmap="aeroports";
newmap2="naotemmapa";
}
}
if(newmap=="portos"){
if(players[index].inv_item_number("passagem_de_cruzeiro_para_milão")>0&&players[index].destino3=="porto_de_milão"){
players[index].inv_add_item("passagem_de_cruzeiro_para_milão", -1);
players[index].x=players[index].x+2;
send_reliable(players[index].peer_id,"move "+players[index].x+" "+players[index].y,0);
send_reliable(0,"upl "+players[index].charname+" "+players[index].x+" "+players[index].y+" "+players[index].map,0);
newmap="aeroports";
newmap2="naotemmapa";
}
else if(players[index].inv_item_number("passagem_de_cruzeiro_para_copa_cabana")>0&&players[index].destino3=="porto"){
players[index].inv_add_item("passagem_de_cruzeiro_para_copa_cabana", -1);
players[index].x=players[index].x+2;
send_reliable(players[index].peer_id,"move "+players[index].x+" "+players[index].y,0);
send_packet(0,"upl "+players[index].charname+" "+players[index].x+" "	+players[index].y+" "+players[index].map,players[index].map);
newmap="aeroports";
newmap2="naotemmapa";
}
else{
send_reliable(players[index].peer_id, "msgnormal você não tem nenhuma passagem. Compre uma primeiro!", 0);
newmap="aeroports";
newmap2="naotemmapa";
}
}
if(string_contains(newmap, "loja", 1)>-1){
if(hora<10||hora>=12&&hora<14||hora>20){
newmap="aeroports";
newmap2="naotemmapa";
send_reliable(players[index].peer_id, "msgnormal As portas desta loja estão fechadas!", 0);
}
}
if(string_contains(newmap, "cassino", 1)>-1){
if(hora<22){
newmap="aeroports";
newmap2="naotemmapa";
send_reliable(players[index].peer_id, "msgnormal O cassino abre das vinte e duas até meia-noite apenas!", 0);
}
}
if(string_contains(newmap, "shopping", 1)>-1){
if(hora<10||hora>23){
newmap="aeroports";
newmap2="naotemmapa";
send_reliable(players[index].peer_id, "msgnormal No momento, este shopping encontra-se trancado!", 0);
}
}
players[index].maptraveltimer.restart();
players[index].jaandou=0;
players[index].javoou=0;
if(newmap!="aeroports") changemap(newmap, index,newx,newy, audiomapa);
if(newmap=="aeroports") send_packet(0, "play "+audiomapa+".ogg "+players[index].x+" "+players[index].y+" "+players[index].map, players[index].map);
//do_security(tmpout,index);
if(newmap=="trem"||newmap=="avião"){
players[index].paralisado2=true;
send_reliable(players[index].peer_id, "stopmoving", 0);
}
if(newmap2!="naotemmapa"||newmap!="aeroporto"&&newmap2!="naotemmapa"||newmap!="aeroports"&&newmap2=="naotemmapa")send_reliable(players[index].peer_id, "msgtravelpoint "+text, 0);
}
}
}
}
}
void iitem(int index, string n1, string n2){
if(n1=="caixa_eletrônico"){
if(n2=="csaldo")send_reliable(players[index].peer_id, "msg2 Você tem; ;"+players[index].saldo+"; ;reais em sua conta.", 0);
else if(n2=="dep") send_reliable(players[index].peer_id, "mtext Quanto você deseja depositar?:dep_r", 0);
else if(n2=="sac") send_reliable(players[index].peer_id, "mtext Quanto você deseja sacar?:sac_r", 0);
else if(n2=="dep2") send_reliable(players[index].peer_id, "mtext Quanto você deseja depositar?:dep2_r", 0);
}
}
string string_sem_return(string s){
string r=s;
r=string_replace(r, "\r\n", "", true);
r=string_replace(r, "\n", "", true);
r=string_replace(r, "\r", "", true);
return r;
}
void ganhaxp(string nome, int darxp, int moedas=0, bool pacifico=false){
int zz=get_player_index_from(nome);
if(zz>-1){
int r=0;
for(uint i=0;i<players[zz].nomesequipe.length();i++){
int z=get_player_index_from(players[zz].nomesequipe[i]);
if(z>-1){
if(players[z].pacifico==0&&players[z].afk==false||players[z].afk==false&&pacifico)  r+=1;
}
}
if(r==0)return;
int total=(darxp/r);
int total2=(moedas/r);
if(total<=0)return;
for(uint i=0;i<players[zz].nomesequipe.length();i++){
int z=get_player_index_from(players[zz].nomesequipe[i]);
if(z>-1){
if(players[z].pacifico==0&&players[z].afk==false||players[z].afk==false&&pacifico){
players[z].xp+=total;
send_reliable(players[z].peer_id, "msgvocêganhou "+total, 0);
if(doublexp==1){
z=get_player_index_from(players[zz].nomesequipe[i]);
if(z>-1){
players[z].xp+=total;
send_reliable(players[z].peer_id, "msgvocêganhou2 "+total, 0);
}
}
}
}
if(total2>0){
int z=get_player_index_from(players[zz].nomesequipe[i]);
if(z>-1){
if(players[z].pacifico==0&&players[z].afk==false||players[z].afk==false&&pacifico){
players[z].inv_add_item("coins", total2);
send_reliable(players[z].peer_id, "msgpegouitem "+total2+" coins", 0);
if(doublegold==1){
z=get_player_index_from(players[zz].nomesequipe[i]);
if(z>-1){
players[z].inv_add_item("coins", total2);
send_reliable(players[z].peer_id, "msgvocêganhamais "+total2, 0);
}
}
}
}
}
}
}
}
void vervida(){
for(uint ie=0;ie<players.length();ie++){
if(players[ie].health<=0&&players[ie].map!="túnel"){
if(players[ie].starsoundid!=""){
for(uint i=0;i<msounds.length();i++){
if(players[ie].starsoundid==msounds[i].id&&string_contains(msounds[i].soundloop, "lancha", 1)>-1){
destroy_moving_sound(players[ie].starsoundid);
players[ie].nalancha=0;
break;
}
}
}
if(players[ie].tfid!="")destroy_moving_sound(players[ie].tfid);
players[ie].centado=false;
if(players[ie].inv_item_number("areia_da_montanha")>0){
players[ie].inv_add_item("areia_da_montanha", -1);
send_reliable(players[ie].peer_id, "ps notify_died.ogg", 0);
}
if(players[ie].cloaked)
{
players[ie].cloaked=false;
players[ie].cloakhiding=false;
send_reliable(players[ie].peer_id,"stopcloak",0);
send_packet(0,"play spell_cloak_powerdown.ogg "+players[ie].x+" "+players[ie].y+" "+players[ie].map,players[ie].map);
}
players[ie].cavalo=false;
players[ie].envenenado=false;
players[ie].nveneno=0;
players[ie].nparalisado=0;
players[ie].paralisado=false;
players[ie].tparalisado.force(0);
players[ie].tparalisado.pause();
players[ie].afking=false;
players[ie].afk=false;
if(players[ie].tsugando.elapsed>0){
players[ie].tsugando.force(0);
players[ie].tsugando.pause();
players[ie].tsvida.force(0);
players[ie].tsvida.pause();
players[ie].tsitem.force(0);
players[ie].tsitem.pause();
if(players[ie].nsugador!=""){
int n=get_player_index_from(players[ie].nsugador);
if(n>-1){
if(players[n].paralisado==false&&players[n].paralisado2==false)send_reliable(players[n].peer_id, "startmoving", 0);
}
}
}
if(string_contains(players[ie].lasthit, "sugador_", 1)>-1){
int n=get_player_index_from(string_replace(players[ie].lasthit, "sugador_", "", false));
if(n>-1){
players[n].tsugando.force(0);
players[n].tsugando.pause();
players[n].tsvida.force(0);
players[n].tsvida.pause();
players[n].tsitem.force(0);
players[n].tsitem.pause();
if(players[n].paralisado==false&&players[n].paralisado2==false)send_reliable(players[n].peer_id, "startmoving", 0);
}
}
if(players[ie].newbie==false&&players[ie].pacifico==0)send_reliable(players[ie].peer_id, "fimnovato", 0);
if(players[ie].invs==0){
send_reliable(0,"playerbeep "+players[ie].charname+" 1",0);
players[ie].bipar=1;
}
if(gamestopped==false)send_reliable(players[ie].peer_id,"startmoving",0);
if(get_player_index_from(players[ie].lasthit)>=0)
{
players[get_player_index_from(players[ie].lasthit)].matou+=1;
if(players[get_player_index_from(players[ie].lasthit)].matou>jrecord&&players[get_player_index_from(players[ie].lasthit)].charname!=njrecord){
send_reliable(0, "msgquebrourecord "+players[get_player_index_from(players[ie].lasthit)].charname+" "+njrecord+" "+players[get_player_index_from(players[ie].lasthit)].matou, 0);
send_reliable(0, "ps notify_startrek_beep.ogg", 0);
jrecord=players[get_player_index_from(players[ie].lasthit)].matou;
njrecord=players[get_player_index_from(players[ie].lasthit)].charname;
if(postar==true) url_post("http://www.desafiomortal.com.br/record.php", "nome="+njrecord+"&assassinatos="+jrecord);
file f;
f.open("servidor.recordista","wb");
f.write(njrecord+"\r\n"+jrecord);
f.close();
}
int r=random(1, 6);
players[get_player_index_from(players[ie].lasthit)].inv_add_item("reais", r);
send_reliable(players[get_player_index_from(players[ie].lasthit)].peer_id, "msgpegouitem "+r+" reais", 0);
if(players[get_player_index_from(players[ie].lasthit)].map=="arena"){
if(players[ie].sexo==0){
send_reliable(0, "msgmortanaarena "+players[ie].charname+" "+players[get_player_index_from(players[ie].lasthit)].charname, 3);
}
else if(players[ie].sexo==1){
send_reliable(0, "msgmortonaarena "+players[ie].charname+" "+players[get_player_index_from(players[ie].lasthit)].charname, 3);
}
if(players[get_player_index_from(players[ie].lasthit)].health>=5000){
for(uint per=0; per < players.length(); per++){
if(players[per].map=="arena"){
send_reliable(players[per].peer_id, "ps perfecte.ogg", 0);
}
}
}
}
else{
int msgmorte=random(1, 11);
int i2=get_player_index_from(players[ie].lasthit);
if(msgmorte==1){
if(players[ie].sexo==0){
send_reliable(0, "msgvocêémuitofraca "+players[i2].charname+" "+players[ie].charname, 3);
}
else if(players[i2].sexo==1){
send_reliable(0, "msgvocêémuitofraco "+players[i2].charname+" "+players[ie].charname, 3);
}
}
else if(msgmorte==2){
send_reliable(0, "msgdapróximavezvenhacommaisgente "+players[i2].charname+" "+players[ie].charname, 3);
}
else if(msgmorte==3){
send_reliable(0, "msgnãovenhatomarmeutempo "+players[i2].charname+" "+players[ie].charname, 3);
}
else if(msgmorte==4){
send_reliable(0, "msgeraumavez "+players[i2].charname+" "+players[ie].charname, 3);
}
else if(msgmorte==5){
send_reliable(0, "msgmatarmosquito "+players[i2].charname+" "+players[ie].charname, 3);
}
else if(msgmorte==6){
send_reliable(0, "msgparabaixodaterra "+players[i2].charname+" "+players[ie].charname, 3);
}
else if(msgmorte==7){
if(players[ie].sexo==0){
send_reliable(0, "msgtantoqueamatou "+players[i2].charname+" "+players[ie].charname, 3);
}
else if(players[i2].sexo==1){
send_reliable(0, "msgtantoqueomatou "+players[i2].charname+" "+players[ie].charname, 3);
}
}
else if(msgmorte==8){
if(players[ie].sexo==0){
send_reliable(0, "msgsenãoestivessemorta "+players[i2].charname+" "+players[ie].charname, 3);
}
else if(players[i2].sexo==1){
send_reliable(0, "msgsenãoestivessemorto "+players[i2].charname+" "+players[ie].charname, 3);
}
}
else if(msgmorte==9){
if(players[ie].sexo==0){
send_reliable(0, "msgdeixoumatala "+players[i2].charname+" "+players[ie].charname, 3);
}
else if(players[i2].sexo==1){
send_reliable(0, "msgdeixoumatalo "+players[i2].charname+" "+players[ie].charname, 3);
}
}
else if(msgmorte==10){
send_reliable(0, "msgolhalogopraquem "+players[ie].charname+" "+players[i2].charname, 3);
}
else if(msgmorte==11){
if(players[ie].sexo==0){
send_reliable(0, "msgtodasuja "+players[i2].charname+" "+players[ie].charname, 3);
}
else if(players[i2].sexo==1){
send_reliable(0, "msgtodosujo "+players[i2].charname+" "+players[ie].charname, 3);
}
}
}
if(players[get_player_index_from(players[ie].lasthit)].charname!=players[ie].charname)
{
if(players[ie].map!="desafio_constante")
{
ganhaxp(players[get_player_index_from(players[ie].lasthit)].charname, random(30, 100));
}
}
}
else if(players[ie].lasthit=="fogo"){
if(players[ie].sexo==0) send_reliable(0, "msgmorreuqueimada "+players[ie].charname, 3);
else if(players[ie].sexo==1) send_reliable(0, "msgmorreuqueimado "+players[ie].charname, 3);
}
else if(string_contains(players[ie].lasthit,"magnet_",1)>-1)
{
string pname=string_replace(players[ie].lasthit,"magnet_","",false);
send_reliable(0,"msga "+players[ie].charname+" Morreu no magnet de "+pname+"!", 3);
int pid=get_player_index_from(pname);
if(pid>-1){
pname=players[pid].charname;
if(players[pid].charname!=players[ie].charname){
players[pid].matou+=1;
if(players[ie].map!="desafio_constante"){
ganhaxp(players[pid].charname, random(30,100));
}
}
}
}
else if(string_contains(players[ie].lasthit,"fita_",1)>-1){
string pname=string_replace(players[ie].lasthit,"fita_","",false);
send_reliable(0,"msg2 fita_explosiva; ;de; "+pname+" ;matou; "+players[ie].charname+"!", 3);
int pid=get_player_index_from(pname);
if(pid>-1){
if(players[pid].charname!=players[ie].charname){
players[pid].matou+=1;
if(players[ie].map!="desafio_constante"){
ganhaxp(players[pid].charname, random(30,100));
}
}
}
}
else if(players[ie].lasthit=="doente"){
send_reliable(0, "msg2 "+players[ie].charname+" ;morreu doente!", 3);
players[ie].doente=0;
players[ie].sujo=0;
players[ie].tdoente2.force(0);
players[ie].tdoente2.pause();
}
else if(players[ie].lasthit=="gripe"){
send_reliable(0, "msg2 "+players[ie].charname+" ;morreu gripad"+players[ie].sexo2+"!", 3);
players[ie].ngripe=0;
players[ie].sujo=0;
players[ie].tgripe.force(0);
players[ie].tgripe.pause();
}
else if(players[ie].lasthit=="fogo"){
send_reliable(0, "msg2 "+players[ie].charname+" ;morreu queimad"+players[ie].sexo2+"!", 3);
}
else if(string_contains(players[ie].lasthit, "eletrocutado_", 1)>-1){
 send_reliable(0, "msgnormal "+players[ie].charname+" morreu eletrocutado!", 3);
}
else if(players[ie].lasthit=="sede"){
send_reliable(0, "msg2 "+players[ie].charname+"; ;morreu de sede!", 3);
players[ie].nsede=0;
players[ie].nfome=0;
players[ie].tsedefome.restart();
}
else if(players[ie].lasthit=="fome"){
send_reliable(0, "msg2 "+players[ie].charname+"; ;morreu de fome!", 3);
players[ie].nsede=0;
players[ie].nfome=0;
players[ie].tsedefome.restart();
}
else if(string_contains(players[ie].lasthit,"helicoptero",1)>-1)
{
send_reliable(0,"msg2 "+players[ie].charname+" ;foi metralhad"+players[ie].sexo2+" pelo helicóptero de guerra!", 3);
}
else if(string_contains(players[ie].lasthit,"sequestrador",1)>-1)
{
send_reliable(0,"msgnormal "+players[ie].charname+" morreu por um sequestrador!", 3);
}
else if(string_contains(players[ie].lasthit,"guardacofre",1)>-1)
{
send_reliable(0,"msgnormal "+players[ie].charname+" morreu para um guarda_do_cofre!", 3);
}
else if(players[ie].lasthit=="ondadefogo"){
send_reliable(0, "msg2 "+players[ie].charname+" ;morreu pela onda de fogo!", 3);
}
else if(string_contains(players[ie].lasthit,"sugador_",1)>-1){
string pname=string_replace(players[ie].lasthit,"sugador_","",false);
send_reliable(0,"msga "+players[ie].charname+" Morreu no sugador de "+pname+"!", 3);
int pid=get_player_index_from(pname);
if(pid>-1){
pname=players[pid].charname;
if(players[pid].charname!=players[ie].charname){
if(players[ie].map!="desafio_constante"){
players[pid].matou+=1;
ganhaxp(players[pid].charname, random(30,100));
}
}
}
}
else if(string_contains(players[ie].lasthit,"maxbomba_",1)>-1)
{
string pname=string_replace(players[ie].lasthit,"maxbomba_","",false);
send_reliable(0,"msgmaxbomba "+players[ie].charname+" "+pname, 3);
int pid=get_player_index_from(pname);
if(pid>-1){
pname=players[pid].charname;
if(players[pid].charname!=players[ie].charname){
if(players[ie].map!="desafio_constante"){
players[pid].matou+=1;
ganhaxp(players[pid].charname, random(30,100));
}
}
}
}
else if(string_contains(players[ie].lasthit,"bombaatomica_",1)>-1)
{
string pname=string_replace(players[ie].lasthit,"bombaatomica_","",false);
if(players[ie].sexo==0) send_reliable(0,"msgbombaatomicam "+players[ie].charname+" "+pname, 3);
else if(players[ie].sexo==1) send_reliable(0,"msgbombaatomicah "+players[ie].charname+" "+pname, 3);
int pid=get_player_index_from(pname);
if(pid>-1){
pname=players[pid].charname;
if(players[pid].charname!=players[ie].charname){
players[pid].matou+=1;
if(players[ie].map!="desafio_constante"){
ganhaxp(players[pid].charname, random(30,100));
}
}
}
}
else if(string_contains(players[ie].lasthit,"punho_",1)>-1){
string pname=string_replace(players[ie].lasthit,"punho_","",false);
send_reliable(0, "msg2 O Punho_de_Hórus mostra seu feito outra vez, ao mandar; "+players[ie].charname+" ;para o mundo dos mortos!", 3);
int pid=get_player_index_from(pname);
if(pid>-1){
pname=players[pid].charname;
if(players[pid].charname!=players[ie].charname){
players[pid].matou+=1;
if(players[ie].map!="desafio_constante"){
ganhaxp(players[pid].charname, random(30,100));
}
}
}
}
else if(string_contains(players[ie].lasthit,"trovão_",1)>-1){
string pname=string_replace(players[ie].lasthit,"trovão_","",false);
send_reliable(0, "msg2 "+players[ie].charname+" ;foi atingid"+players[ie].sexo2+" pelo raio conjurado de; "+pname, 3);
int pid=get_player_index_from(pname);
if(pid>-1){
pname=players[pid].charname;
if(players[pid].charname!=players[ie].charname){
players[pid].matou+=1;
if(players[ie].map!="desafio_constante"){
ganhaxp(players[pid].charname, random(30,100));
}
}
}
}
else if(string_contains(players[ie].lasthit,"meteoro_",1)>-1){
string pname=string_replace(players[ie].lasthit,"meteoro_","",false);
send_reliable(0, "msg2 "+players[ie].charname+" ;foi atingid"+players[ie].sexo2+" por um dos meteoros que veio de encontro à este planeta!; ;Excelente trabalho de; "+pname+".", 3);
int pid=get_player_index_from(pname);
if(pid>-1){
pname=players[pid].charname;
if(players[pid].charname!=players[ie].charname){
players[pid].matou+=1;
if(players[ie].map!="desafio_constante"){
ganhaxp(players[pid].charname, random(30,100));
}
}
}
}
else if(string_contains(players[ie].lasthit,"missil_",1)>-1){
string pname=string_replace(players[ie].lasthit,"missil_","",false);
send_reliable(0, "msg2 "+players[ie].charname+" ;foi atingid"+players[ie].sexo2+" por um míssil_teleguiado de; "+pname+"!", 3);
int pid=get_player_index_from(pname);
if(pid>-1){
pname=players[pid].charname;
if(players[pid].charname!=players[ie].charname){
players[pid].matou+=1;
if(players[ie].map!="desafio_constante"){
ganhaxp(players[pid].charname, random(30,100));
}
}
}
}
else if(string_contains(players[ie].lasthit,"boladefogo_",1)>-1){
string pname=string_replace(players[ie].lasthit,"boladefogo_","",false);
send_reliable(0, "msg2 "+players[ie].charname+" ;teve seu corpo consumido pelas chamas da bola de fogo de; "+pname, 3);
int pid=get_player_index_from(pname);
if(pid>-1){
pname=players[pid].charname;
if(players[pid].charname!=players[ie].charname){
players[pid].matou+=1;
if(players[ie].map!="desafio_constante"){
ganhaxp(players[pid].charname, random(30,100));
}
}
}
}
else if(string_contains(players[ie].lasthit,"bombanuclear_",1)>-1)
{
string pname=string_replace(players[ie].lasthit,"bombanuclear_","",false);
send_reliable(0, "msg2 "+players[ie].charname+" ;teve todo seu corpo transposto pela destruição diabólica de; "+pname, 3);
int pid=get_player_index_from(pname);
if(pid>-1){
pname=players[pid].charname;
if(players[pid].charname!=players[ie].charname){
players[pid].matou+=1;
if(players[ie].map!="desafio_constante"){
ganhaxp(players[pid].charname, random(30,100));
}
}
}
}
else if(string_contains(players[ie].lasthit,"bombarelogio_",1)>-1)
{
string pname=string_replace(players[ie].lasthit,"bombarelogio_","",false);
send_reliable(0,"msgbombarelogio "+players[ie].charname+" "+pname, 3);
int pid=get_player_index_from(pname);
if(pid>-1){
pname=players[pid].charname;
if(players[pid].charname!=players[ie].charname){
players[pid].matou+=1;
if(players[ie].map!="desafio_constante"){
ganhaxp(players[pid].charname, random(30,100));
}
}
}
}
else if(players[ie].lasthit=="congelado")send_reliable(0, "msg2 "+players[ie].charname+" ;morreu congelad"+players[ie].sexo2+"!", 3);
else if(string_contains(players[ie].lasthit,"sugador_",1)>-1)
{
string pname=string_replace(players[ie].lasthit,"sugador_","",false);
send_reliable(0, "msg2 "+pname+" ;morreu por um sugador de vida e itens!", 3);
int pid=get_player_index_from(pname);
if(pid>-1){
pname=players[pid].charname;
if(players[pid].charname!=players[ie].charname){
players[pid].matou+=1;
if(players[ie].map!="desafio_constante"){
ganhaxp(players[pid].charname, random(30,100));
}
}
}
}
else if(string_contains(players[ie].lasthit,"'s mina",1)>-1)
{
string pname=string_replace(players[ie].lasthit,"'s mina","",false);
int pid=get_player_index_from(pname);
if(pid>-1){
pname=players[pid].charname;
send_reliable(0, "msgcaiunamina "+players[ie].charname+" "+pname+" "+players[ie].map, 0);
if(players[pid].charname!=players[ie].charname){
players[pid].matou+=1;
if(players[ie].map!="desafio_constante"){
ganhaxp(players[pid].charname, random(30,100));
}
}
}
}
else if(players[ie].lasthit!="")send_reliable(0, "msg2 "+players[ie].lasthit+"; ;matou; ;"+players[ie].charname+";!", 3);
if(players[ie].telestage!=0){
if(players[ie].tfid!="")destroy_moving_sound(players[ie].tfid);
players[ie].telestage=0;
}
if(string_contains(players[ie].map, "apartamento_de_", 1)<0 and string_contains(players[ie].map, "prisão", 1)<0)changemap(mapainicial, ie, 1, 0);
else changemap(players[ie].mapavoltar, ie, 1, 0);
players[ie].health=players[ie].maxhealth;
players[ie].lasthit="";
}
}
}
bool tjogador(string nome){
for(uint i=0;i<players.length();i++){
if(players[i].map==nome)return true;
}
return false;
}
bool congelou(int index){
string map=players[index].map;
file f;
f.open("maps/"+map+".map", "r");
string mdata=f.read();
f.close();
string[] p1=delinear(mdata);
for(uint i=0; i<p1.length(); i++){
string[] parsed=string_split(p1[i], ":", true);
if(parsed[0]=="congelar"&&parsed.length()>4){
int minx=string_to_number(parsed[1]);
int maxx=string_to_number(parsed[2]);
int miny=string_to_number(parsed[3]);
int maxy=string_to_number(parsed[4]);
if(minx<=players[index].x&&maxx>=players[index].x&&miny<=players[index].y&&maxy>=players[index].y)return true;
}
}
return false;
}
void dar_reais(string nome, int reais, bool pacifico=true){
int zz=get_player_index_from(nome);
if(zz>-1){
int r=0;
for(uint i=0;i<players[zz].nomesequipe.length();i++){
int z=get_player_index_from(players[zz].nomesequipe[i]);
if(z>-1){
if(players[z].pacifico==0&&players[z].afk==false||players[z].afk==false&&pacifico)r+=1;
}
}
if(r==0)return;
int total=(reais/r);
if(total<=0)return;
for(uint i=0;i<players[zz].nomesequipe.length();i++){
int z=get_player_index_from(players[zz].nomesequipe[i]);
if(z>-1){
if(players[z].pacifico==0&&players[z].afk==false||players[z].afk==false&&pacifico){
players[z].inv_add_item("reais", total);
send_reliable(players[z].peer_id, "msgpegouitem "+total+" reais", 0);
if(doublegold==1){
z=get_player_index_from(players[zz].nomesequipe[i]);
if(z>-1){
players[z].inv_add_item("reais", total);
send_reliable(players[z].peer_id, "msgvocêganhamais "+total, 0);
}
}
}
}
}
}
}
void loops2(){
if(misseisguiados.length()>0)mguiadoloop();
if(projeteis.length()>0)projeteiloop();
if(oms.length()>0)omloop();
if(canhaos.length()>0)canhaoloop();
}